# 3ï¸âƒ£ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ¯ **ëª©í‘œ**
JWT ê¸°ë°˜ì˜ ì•ˆì „í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ì¸ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ìë™ ë¡œê·¸ì¸, í† í° ê°±ì‹ , ë³´í˜¸ëœ ë¼ìš°íŠ¸ ë“± ì™„ì „í•œ ì¸ì¦ í”Œë¡œìš°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ” **ì¸ì¦ ì‹œìŠ¤í…œ ìš”ì•½**

### ğŸ›¡ï¸ **ë³´ì•ˆ íŠ¹ì§•**
- **JWT ê¸°ë°˜ ì¸ì¦** - ìƒíƒœ ë¹„ì €ì¥ í† í° ë°©ì‹
- **ìë™ í† í° ê°±ì‹ ** - ì‚¬ìš©ì ê°œì… ì—†ì´ ì„¸ì…˜ ìœ ì§€
- **ë©”ëª¨ë¦¬ ê¸°ë°˜ ì•¡ì„¸ìŠ¤ í† í°** - XSS ê³µê²© ë°©ì§€
- **API ì¸í„°ì…‰í„°** - ìë™ í† í° ë§Œë£Œ ì²˜ë¦¬
- **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´** - ê´€ë¦¬ì/ì‚¬ìš©ì ê¶Œí•œ êµ¬ë¶„

### ğŸ¯ **ì‚¬ìš©ì ê²½í—˜**
- **ìë™ ë¡œê·¸ì¸** - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ë¡œê·¸ì¸ ìœ ì§€
- **ë¶€ë“œëŸ¬ìš´ ì „í™˜** - ë¡œë”© ìƒíƒœì™€ ì—ëŸ¬ ì²˜ë¦¬
- **ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬** - ë³€ê²½ ë° ì¬ì„¤ì • ì§€ì›
- **í”„ë¡œí•„ ê´€ë¦¬** - ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥

---

## ğŸ” **ì¸ì¦ í”Œë¡œìš° ê°œìš”**

### ğŸ“‹ **ì „ì²´ ì¸ì¦ í”„ë¡œì„¸ìŠ¤**
```
1. ë¡œê·¸ì¸ â†’ 2. í† í° ì €ì¥ â†’ 3. API ìš”ì²­ ì‹œ ì¸ì¦ â†’ 4. í† í° ê°±ì‹  â†’ 5. ë¡œê·¸ì•„ì›ƒ
```

---

## ğŸš€ **1ë‹¨ê³„: ì¸ì¦ ìƒíƒœ ê´€ë¦¬ (Zustand)**

### `src/stores/authStore.ts`
```typescript
import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import { User } from '@/types/auth';

/**
 * ì¸ì¦ ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
 */
interface AuthState {
  // ìƒíƒœ
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  
  // ì•¡ì…˜
  setUser: (user: User) => void;
  setTokens: (accessToken: string, refreshToken: string) => void;
  clearAuth: () => void;
  setLoading: (loading: boolean) => void;
}

/**
 * ì¸ì¦ ìŠ¤í† ì–´
 * - accessToken: ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ (ë³´ì•ˆ)
 * - refreshToken: localStorageì— ì €ì¥ (ìë™ ë¡œê·¸ì¸ìš©)
 * - user: localStorageì— ì €ì¥ (UI í‘œì‹œìš©)
 */
export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      // ì´ˆê¸° ìƒíƒœ
      user: null,
      accessToken: null,
      refreshToken: null,
      isAuthenticated: false,
      isLoading: false,

      // ì‚¬ìš©ì ì •ë³´ ì„¤ì •
      setUser: (user: User) => {
        set({ 
          user, 
          isAuthenticated: true 
        });
      },

      // í† í° ì„¤ì •
      setTokens: (accessToken: string, refreshToken: string) => {
        set({ 
          accessToken, 
          refreshToken,
          isAuthenticated: true 
        });
        
        // API í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì •
        if (typeof window !== 'undefined') {
          const { apiClient } = require('@/services/api/client');
          apiClient.setAuthToken(accessToken);
        }
      },

      // ì¸ì¦ ì •ë³´ ëª¨ë‘ ì‚­ì œ
      clearAuth: () => {
        set({ 
          user: null,
          accessToken: null,
          refreshToken: null,
          isAuthenticated: false 
        });
        
        // API í´ë¼ì´ì–¸íŠ¸ì—ì„œ í† í° ì œê±°
        if (typeof window !== 'undefined') {
          const { apiClient } = require('@/services/api/client');
          apiClient.removeAuthToken();
        }
      },

      // ë¡œë”© ìƒíƒœ ì„¤ì •
      setLoading: (loading: boolean) => {
        set({ isLoading: loading });
      },
    }),
    {
      name: 'auth-storage',
      storage: createJSONStorage(() => localStorage),
      // accessTokenì€ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ (ë³´ì•ˆìƒ localStorage ì œì™¸)
      partialize: (state) => ({
        user: state.user,
        refreshToken: state.refreshToken,
      }),
    }
  )
);
```

---

## ğŸ”‘ **2ë‹¨ê³„: ì¸ì¦ API ì„œë¹„ìŠ¤ í™•ì¥**

### `src/services/api/auth.ts` ë³´ì™„
```typescript
import { apiClient, ApiResponse } from './client';
import { API_ENDPOINTS } from '@/utils/constants';
import { LoginRequest, LoginResponse, User } from '@/types/auth';

/**
 * í† í° ê°±ì‹  ì‘ë‹µ íƒ€ì…
 */
export interface RefreshTokenResponse {
  accessToken: string;
  refreshToken: string;
  user: User;
}

/**
 * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­ íƒ€ì…
 */
export interface ChangePasswordRequest {
  currentPassword: string;
  newPassword: string;
  confirmPassword: string;
}

/**
 * ì¸ì¦ ê´€ë ¨ API ì„œë¹„ìŠ¤
 */
export const authAPI = {
  /**
   * ë¡œê·¸ì¸
   */
  login: async (credentials: LoginRequest): Promise<ApiResponse<LoginResponse>> => {
    return apiClient.post<LoginResponse>(API_ENDPOINTS.AUTH.LOGIN, credentials);
  },

  /**
   * ë¡œê·¸ì•„ì›ƒ (ì„œë²„ì—ì„œ ë¦¬í”„ë ˆì‹œ í† í° ë¬´íš¨í™”)
   */
  logout: async (): Promise<ApiResponse<void>> => {
    return apiClient.post<void>(API_ENDPOINTS.AUTH.LOGOUT);
  },

  /**
   * í† í° ê°±ì‹ 
   */
  refreshToken: async (refreshToken: string): Promise<ApiResponse<RefreshTokenResponse>> => {
    return apiClient.post<RefreshTokenResponse>(API_ENDPOINTS.AUTH.REFRESH, {
      refreshToken,
    });
  },

  /**
   * í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
   */
  getMe: async (): Promise<ApiResponse<User>> => {
    return apiClient.get<User>(API_ENDPOINTS.AUTH.ME);
  },

  /**
   * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
   */
  changePassword: async (data: ChangePasswordRequest): Promise<ApiResponse<void>> => {
    return apiClient.post<void>(API_ENDPOINTS.AUTH.CHANGE_PASSWORD, data);
  },

  /**
   * ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ìš”ì²­ (ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼)
   */
  requestPasswordReset: async (email: string): Promise<ApiResponse<void>> => {
    return apiClient.post<void>(API_ENDPOINTS.AUTH.REQUEST_RESET, { email });
  },
};
```

### `src/utils/constants.ts` API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
```typescript
export const API_ENDPOINTS = {
  // ì¸ì¦
  AUTH: {
    LOGIN: '/auth/login',
    LOGOUT: '/auth/logout',
    REFRESH: '/auth/refresh',
    ME: '/auth/me',
    CHANGE_PASSWORD: '/auth/change-password',
    REQUEST_RESET: '/auth/request-password-reset',
  },
  // ... ê¸°ì¡´ ì—”ë“œí¬ì¸íŠ¸ë“¤
} as const;
```

---

## ğŸ£ **3ë‹¨ê³„: ì¸ì¦ í›… êµ¬í˜„**

### `src/hooks/useAuth.ts` ì™„ì „ êµ¬í˜„
```typescript
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { useNavigate, useLocation } from 'react-router-dom';
import { authAPI } from '@/services/api/auth';
import { useAuthStore } from '@/stores/authStore';
import { queryKeys } from '@/lib/queryClient';
import { LoginRequest, ChangePasswordRequest } from '@/types/auth';
import { ApiError } from '@/services/api/client';

/**
 * ì¸ì¦ ê´€ë ¨ í›…
 */
export const useAuth = () => {
  const navigate = useNavigate();
  const location = useLocation();
  const queryClient = useQueryClient();
  
  const {
    user,
    accessToken,
    refreshToken,
    isAuthenticated,
    isLoading,
    setUser,
    setTokens,
    clearAuth,
    setLoading,
  } = useAuthStore();

  // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (í† í°ì´ ìˆì„ ë•Œë§Œ)
  const { 
    data: userData, 
    error: userError,
    isLoading: isUserLoading 
  } = useQuery({
    queryKey: queryKeys.auth.me,
    queryFn: async () => {
      const response = await authAPI.getMe();
      return response.data;
    },
    enabled: !!accessToken && !user,
    retry: false,
  });

  // ì‚¬ìš©ì ë°ì´í„°ê°€ ë¡œë“œë˜ë©´ ìŠ¤í† ì–´ì— ì €ì¥
  useEffect(() => {
    if (userData && !user) {
      setUser(userData);
    }
  }, [userData, user, setUser]);

  // ë¡œê·¸ì¸ ë®¤í…Œì´ì…˜
  const loginMutation = useMutation({
    mutationFn: async (credentials: LoginRequest) => {
      setLoading(true);
      const response = await authAPI.login(credentials);
      return response.data;
    },
    onSuccess: (data) => {
      // í† í°ê³¼ ì‚¬ìš©ì ì •ë³´ ì €ì¥
      setTokens(data.token, data.refreshToken);
      setUser(data.user);
      
      // ì‚¬ìš©ì ì •ë³´ ìºì‹œ ì—…ë°ì´íŠ¸
      queryClient.setQueryData(queryKeys.auth.me, data.user);
      
      // ì›ë˜ ê°€ë ¤ë˜ í˜ì´ì§€ ë˜ëŠ” ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
      const from = (location.state as any)?.from?.pathname || '/dashboard';
      navigate(from, { replace: true });
    },
    onError: (error) => {
      console.error('Login failed:', error);
    },
    onSettled: () => {
      setLoading(false);
    },
  });

  // ë¡œê·¸ì•„ì›ƒ ë®¤í…Œì´ì…˜
  const logoutMutation = useMutation({
    mutationFn: async () => {
      // ì„œë²„ì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­ (í† í° ë¬´íš¨í™”)
      if (refreshToken) {
        try {
          await authAPI.logout();
        } catch (error) {
          // ì„œë²„ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨í•´ë„ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¡œê·¸ì•„ì›ƒ ì§„í–‰
          console.warn('Server logout failed:', error);
        }
      }
    },
    onSuccess: () => {
      // í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ì •ë³´ ì •ë¦¬
      clearAuth();
      
      // ëª¨ë“  ì¿¼ë¦¬ ìºì‹œ ì´ˆê¸°í™”
      queryClient.clear();
      
      // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
      navigate('/login', { replace: true });
    },
  });

  // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë®¤í…Œì´ì…˜
  const changePasswordMutation = useMutation({
    mutationFn: async (data: ChangePasswordRequest) => {
      const response = await authAPI.changePassword(data);
      return response.data;
    },
    onSuccess: () => {
      // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í›„ ì¬ë¡œê·¸ì¸ ìœ ë„
      clearAuth();
      queryClient.clear();
      navigate('/login', { 
        replace: true,
        state: { message: 'ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.' }
      });
    },
  });

  // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ìš”ì²­ ë®¤í…Œì´ì…˜
  const requestPasswordResetMutation = useMutation({
    mutationFn: async (email: string) => {
      const response = await authAPI.requestPasswordReset(email);
      return response.data;
    },
  });

  return {
    // ìƒíƒœ
    user,
    isAuthenticated,
    isLoading: isLoading || isUserLoading,
    error: userError,
    
    // ì•¡ì…˜
    login: loginMutation.mutate,
    logout: logoutMutation.mutate,
    changePassword: changePasswordMutation.mutate,
    requestPasswordReset: requestPasswordResetMutation.mutate,
    
    // ë®¤í…Œì´ì…˜ ìƒíƒœ
    isLoggingIn: loginMutation.isPending,
    isLoggingOut: logoutMutation.isPending,
    isChangingPassword: changePasswordMutation.isPending,
    isRequestingReset: requestPasswordResetMutation.isPending,
    
    // ì—ëŸ¬
    loginError: loginMutation.error,
    logoutError: logoutMutation.error,
    changePasswordError: changePasswordMutation.error,
    resetRequestError: requestPasswordResetMutation.error,
  };
};
```

---

## ğŸ”„ **4ë‹¨ê³„: ìë™ í† í° ê°±ì‹  ì‹œìŠ¤í…œ**

### `src/hooks/useTokenRefresh.ts` ë³´ì™„
```typescript
import { useEffect, useCallback } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { authAPI } from '@/services/api/auth';
import { useAuthStore } from '@/stores/authStore';
import { ApiError } from '@/services/api/client';

/**
 * JWT í† í° ìë™ ê°±ì‹  í›…
 */
export const useTokenRefresh = () => {
  const queryClient = useQueryClient();
  const { 
    accessToken, 
    refreshToken, 
    setTokens, 
    clearAuth,
    setLoading 
  } = useAuthStore();

  /**
   * í† í° ê°±ì‹  í•¨ìˆ˜
   */
  const refreshAccessToken = useCallback(async (): Promise<boolean> => {
    if (!refreshToken) {
      return false;
    }

    try {
      setLoading(true);
      const response = await authAPI.refreshToken(refreshToken);
      const { accessToken: newAccessToken, refreshToken: newRefreshToken } = response.data;
      
      // ìƒˆ í† í°ë“¤ ì €ì¥
      setTokens(newAccessToken, newRefreshToken);
      
      return true;
    } catch (error) {
      console.error('Token refresh failed:', error);
      
      // ë¦¬í”„ë ˆì‹œ í† í°ë„ ë§Œë£Œëœ ê²½ìš° ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
      if (error instanceof ApiError && [401, 403].includes(error.status)) {
        clearAuth();
        queryClient.clear();
        window.location.href = '/login';
      }
      
      return false;
    } finally {
      setLoading(false);
    }
  }, [refreshToken, setTokens, clearAuth, queryClient, setLoading]);

  /**
   * í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸ ë° ê°±ì‹  ìŠ¤ì¼€ì¤„ë§
   */
  useEffect(() => {
    if (!accessToken || !refreshToken) {
      return;
    }

    const scheduleTokenRefresh = () => {
      try {
        // JWT í† í° ë””ì½”ë”©
        const payload = JSON.parse(atob(accessToken.split('.')[1]));
        const expiryTime = payload.exp * 1000; // ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
        const currentTime = Date.now();
        
        // ë§Œë£Œ 5ë¶„ ì „ì— ê°±ì‹ 
        const REFRESH_MARGIN = 5 * 60 * 1000; // 5ë¶„
        const timeUntilRefresh = expiryTime - currentTime - REFRESH_MARGIN;

        if (timeUntilRefresh > 0) {
          // í† í° ê°±ì‹  ìŠ¤ì¼€ì¤„ë§
          const timeoutId = setTimeout(() => {
            refreshAccessToken();
          }, timeUntilRefresh);

          return () => clearTimeout(timeoutId);
        } else {
          // ì´ë¯¸ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ê³§ ë§Œë£Œë  ì˜ˆì •ì´ë©´ ì¦‰ì‹œ ê°±ì‹ 
          refreshAccessToken();
        }
      } catch (error) {
        console.error('Invalid token format:', error);
        clearAuth();
      }
    };

    return scheduleTokenRefresh();
  }, [accessToken, refreshToken, refreshAccessToken, clearAuth]);

  /**
   * ì•± ì´ˆê¸° ë¡œë“œ ì‹œ í† í° ìƒíƒœ í™•ì¸
   */
  useEffect(() => {
    // localStorageì—ì„œ ë³µì›ëœ refreshTokenì´ ìˆì§€ë§Œ accessTokenì´ ì—†ëŠ” ê²½ìš°
    if (refreshToken && !accessToken) {
      refreshAccessToken();
    }
  }, [refreshToken, accessToken, refreshAccessToken]);

  return {
    refreshAccessToken,
  };
};
```

---

## ğŸ›¡ï¸ **5ë‹¨ê³„: ë¼ìš°íŠ¸ ë³´í˜¸ ì‹œìŠ¤í…œ**

### `src/components/features/auth/ProtectedRoute.tsx` ë³´ì™„
```typescript
import { ReactNode, useEffect } from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { Layout, Loading } from '@/components/common';
import { useAuth } from '@/hooks/useAuth';
import { useAuthStore } from '@/stores/authStore';

interface ProtectedRouteProps {
  children: ReactNode;
  requiredRole?: 'admin' | 'user';
}

/**
 * ì¸ì¦ì´ í•„ìš”í•œ ë¼ìš°íŠ¸ë¥¼ ë³´í˜¸í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
 */
export const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ 
  children, 
  requiredRole 
}) => {
  const location = useLocation();
  const { isAuthenticated, user, isLoading } = useAuth();
  const { accessToken } = useAuthStore();

  // ë¡œë”© ì¤‘ì¼ ë•Œ
  if (isLoading || (!user && accessToken)) {
    return (
      <Layout>
        <div className="flex items-center justify-center min-h-[400px]">
          <Loading size="lg" text="ì¸ì¦ í™•ì¸ ì¤‘..." />
        </div>
      </Layout>
    );
  }

  // ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš°
  if (!isAuthenticated) {
    return (
      <Navigate 
        to="/login" 
        state={{ from: location }} 
        replace 
      />
    );
  }

  // ê¶Œí•œ í™•ì¸ (ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´)
  if (requiredRole && user?.role !== requiredRole) {
    return (
      <Layout>
        <div className="flex items-center justify-center min-h-[400px]">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-red-600">ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ</h2>
            <p className="text-muted-foreground mt-2">
              ì´ í˜ì´ì§€ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </Layout>
    );
  }

  return <Layout>{children}</Layout>;
};
```

### `src/components/features/auth/PublicRoute.tsx` ë³´ì™„
```typescript
import { ReactNode } from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '@/hooks/useAuth';
import { Loading } from '@/components/common';

interface PublicRouteProps {
  children: ReactNode;
}

/**
 * ë¹„ì¸ì¦ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¼ìš°íŠ¸ (ë¡œê·¸ì¸ í˜ì´ì§€ ë“±)
 */
export const PublicRoute: React.FC<PublicRouteProps> = ({ children }) => {
  const { isAuthenticated, isLoading } = useAuth();

  // ë¡œë”© ì¤‘ì¼ ë•Œ
  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Loading size="lg" text="ë¡œë”© ì¤‘..." />
      </div>
    );
  }

  // ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ìëŠ” ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  if (isAuthenticated) {
    return <Navigate to="/dashboard" replace />;
  }

  return <>{children}</>;
};
```

---

## ğŸ“ **6ë‹¨ê³„: ë¡œê·¸ì¸ í˜ì´ì§€ êµ¬í˜„**

### `src/pages/LoginPage.tsx` ì™„ì „ êµ¬í˜„
```typescript
import { useState, useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Eye, EyeOff, LogIn, AlertCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { useAuth } from '@/hooks/useAuth';
import { ApiError } from '@/services/api/client';
import { APP_NAME } from '@/utils/constants';

/**
 * ë¡œê·¸ì¸ í¼ ìŠ¤í‚¤ë§ˆ
 */
const loginSchema = z.object({
  email: z
    .string()
    .min(1, 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
    .email('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤'),
  password: z
    .string()
    .min(1, 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'),
});

type LoginFormData = z.infer<typeof loginSchema>;

/**
 * ë¡œê·¸ì¸ í˜ì´ì§€
 */
export const LoginPage: React.FC = () => {
  const [showPassword, setShowPassword] = useState(false);
  const [alertMessage, setAlertMessage] = useState<string>('');
  const location = useLocation();
  
  const { 
    login, 
    isLoggingIn, 
    loginError,
    requestPasswordReset,
    isRequestingReset,
    resetRequestError
  } = useAuth();

  const {
    register,
    handleSubmit,
    formState: { errors },
    setFocus,
  } = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
  });

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë©”ì¼ í•„ë“œì— í¬ì»¤ìŠ¤
  useEffect(() => {
    setFocus('email');
  }, [setFocus]);

  // ë¡œê·¸ì¸ í˜ì´ì§€ ì§„ì… ì‹œ ë©”ì‹œì§€ í‘œì‹œ
  useEffect(() => {
    const state = location.state as any;
    if (state?.message) {
      setAlertMessage(state.message);
    }
  }, [location.state]);

  /**
   * ë¡œê·¸ì¸ ì²˜ë¦¬
   */
  const onSubmit = (data: LoginFormData) => {
    setAlertMessage('');
    login(data);
  };

  /**
   * ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­
   */
  const handlePasswordReset = async () => {
    const email = (document.getElementById('email') as HTMLInputElement)?.value;
    
    if (!email) {
      setAlertMessage('ì´ë©”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      await requestPasswordReset(email);
      setAlertMessage('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ì´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      setAlertMessage('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  /**
   * ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
   */
  const getErrorMessage = () => {
    if (alertMessage) return alertMessage;
    if (loginError instanceof ApiError) {
      return loginError.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
    }
    if (resetRequestError instanceof ApiError) {
      return resetRequestError.message || 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
    }
    return '';
  };

  const errorMessage = getErrorMessage();

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <Card className="w-full max-w-md">
        <CardHeader className="space-y-1">
          <div className="flex items-center justify-center mb-4">
            <div className="w-12 h-12 bg-primary rounded-lg flex items-center justify-center">
              <LogIn className="w-6 h-6 text-primary-foreground" />
            </div>
          </div>
          <CardTitle className="text-2xl text-center">
            {APP_NAME}
          </CardTitle>
          <p className="text-center text-muted-foreground">
            ê³„ì •ì— ë¡œê·¸ì¸í•˜ì„¸ìš”
          </p>
        </CardHeader>
        
        <CardContent>
          {errorMessage && (
            <Alert variant="destructive" className="mb-4">
              <AlertCircle className="h-4 w-4" />
              <AlertDescription>{errorMessage}</AlertDescription>
            </Alert>
          )}

          <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="email">ì´ë©”ì¼</Label>
              <Input
                id="email"
                type="email"
                placeholder="name@company.com"
                disabled={isLoggingIn}
                {...register('email')}
              />
              {errors.email && (
                <p className="text-sm text-red-600">{errors.email.message}</p>
              )}
            </div>

            <div className="space-y-2">
              <Label htmlFor="password">ë¹„ë°€ë²ˆí˜¸</Label>
              <div className="relative">
                <Input
                  id="password"
                  type={showPassword ? 'text' : 'password'}
                  placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                  disabled={isLoggingIn}
                  {...register('password')}
                />
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent"
                  onClick={() => setShowPassword(!showPassword)}
                  disabled={isLoggingIn}
                >
                  {showPassword ? (
                    <EyeOff className="h-4 w-4" />
                  ) : (
                    <Eye className="h-4 w-4" />
                  )}
                </Button>
              </div>
              {errors.password && (
                <p className="text-sm text-red-600">{errors.password.message}</p>
              )}
            </div>

            <Button
              type="submit"
              className="w-full"
              disabled={isLoggingIn}
            >
              {isLoggingIn ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2" />
                  ë¡œê·¸ì¸ ì¤‘...
                </>
              ) : (
                'ë¡œê·¸ì¸'
              )}
            </Button>
          </form>

          <div className="mt-4 text-center">
            <Button
              variant="link"
              size="sm"
              onClick={handlePasswordReset}
              disabled={isRequestingReset}
              className="text-sm text-muted-foreground hover:text-primary"
            >
              {isRequestingReset ? 'ì²˜ë¦¬ ì¤‘...' : 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?'}
            </Button>
          </div>

          <div className="mt-6 text-center text-xs text-muted-foreground">
            <p>ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”</p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};
```

---

## ğŸ”§ **7ë‹¨ê³„: í”„ë¡œí•„ ë° ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬**

### `src/components/features/auth/ChangePasswordDialog.tsx`
```typescript
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Eye, EyeOff, Lock } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { useAuth } from '@/hooks/useAuth';
import { ApiError } from '@/services/api/client';

/**
 * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìŠ¤í‚¤ë§ˆ
 */
const changePasswordSchema = z.object({
  currentPassword: z.string().min(1, 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'),
  newPassword: z
    .string()
    .min(8, 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤')
    .regex(
      /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,
      'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤'
    ),
  confirmPassword: z.string().min(1, 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'),
}).refine(
  (data) => data.newPassword === data.confirmPassword,
  {
    message: 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
    path: ['confirmPassword'],
  }
);

type ChangePasswordFormData = z.infer<typeof changePasswordSchema>;

/**
 * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë‹¤ì´ì–¼ë¡œê·¸
 */
export const ChangePasswordDialog: React.FC = () => {
  const [open, setOpen] = useState(false);
  const [showPasswords, setShowPasswords] = useState({
    current: false,
    new: false,
    confirm: false,
  });

  const { changePassword, isChangingPassword, changePasswordError } = useAuth();

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<ChangePasswordFormData>({
    resolver: zodResolver(changePasswordSchema),
  });

  /**
   * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì²˜ë¦¬
   */
  const onSubmit = async (data: ChangePasswordFormData) => {
    try {
      await changePassword(data);
      setOpen(false);
      reset();
    } catch (error) {
      // ì—ëŸ¬ëŠ” useAuthì—ì„œ ì²˜ë¦¬ë¨
    }
  };

  /**
   * ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
   */
  const handleClose = () => {
    setOpen(false);
    reset();
  };

  /**
   * ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
   */
  const togglePasswordVisibility = (field: keyof typeof showPasswords) => {
    setShowPasswords(prev => ({
      ...prev,
      [field]: !prev[field],
    }));
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button variant="outline" size="sm">
          <Lock className="h-4 w-4 mr-2" />
          ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        </Button>
      </DialogTrigger>
      
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</DialogTitle>
          <DialogDescription>
            ë³´ì•ˆì„ ìœ„í•´ ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.
          </DialogDescription>
        </DialogHeader>

        {changePasswordError && (
          <Alert variant="destructive">
            <AlertDescription>
              {changePasswordError instanceof ApiError 
                ? changePasswordError.message 
                : 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}
            </AlertDescription>
          </Alert>
        )}

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          {/* í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ */}
          <div className="space-y-2">
            <Label htmlFor="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</Label>
            <div className="relative">
              <Input
                id="currentPassword"
                type={showPasswords.current ? 'text' : 'password'}
                disabled={isChangingPassword}
                {...register('currentPassword')}
              />
              <Button
                type="button"
                variant="ghost"
                size="sm"
                className="absolute right-0 top-0 h-full px-3"
                onClick={() => togglePasswordVisibility('current')}
              >
                {showPasswords.current ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
              </Button>
            </div>
            {errors.currentPassword && (
              <p className="text-sm text-red-600">{errors.currentPassword.message}</p>
            )}
          </div>

          {/* ìƒˆ ë¹„ë°€ë²ˆí˜¸ */}
          <div className="space-y-2">
            <Label htmlFor="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</Label>
            <div className="relative">
              <Input
                id="newPassword"
                type={showPasswords.new ? 'text' : 'password'}
                disabled={isChangingPassword}
                {...register('newPassword')}
              />
              <Button
                type="button"
                variant="ghost"
                size="sm"
                className="absolute right-0 top-0 h-full px-3"
                onClick={() => togglePasswordVisibility('new')}
              >
                {showPasswords.new ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
              </Button>
            </div>
            {errors.newPassword && (
              <p className="text-sm text-red-600">{errors.newPassword.message}</p>
            )}
          </div>

          {/* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */}
          <div className="space-y-2">
            <Label htmlFor="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</Label>
            <div className="relative">
              <Input
                id="confirmPassword"
                type={showPasswords.confirm ? 'text' : 'password'}
                disabled={isChangingPassword}
                {...register('confirmPassword')}
              />
              <Button
                type="button"
                variant="ghost"
                size="sm"
                className="absolute right-0 top-0 h-full px-3"
                onClick={() => togglePasswordVisibility('confirm')}
              >
                {showPasswords.confirm ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
              </Button>
            </div>
            {errors.confirmPassword && (
              <p className="text-sm text-red-600">{errors.confirmPassword.message}</p>
            )}
          </div>

          {/* ë²„íŠ¼ë“¤ */}
          <div className="flex justify-end gap-2 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={handleClose}
              disabled={isChangingPassword}
            >
              ì·¨ì†Œ
            </Button>
            <Button type="submit" disabled={isChangingPassword}>
              {isChangingPassword ? 'ë³€ê²½ ì¤‘...' : 'ë³€ê²½í•˜ê¸°'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
};
```

### `src/pages/ProfilePage.tsx` êµ¬í˜„
```typescript
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { User, Mail, Calendar, Shield } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { PageTitle } from '@/components/common';
import { ChangePasswordDialog } from '@/components/features/auth/ChangePasswordDialog';
import { useAuth } from '@/hooks/useAuth';
import { usersAPI } from '@/services/api/users';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/lib/queryClient';

/**
 * í”„ë¡œí•„ ìˆ˜ì • ìŠ¤í‚¤ë§ˆ
 */
const profileSchema = z.object({
  name: z.string().min(2, 'ì´ë¦„ì€ ìµœì†Œ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤'),
});

type ProfileFormData = z.infer<typeof profileSchema>;

/**
 * í”„ë¡œí•„ í˜ì´ì§€
 */
export const ProfilePage: React.FC = () => {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  const [isEditing, setIsEditing] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
    setValue,
  } = useForm<ProfileFormData>({
    resolver: zodResolver(profileSchema),
    defaultValues: {
      name: user?.name || '',
    },
  });

  // í”„ë¡œí•„ ìˆ˜ì • ë®¤í…Œì´ì…˜
  const updateProfileMutation = useMutation({
    mutationFn: async (data: ProfileFormData) => {
      const response = await usersAPI.updateProfile(data);
      return response.data;
    },
    onSuccess: (updatedUser) => {
      // ì‚¬ìš©ì ì •ë³´ ìºì‹œ ì—…ë°ì´íŠ¸
      queryClient.setQueryData(queryKeys.auth.me, updatedUser);
      setIsEditing(false);
    },
  });

  /**
   * í”„ë¡œí•„ ìˆ˜ì • ì²˜ë¦¬
   */
  const onSubmit = (data: ProfileFormData) => {
    updateProfileMutation.mutate(data);
  };

  /**
   * ìˆ˜ì • ì·¨ì†Œ
   */
  const handleCancel = () => {
    reset({ name: user?.name || '' });
    setIsEditing(false);
  };

  if (!user) {
    return null;
  }

  return (
    <div className="space-y-6">
      <PageTitle 
        title="ë‚´ í”„ë¡œí•„" 
        description="ê³„ì • ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" 
      />

      <div className="grid gap-6">
        {/* ê¸°ë³¸ ì •ë³´ */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <User className="h-5 w-5" />
              ê¸°ë³¸ ì •ë³´
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
              <div className="grid gap-4 md:grid-cols-2">
                {/* ì´ë¦„ */}
                <div className="space-y-2">
                  <Label htmlFor="name">ì´ë¦„</Label>
                  {isEditing ? (
                    <Input
                      id="name"
                      disabled={updateProfileMutation.isPending}
                      {...register('name')}
                    />
                  ) : (
                    <div className="px-3 py-2 border rounded-md bg-muted">
                      {user.name}
                    </div>
                  )}
                  {errors.name && (
                    <p className="text-sm text-red-600">{errors.name.message}</p>
                  )}
                </div>

                {/* ì´ë©”ì¼ (ì½ê¸° ì „ìš©) */}
                <div className="space-y-2">
                  <Label>ì´ë©”ì¼</Label>
                  <div className="px-3 py-2 border rounded-md bg-muted flex items-center gap-2">
                    <Mail className="h-4 w-4 text-muted-foreground" />
                    {user.email}
                  </div>
                </div>
              </div>

              {/* ë²„íŠ¼ë“¤ */}
              <div className="flex gap-2">
                {isEditing ? (
                  <>
                    <Button
                      type="submit"
                      disabled={updateProfileMutation.isPending}
                    >
                      {updateProfileMutation.isPending ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
                    </Button>
                    <Button
                      type="button"
                      variant="outline"
                      onClick={handleCancel}
                      disabled={updateProfileMutation.isPending}
                    >
                      ì·¨ì†Œ
                    </Button>
                  </>
                ) : (
                  <Button onClick={() => setIsEditing(true)}>
                    ìˆ˜ì •
                  </Button>
                )}
              </div>
            </form>
          </CardContent>
        </Card>

        {/* ê³„ì • ì •ë³´ */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Shield className="h-5 w-5" />
              ê³„ì • ì •ë³´
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="grid gap-4 md:grid-cols-2">
              {/* ì—­í•  */}
              <div className="space-y-2">
                <Label>ì—­í• </Label>
                <div className="flex items-center gap-2">
                  <Badge variant={user.role === 'admin' ? 'default' : 'secondary'}>
                    {user.role === 'admin' ? 'ê´€ë¦¬ì' : 'ì‚¬ìš©ì'}
                  </Badge>
                </div>
              </div>

              {/* ê°€ì…ì¼ */}
              <div className="space-y-2">
                <Label>ê°€ì…ì¼</Label>
                <div className="px-3 py-2 border rounded-md bg-muted flex items-center gap-2">
                  <Calendar className="h-4 w-4 text-muted-foreground" />
                  {new Date(user.createdAt).toLocaleDateString('ko-KR')}
                </div>
              </div>
            </div>

            <Separator />

            {/* ë³´ì•ˆ ì„¤ì • */}
            <div className="space-y-4">
              <h3 className="text-sm font-medium">ë³´ì•ˆ ì„¤ì •</h3>
              <div className="flex gap-2">
                <ChangePasswordDialog />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
};
```

---

## ğŸ” **8ë‹¨ê³„: API ì¸í„°ì…‰í„° ì„¤ì •**

### `src/services/api/client.ts` ì¸í„°ì…‰í„° ì¶”ê°€
```typescript
// ê¸°ì¡´ ì½”ë“œì— ì¶”ê°€

/**
 * ì‘ë‹µ ì¸í„°ì…‰í„°ë¡œ í† í° ë§Œë£Œ ì²˜ë¦¬
 */
export const setupAuthInterceptor = () => {
  const originalRequest = apiClient.request;
  
  apiClient.request = async function<T>(
    endpoint: string, 
    options: RequestOptions = {}
  ): Promise<ApiResponse<T>> {
    try {
      return await originalRequest.call(this, endpoint, options);
    } catch (error) {
      if (error instanceof ApiError && error.status === 401) {
        // í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  ì‹œë„
        const { useAuthStore } = await import('@/stores/authStore');
        const { refreshToken, clearAuth } = useAuthStore.getState();
        
        if (refreshToken) {
          try {
            const { authAPI } = await import('./auth');
            const response = await authAPI.refreshToken(refreshToken);
            const { accessToken: newAccessToken, refreshToken: newRefreshToken } = response.data;
            
            // ìƒˆ í† í°ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            useAuthStore.getState().setTokens(newAccessToken, newRefreshToken);
            
            // ì›ë˜ ìš”ì²­ ì¬ì‹œë„
            return await originalRequest.call(this, endpoint, options);
          } catch (refreshError) {
            // ë¦¬í”„ë ˆì‹œ í† í°ë„ ë§Œë£Œëœ ê²½ìš° ë¡œê·¸ì•„ì›ƒ
            clearAuth();
            window.location.href = '/login';
            throw refreshError;
          }
        } else {
          // ë¦¬í”„ë ˆì‹œ í† í°ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ
          clearAuth();
          window.location.href = '/login';
        }
      }
      
      throw error;
    }
  };
};
```

---

## ğŸš€ **9ë‹¨ê³„: ì•± ì´ˆê¸°í™” ë° í†µí•©**

### `src/App.tsx` ìµœì¢… ì—…ë°ì´íŠ¸
```typescript
import { useEffect } from 'react';
import { AppRouter } from '@/lib/router';
import { ErrorBoundary, ConnectionStatus } from '@/components/common';
import { InstallPrompt } from '@/components/common/InstallPrompt';
import { UpdatePrompt } from '@/components/common/UpdatePrompt';
import { OfflineIndicator } from '@/components/common/OfflineIndicator';
import { PWADebugPanel } from '@/components/dev/PWADebugPanel';
import { useTokenRefresh } from '@/hooks/useTokenRefresh';
import { useWebSocket } from '@/hooks/useWebSocket';
import { useRealtimeReservations } from '@/hooks/useRealtimeReservations';
import { useRealtimeRooms } from '@/hooks/useRealtimeRooms';
import { useOfflineSupport } from '@/hooks/useOfflineSupport';
import { useAuth } from '@/hooks/useAuth';
import { setupAuthInterceptor } from '@/services/api/client';
import '@/styles/globals.css';

function App() {
  // API ì¸í„°ì…‰í„° ì„¤ì •
  useEffect(() => {
    setupAuthInterceptor();
  }, []);

  // í† í° ìë™ ê°±ì‹ 
  useTokenRefresh();
  
  // WebSocket ì—°ê²° (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ)
  const { isAuthenticated } = useAuth();
  useWebSocket();
  
  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë… (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ)
  if (isAuthenticated) {
    useRealtimeReservations();
    useRealtimeRooms();
  }
  
  // ì˜¤í”„ë¼ì¸ ì§€ì›
  useOfflineSupport();

  return (
    <ErrorBoundary>
      {/* PWA ìƒíƒœ í‘œì‹œ */}
      <ConnectionStatus />
      <OfflineIndicator />
      
      {/* ë©”ì¸ ì•± */}
      <AppRouter />
      
      {/* PWA í”„ë¡¬í”„íŠ¸ë“¤ */}
      <InstallPrompt />
      <UpdatePrompt />
      
      {/* ê°œë°œ ë„êµ¬ */}
      <PWADebugPanel />
    </ErrorBoundary>
  );
}

export default App;
```

### `src/lib/router.tsx` ì¸ì¦ ë¼ìš°íŒ… ì—…ë°ì´íŠ¸
```typescript
import { createBrowserRouter, RouterProvider, Navigate } from 'react-router-dom';
import { ErrorBoundary } from '@/components/common';
import { ProtectedRoute, PublicRoute } from '@/components/features/auth';
import {
  LoginPage,
  DashboardPage,
  RoomsPage,
  RoomDetailPage,
  ReservationsPage,
  NewReservationPage,
  ReservationDetailPage,
  MyReservationsPage,
  ProfilePage,
  NotFoundPage,
} from '@/pages';

/**
 * ë¼ìš°í„° ì„¤ì •
 */
const router = createBrowserRouter([
  {
    path: '/',
    element: <Navigate to="/dashboard" replace />,
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/login',
    element: (
      <PublicRoute>
        <LoginPage />
      </PublicRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/dashboard',
    element: (
      <ProtectedRoute>
        <DashboardPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/rooms',
    element: (
      <ProtectedRoute>
        <RoomsPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/rooms/:id',
    element: (
      <ProtectedRoute>
        <RoomDetailPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/reservations',
    element: (
      <ProtectedRoute requiredRole="admin">
        <ReservationsPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/reservations/new',
    element: (
      <ProtectedRoute>
        <NewReservationPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/reservations/:id',
    element: (
      <ProtectedRoute>
        <ReservationDetailPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/my-reservations',
    element: (
      <ProtectedRoute>
        <MyReservationsPage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/profile',
    element: (
      <ProtectedRoute>
        <ProfilePage />
      </ProtectedRoute>
    ),
    errorElement: <ErrorBoundary />,
  },
  {
    path: '/404',
    element: <NotFoundPage />,
    errorElement: <ErrorBoundary />,
  },
  {
    path: '*',
    element: <Navigate to="/404" replace />,
  },
]);

/**
 * ì•± ë¼ìš°í„° ì»´í¬ë„ŒíŠ¸
 */
export const AppRouter: React.FC = () => {
  return <RouterProvider router={router} />;
};
```

---

## ğŸ›¡ï¸ **10ë‹¨ê³„: ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**

### `src/utils/security.ts`
```typescript
/**
 * ë³´ì•ˆ ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
 */

/**
 * JWT í† í° ìœ íš¨ì„± ê²€ì‚¬
 */
export const isValidJWT = (token: string): boolean => {
  try {
    const parts = token.split('.');
    if (parts.length !== 3) return false;
    
    const payload = JSON.parse(atob(parts[1]));
    const now = Date.now() / 1000;
    
    return payload.exp > now;
  } catch {
    return false;
  }
};

/**
 * í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
 */
export const getTokenExpiry = (token: string): number | null => {
  try {
    const payload = JSON.parse(atob(token.split('.')[1]));
    return payload.exp * 1000; // ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
  } catch {
    return null;
  }
};

/**
 * ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì‚¬
 */
export const validatePasswordStrength = (password: string): {
  isValid: boolean;
  errors: string[];
} => {
  const errors: string[] = [];
  
  if (password.length < 8) {
    errors.push('ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤');
  }
  
  if (!/[a-z]/.test(password)) {
    errors.push('ì†Œë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤');
  }
  
  if (!/[A-Z]/.test(password)) {
    errors.push('ëŒ€ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤');
  }
  
  if (!/\d/.test(password)) {
    errors.push('ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤');
  }
  
  if (!/[@$!%*?&]/.test(password)) {
    errors.push('íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤');
  }
  
  return {
    isValid: errors.length === 0,
    errors,
  };
};

/**
 * XSS ë°©ì§€ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ ì´ìŠ¤ì¼€ì´í”„
 */
export const escapeHtml = (text: string): string => {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
};
```
