**✨ Flavor Point: AI 바이브 코딩 개발 가이드 ✨**

**1. 🚀 프로젝트 개요**

*   **프로젝트명:** Flavor Point (플레이버 포인트) 🍽️🍹
*   **한 줄 요약:** AI 기반 개인 맞춤형 음식/음료 취향 분석 및 추천 서비스 (Google Cloud ☁️ & Flutter 🐦 기반)
*   **문서 목적:** 이 문서는 기획 문서에 명시된 기술 스택 및 추가 요구사항을 기반으로, AI 코딩 어시스턴트 🤖가 "Flavor Point" 애플리케이션의 프론트엔드 및 백엔드 코드를 효율적으로 생성할 수 있도록 상세한 지침과 명세를 제공하는 것을 목표로 합니다.

**2. 📱 프론트엔드 개발 가이드 (Flutter with Material Design)**

*   **2.1. 🛠️ 기술 스택**
    *   **프레임워크:** Flutter (iOS & Android 통합 개발)
    *   **언어:** Dart
    *   **상태 관리:** Provider 또는 Riverpod (AI가 프로젝트 구조에 더 적합한 패턴 선택 또는 기획 선호도 따름)
    *   **API 클라이언트:** `http` 패키지 또는 `Dio` (날씨 API 및 백엔드 API 호출용)
    *   **UI 디자인:** Material Design 3 (머티리얼 컴포넌트 적극 활용, 인스타그램 스타일)
    *   **인증 연동:** `firebase_auth` (Firebase Auth)
    *   **로컬 저장소:** `shared_preferences` (간단한 설정), `sqflite` (로컬 DB 필요시), 또는 Firestore 오프라인 캐시 활용
    *   **위치 서비스:** `geolocator` (날씨 정보 및 기록 위치용)
    *   **이미지 처리:** `image_picker` (갤러리/카메라 접근), `firebase_storage` (이미지 업로드)
    *   **날씨 API:** Open-Meteo ☀️ (API 키 없이 사용 가능, 예: `https://api.open-meteo.com/v1/forecast`)

*   **2.2. 💻 로컬 개발 환경 설정**
    1.  Flutter SDK 설치 (공식 문서 가이드라인 따름).
    2.  Android Studio 또는 VS Code 등 개발 IDE 설정 (Flutter 및 Dart 플러그인 설치).
    3.  Firebase CLI 설치 및 프로젝트 연동 설정 (`firebase login`, `firebase projects:list`).
    4.  `flutter doctor` 명령어로 개발 환경 진단 및 문제 해결 🩺.
    5.  새 Flutter 프로젝트 생성: `flutter create flavor_point_app`
    6.  `pubspec.yaml` 파일에 필요한 의존성 추가:
        ```yaml
        dependencies:
          flutter:
            sdk: flutter
          # UI & Core
          material_color_utilities: ^[latest_version] # Material 3 색상 유틸리티 (선택적)
          # Networking
          http: ^[latest_version] # 또는 dio
          # State Management
          provider: ^[latest_version] # 또는 riverpod, flutter_bloc
          # Firebase
          firebase_core: ^[latest_version]
          firebase_auth: ^[latest_version]
          cloud_firestore: ^[latest_version]
          firebase_storage: ^[latest_version]
          # Authentication
          google_sign_in: ^[latest_version] # Google 로그인 사용 시
          # sign_in_with_apple: ^[latest_version] # Apple 로그인 사용 시 (iOS)
          # Utilities
          image_picker: ^[latest_version]
          geolocator: ^[latest_version]
          intl: ^[latest_version] # 날짜/시간 포맷팅 (날씨, 기록 시간 등)
          # shared_preferences: ^[latest_version]

        dev_dependencies:
          flutter_lints: ^[latest_version]
        ```
    7.  Firebase 프로젝트 설정 파일을 Flutter 프로젝트에 추가 (android/app/google-services.json, ios/Runner/GoogleService-Info.plist).
        *   **🤖 AI 코딩 지시사항:** "Firebase 프로젝트 설정 및 `firebase_core` 초기화 코드를 `lib/main.dart`에 안전하게 추가해주세요."

*   **2.3. 📁 디렉토리 구조 (제안)**
    ```
    flavor_point_app/
    ├── lib/
    │   ├── main.dart            # 앱 진입점, Firebase 초기화, 기본 라우팅 🚦
    │   ├── core/                # 앱 전반 핵심 로직, 상수, 유틸리티 的核心
    │   │   ├── services/        # api_service.dart, weather_service.dart, location_service.dart 🛰️
    │   │   ├── models/          # user_model.dart, record_model.dart, weather_model.dart 📄
    │   │   ├── providers/       # auth_provider.dart, feed_provider.dart, weather_provider.dart 🧠
    │   │   ├── theme/           # app_theme.dart (Material 3 테마 설정 🎨)
    │   │   └── utils/           # 공통 유틸리티 함수 🛠️
    │   ├── features/            # 기능별 모듈 🧩
    │   │   ├── common_widgets/  # 앱 전역 공통 위젯 (예: CustomAppBar, BottomNavBar) 🏗️
    │   │   ├── splash/          # 스플래시 화면 💦
    │   │   │   └── splash_screen.dart
    │   │   ├── auth/            # 인증 관련 (로그인, 회원가입) 🔑
    │   │   ├── feed/            # 피드 (목록, 상세, 생성/편집) 📰
    │   │   │   ├── screens/     # feed_list_screen.dart, feed_detail_screen.dart, record_form_screen.dart
    │   │   │   └── widgets/     # record_card.dart
    │   │   ├── mypage/          # 마이페이지 👤
    │   │   │   └── screens/     # mypage_screen.dart
    │   │   └── recommendation/  # 추천 (기획서 기반) 💡
    │   ├── navigation/          # 라우팅 설정 (GoRouter 또는 Navigator 2.0) - main.dart에 통합 가능 🗺️
    └── pubspec.yaml
    ```
    *   **🤖 AI 코딩 지시사항:** "제안된 디렉토리 구조에 따라 초기 폴더 및 기본 파일들을 생성해주세요. 상태 관리 패턴(예: Provider)을 선택하고 관련 폴더 구조도 반영해주세요."

*   **2.4. 🎨 UI 스타일 가이드: 인스타그램 클론 (Material Design 기반)**
    *   **전반적 스타일:** 깔끔하고 현대적인 느낌 ✨. 이미지 콘텐츠 강조 🖼️. Material 3 컴포넌트 및 디자인 원칙 적극 활용.
    *   **Header (AppBar):** 🔝
        *   `FeedListScreen`: 좌측에 "Flavor Point" 텍스트 로고 또는 앱 아이콘, 우측에 액션 아이콘 (예: 알림 - MVP에서는 생략 가능 🔔).
        *   다른 화면: 화면 제목과 필요한 액션 버튼 (예: 뒤로가기 ⬅️, 설정 ⚙️).
        *   **🤖 AI 코딩 지시사항:** "재사용 가능한 `CustomAppBar` 위젯을 `lib/features/common_widgets/`에 생성하고, 화면별로 커스터마이징 가능하도록 설계해주세요. Material 3 스타일을 적용해주세요."
    *   **Footer (BottomNavigationBar):** ତଳ
        *   아이콘 기반 탭: 홈(Feed List 🏠), 기록 추가 ➕, 추천 💡, 마이페이지 👤.
        *   선택된 탭 강조. Material 3의 `NavigationBar` 위젯 사용.
        *   **🤖 AI 코딩 지시사항:** "앱의 주요 섹션으로 이동하는 `BottomNavigationBar`를 `lib/features/common_widgets/`에 구현해주세요. 각 탭은 아이콘과 함께 표시되며, Material 3 스타일을 따릅니다."
    *   **Feed List (HomeScreen/FeedListScreen):** 📜
        *   각 기록은 카드(Card) 형태 또는 인스타그램 포스트와 유사한 레이아웃으로 표시.
        *   주요 정보: 이미지, 음식/음료 이름, 사용자 별점 ⭐, 간략한 맛 표현 또는 사용자 닉네임.
        *   무한 스크롤 또는 페이지네이션 구현.
        *   **🤖 AI 코딩 지시사항:** "Firestore에서 기록 목록을 가져와 `ListView.builder` 또는 `GridView.builder`를 사용하여 인스타그램 피드 스타일로 표시하는 `FeedListScreen`을 구현해주세요. 각 아이템은 `RecordCard` 위젯을 사용합니다."
    *   **Feed Detail (RecordDetailScreen):** 🧐
        *   선택된 기록의 모든 정보 표시 (이미지 크게, 전체 맛 표현, 위치 정보 등).
        *   수정/삭제 옵션 (작성자 본인일 경우 ✏️🗑️).
    *   **Mypage (MyPageScreen):** 🖼️👤
        *   상단에 사용자 프로필 정보 (프로필 이미지, 닉네임).
        *   하단에 해당 사용자가 작성한 기록들을 그리드 형태로 표시 (인스타그램 프로필의 사진첩처럼).
        *   설정, 로그아웃 버튼.
        *   **🤖 AI 코딩 지시사항:** "사용자 프로필 정보와 함께 사용자가 작성한 기록들을 그리드 뷰로 보여주는 `MyPageScreen`을 구현해주세요. 인스타그램 프로필 페이지 스타일을 참고합니다."

*   **2.5. ✨ 주요 화면 및 기능 구현 가이드**
    *   **2.5.1. ☀️ 날씨 스플래시 화면 (`SplashScreen`)**
        *   **위치:** 앱 실행 시 가장 먼저 보이는 화면.
        *   **기능:**
            1.  앱 시작 시 위치 권한 요청 (`geolocator`).
            2.  권한 획득 시 현재 위치 기반으로 Open-Meteo API 호출하여 현재 날씨 정보(온도, 날씨 아이콘/설명) 가져오기 (`weather_service.dart`).
            3.  날씨 정보와 함께 앱 로고 또는 간단한 애니메이션 표시.
            4.  백그라운드에서 피드 리스트 데이터 로딩 시작 (`feed_provider.dart` 초기화).
            5.  최소 1초 동안 화면에 표시된 후, 피드 데이터 로딩 완료 시 홈 화면(FeedListScreen)으로 자동 전환. 두 조건 중 늦게 완료되는 시점에 전환. ⏳
        *   **UI:** 현재 날씨를 나타내는 아이콘 (예: ☀️, ☁️, 🌧️)과 온도, 간단한 메시지 (예: "오늘 [서울]의 날씨는 [맑음], °C 입니다."), 앱 로고.
        *   **🤖 AI 코딩 지시사항:** "`SplashScreen`을 `lib/features/splash/splash_screen.dart`에 구현해주세요. 이 화면은 최소 1초간 표시되며, 위치 기반 날씨 정보를 Open-Meteo API에서 가져와 보여주고, 동시에 메인 피드 데이터를 로딩한 후 홈 화면으로 이동합니다. 날씨 API 호출 및 데이터 파싱 로직은 `lib/core/services/weather_service.dart`에, 상태는 `lib/core/providers/weather_provider.dart`에 작성합니다."
    *   **2.5.2. 🔑 인증 (Auth)**
        *   **화면:** 로그인 화면, 회원가입 화면 (인스타그램 스타일 적용)
        *   **기능:** 이메일/비밀번호 가입 및 로그인, Google 로그인, Apple 로그인 (Firebase Auth 연동)
        *   **🤖 AI 코딩 지시사항:** "`firebase_auth` 패키지를 사용하여 인스타그램 스타일의 UI로 로그인/회원가입 기능을 `lib/features/auth/` 내에 구현해주세요."
    *   **2.5.3. 📝 음식/음료 기록 (Record)**
        *   **화면:** 기록 생성/편집 화면 (`RecordFormScreen`), 기록 목록 화면 (`FeedListScreen`), 기록 상세 화면 (`FeedDetailScreen`) (인스타그램 스타일 적용)
        *   **기능:**
            *   OCR 기능 연동 (`Google Cloud Vision OCR` 호출 - 백엔드 연동) 🔎
            *   데이터 Firestore에 저장/수정/삭제, 이미지 Firebase Storage에 업로드.
        *   **🤖 AI 코딩 지시사항 (OCR 연동):** "기록 생성 화면에서 사진 촬영/선택 후, '텍스트 추출' 버튼을 누르면 해당 이미지를 Cloud Function (OCR 호출용)으로 전송하고, 반환된 텍스트를 입력 필드에 채워주는 기능을 구현해주세요."
    *   **2.5.4. 💡 취향 프로필 및 추천 (Profile & Recommendation)**
        *   **화면:** 내 프로필 화면 (`MyPageScreen`), 추천 목록 화면 (인스타그램 스타일 적용)
        *   **기능:** Firestore에서 취향 분석 결과 및 추천 목록 조회/표시.

**3. ☁️ 백엔드 개발 가이드 (Google Cloud Functions, Firestore)**

*   **3.1. 🛠️ 기술 스택**
    *   **실행 환경:** Cloud Functions (Python 또는 Node.js - 기획서에 명시, Python 우선 고려)
    *   **데이터베이스:** Firestore (NoSQL 실시간 데이터베이스 🔥)
    *   **스토리지:** Cloud Storage (이미지 등 파일 저장 📦)
    *   **인증:** Firebase Auth (클라이언트에서 처리된 인증 정보 활용)
    *   **OCR 처리:** Google Cloud Vision API 👁️
    *   **콘텐츠 분석 (텍스트):** Google Cloud Natural Language API (선택적 활용 검토 🗣️)
    *   **추천 알고리즘 (향후):** Vertex AI 🧠
    *   **실시간 데이터 처리/이벤트:** Firestore 트리거, Pub/Sub 📨

*   **3.2. 💻 로컬 개발 환경 설정 (Cloud Functions)**
    1.  Google Cloud SDK 설치 및 초기화 (`gcloud init`). **(이 자체로 비용 발생 X, 실제 리소스 사용 시 발생)**
    2.  Firebase CLI 설치 (프론트엔드에서 설치했다면 생략 가능).
    3.  선택한 언어(Python/Node.js) 개발 환경 구성.
    4.  Firebase 로컬 에뮬레이터 스위트 사용: `firebase emulators:start` (로컬 테스트용 👍).
        *   **🤖 AI 코딩 지시사항:** "Firebase 로컬 에뮬레이터 스위트를 사용하여 Firestore, Functions, Auth를 로컬에서 테스트할 수 있도록 `firebase.json` 설정 및 실행 스크립트를 안내해주세요."

*   **3.3. ⚙️ 주요 Cloud Functions 구현 가이드**
    *   **3.3.1. OCR 처리 함수 (`processImageForOCR`)**
        *   **트리거:** HTTPS Callable Function (프론트엔드에서 직접 호출)
        *   **언어:** Python 권장
        *   **기능:** 이미지 수신 → Cloud Vision API 호출 → 추출 텍스트 반환.
        *   **🤖 AI 코딩 지시사항 (Python):** "Python으로 작성된 HTTPS Callable Cloud Function을 생성해주세요. 이 함수는 이미지 데이터를 받아 Google Cloud Vision API를 호출하여 OCR을 수행하고, 추출된 텍스트를 반환합니다. `google-cloud-vision` 라이브러리를 사용합니다."
    *   **3.3.2. 취향 분석 트리거 함수 (`analyzeUserTasteOnRecordChange`)**
        *   **트리거:** Firestore 트리거 (`records` 컬렉션의 문서 생성/수정/삭제 시)
        *   **기능:** 사용자 기록 기반 취향 분석 → `user_profiles`에 결과 업데이트. (MVP는 간단한 로직, 향후 Natural Language API 활용)
        *   **🤖 AI 코딩 지시사항 (Python):** "Firestore `records` 컬렉션에 대한 onCreate, onUpdate, onDelete 트리거를 가지는 Cloud Function을 Python으로 작성해주세요. 이 함수는 해당 유저의 모든 기록을 집계하여 간단한 키워드 분석 및 선호도 점수를 계산하고, 결과를 `user_profiles` 컬렉션에 저장/업데이트합니다."
    *   **3.3.3. 추천 생성 함수 (MVP 단계 또는 Vertex AI 연동 전)**
        *   **트리거:** `user_profiles` 업데이트 시 또는 스케줄된 함수
        *   **기능 (MVP):** 사용자 프로필 기반 + 아이템 목록 매칭 → `recommendations`에 추천 저장.
        *   **🤖 AI 코딩 지시사항:** "사용자의 취향 프로필이 업데이트될 때 트리거되는 Cloud Function을 작성해주세요. 이 함수는 (미리 정의된) 아이템 목록과 사용자 프로필을 비교하여 간단한 추천 목록을 생성하고 Firestore에 저장합니다."
        *   **Vertex AI 연동 (향후):** "Vertex AI Prediction Endpoint를 호출하여 추천 결과를 받아오는 Cloud Function을 설계해주세요."

*   **3.4. 🗃️ Firestore 데이터 모델 (제안)**
    *   `users/{user_id}`: 사용자 기본 정보 (Firebase Auth와 연동)
    *   `records/{record_id}`: 개별 음식/음료 기록 (`userId`, `itemName`, `category`, `rating`, `tasteDescription`, `imageUrl`, `ocrText` (선택), `locationName`, `locationGeoPoint`, `recordedAt`)
    *   `user_profiles/{user_id}`: 사용자 취향 프로필 (`preferredKeywords`, `dislikedKeywords`, `preferredCategories`, `lastAnalyzedAt`)
    *   `recommendations/{user_id}`: 사용자별 추천 목록 (`items` (array of maps), `generatedAt`)
    *   `(가정)` `food_items/{item_id}`: 추천 대상 아이템 목록 (MVP용) (`itemName`, `category`, `tags`)
    *   **🤖 AI 코딩 지시사항:** "위 Firestore 데이터 모델 구조를 기반으로 Flutter 앱에서 사용할 Dart 모델 클래스(`User`, `Record`, `TasteProfile`, `RecommendationItem`, `FoodItem`, `WeatherModel`)를 `lib/core/models/`에 생성해주세요. 직렬화/역직렬화 메서드(`fromJson`, `toJson`)를 포함해야 합니다."

**4. 🧪 로컬 테스트를 위한 목업(Mock) 개발 가이드**

*   **4.1. 🎯 목적**
    *   프론트엔드와 백엔드(Cloud Functions) 병행 개발.
    *   실제 클라우드 서비스 호출 없이 UI/UX 및 기본 로직 테스트.
*   **4.2. 📱 프론트엔드 목업**
    *   **상태 관리 활용:** 초기 상태에 목업 데이터 주입.
    *   **API 서비스 목업:** 개발 모드에서 API 호출 함수가 고정된 목업 데이터 반환.
        *   **날씨 서비스 목업:** `weather_service.dart`에서 개발 모드일 경우, 실제 API 호출 대신 고정된 날씨 데이터(예: 맑음 ☀️, 20°C)를 반환.
    *   **🤖 AI 코딩 지시사항 (Flutter):** "Flutter 개발 모드에서 `ApiService` 및 `WeatherService` 클래스가 실제 네트워크 호출 대신 하드코딩된 JSON 응답을 반환하도록 하는 목업 구현 예시를 작성해주세요."
*   **4.3. ☁️ 백엔드 목업 (Firebase 로컬 에뮬레이터 활용)**
    *   **Firestore 에뮬레이터:** 초기 목업 데이터를 에뮬레이터에 로드.
        *   **🤖 AI 코딩 지시사항:** "Firebase CLI를 사용하여 Firestore 에뮬레이터에 `records_mock.json`, `user_profiles_mock.json` 파일로부터 데이터를 가져오는(import) 스크립트를 안내해주세요."
    *   **Functions 에뮬레이터:** 로컬에서 Cloud Functions 실행 및 테스트.
        *   **OCR 함수:** 실제 Cloud Vision API 대신 고정된 OCR 결과 반환.
        *   **취향 분석 함수:** 단순 규칙으로 프로필 업데이트 또는 고정 프로필 반환.
        *   **🤖 AI 코딩 지시사항 (Cloud Functions - Python):** "로컬 개발 환경일 때 (예: 특정 환경 변수 체크) Google Cloud Vision API를 호출하는 대신, 미리 정의된 샘플 JSON 응답을 반환하도록 OCR 처리 Cloud Function을 수정하는 방법을 안내해주세요."

**5. 🚀 온라인 클라우드 환경 (Google Cloud) 배포 가이드라인**

*   **5.1. 📱 프론트엔드 (Flutter)**
    *   `flutter build apk` 및 `flutter build ios` (또는 `flutter build appbundle`) 명령어로 프로덕션 빌드.
    *   Google Play Store 및 Apple App Store 배포 가이드라인 준수.
    *   (선택적) Firebase App Distribution을 통한 테스트 버전 배포.
*   **5.2. ☁️ 백엔드 (Cloud Functions, Firestore 등)**
    *   **Cloud Functions 배포:** Firebase CLI (`firebase deploy --only functions`) 또는 `gcloud functions deploy`.
        *   함수별 권한 및 환경 변수 설정.
    *   **Firestore 규칙 설정:** 프로덕션 환경용 보안 규칙 적용 (인가된 사용자만 접근/수정).
        *   **🤖 AI 코딩 지시사항:** "인증된 사용자만이 자신의 `records` 및 `user_profiles` 데이터를 읽고 쓸 수 있도록 하는 Firestore 보안 규칙 예시를 작성해주세요. 다른 사용자의 공개 가능한 정보(예: 프로필 일부)는 읽기만 허용할 수 있습니다."
    *   **API 활성화:** Google Cloud Console에서 Cloud Vision API, Natural Language API 등 사용 설정.
    *   **Vertex AI (향후):** 모델 배포 후 Cloud Function에서 엔드포인트 호출 설정.
    *   **Cloud Storage:** 버킷 생성 및 접근 권한 설정.
    *   **모니터링 및 로깅:** Google Cloud Logging/Monitoring, Firebase Console 활용 📊.
