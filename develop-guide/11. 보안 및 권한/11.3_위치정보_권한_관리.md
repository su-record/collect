# ğŸ“ 11.3 ìœ„ì¹˜ì •ë³´ ê¶Œí•œ ê´€ë¦¬

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ê¶Œí•œ ìš”ì²­ í”Œë¡œìš°](#2-ê¶Œí•œ-ìš”ì²­-í”Œë¡œìš°)
3. [ê¶Œí•œ ê±°ë¶€ ì‹œ ì²˜ë¦¬](#3-ê¶Œí•œ-ê±°ë¶€-ì‹œ-ì²˜ë¦¬)
4. [ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì„¤ì •](#4-ë°±ê·¸ë¼ìš´ë“œ-ìœ„ì¹˜-ì„¤ì •)
5. [ìœ„ì¹˜ ì •í™•ë„ ì„¤ì •](#5-ìœ„ì¹˜-ì •í™•ë„-ì„¤ì •)
6. [ê²€ì¦](#6-ê²€ì¦)

## 1. ê°œìš”
Fallingoì˜ í•µì‹¬ ê¸°ëŠ¥ì¸ ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… ë‹¨ê³„ë³„ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
- âœ… ê¶Œí•œ ê±°ë¶€ ì‹œ ëŒ€ì²´ UI ì œê³µ
- âœ… ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  (ì¸í”Œë£¨ì–¸ì„œ)
- âœ… ë°°í„°ë¦¬ íš¨ìœ¨ì ì¸ ìœ„ì¹˜ ì—…ë°ì´íŠ¸

## 2. ê¶Œí•œ ìš”ì²­ í”Œë¡œìš°

### [í•„ìˆ˜] ìœ„ì¹˜ ê¶Œí•œ ê´€ë¦¬ì
```dart
// íŒŒì¼: lib/core/permissions/location_permission_manager.dart
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:geolocator/geolocator.dart';

class LocationPermissionManager {
  static final LocationPermissionManager _instance = LocationPermissionManager._internal();
  factory LocationPermissionManager() => _instance;
  LocationPermissionManager._internal();

  // ê¶Œí•œ ìƒíƒœ
  PermissionStatus? _locationStatus;
  PermissionStatus? _backgroundLocationStatus;
  
  /// ìœ„ì¹˜ ê¶Œí•œ í™•ì¸
  Future<LocationPermissionStatus> checkPermission() async {
    // ìœ„ì¹˜ ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸
    bool serviceEnabled = await Geolocator.isLocationServiceEnabled();
    if (!serviceEnabled) {
      return LocationPermissionStatus.serviceDisabled;
    }

    // ê¶Œí•œ í™•ì¸
    _locationStatus = await Permission.location.status;
    
    if (_locationStatus == PermissionStatus.denied) {
      return LocationPermissionStatus.denied;
    } else if (_locationStatus == PermissionStatus.permanentlyDenied) {
      return LocationPermissionStatus.permanentlyDenied;
    } else if (_locationStatus == PermissionStatus.restricted) {
      return LocationPermissionStatus.restricted;
    }
    
    return LocationPermissionStatus.granted;
  }

  /// ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
  Future<LocationPermissionStatus> requestPermission() async {
    // ì´ë¯¸ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°
    final currentStatus = await checkPermission();
    if (currentStatus == LocationPermissionStatus.granted) {
      return currentStatus;
    }

    // ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”ì¸ ê²½ìš°
    if (currentStatus == LocationPermissionStatus.serviceDisabled) {
      return currentStatus;
    }

    // ê¶Œí•œ ìš”ì²­
    _locationStatus = await Permission.location.request();
    
    if (_locationStatus == PermissionStatus.granted) {
      return LocationPermissionStatus.granted;
    } else if (_locationStatus == PermissionStatus.permanentlyDenied) {
      return LocationPermissionStatus.permanentlyDenied;
    }
    
    return LocationPermissionStatus.denied;
  }

  /// ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ (ì¸í”Œë£¨ì–¸ì„œìš©)
  Future<bool> requestBackgroundPermission() async {
    // ì¼ë°˜ ìœ„ì¹˜ ê¶Œí•œì´ ì—†ìœ¼ë©´ ë¶ˆê°€
    if (_locationStatus != PermissionStatus.granted) {
      return false;
    }

    // iOSëŠ” ë³„ë„ ê¶Œí•œ í•„ìš”
    if (Theme.of(_instance._context!).platform == TargetPlatform.iOS) {
      _backgroundLocationStatus = await Permission.locationAlways.request();
      return _backgroundLocationStatus == PermissionStatus.granted;
    }
    
    // AndroidëŠ” ì¼ë°˜ ê¶Œí•œìœ¼ë¡œ ì¶©ë¶„ (ì„¤ì •ì— ë”°ë¼)
    return true;
  }

  /// ì„¤ì • ì•± ì—´ê¸°
  Future<void> openSettings() async {
    await openAppSettings();
  }
}

enum LocationPermissionStatus {
  granted,
  denied,
  permanentlyDenied,
  restricted,
  serviceDisabled,
}
```

### [í•„ìˆ˜] ê¶Œí•œ ìš”ì²­ UI
```dart
// íŒŒì¼: lib/features/permissions/presentation/screens/location_permission_screen.dart
import 'package:flutter/material.dart';
import '../../../core/permissions/location_permission_manager.dart';

class LocationPermissionScreen extends StatefulWidget {
  final VoidCallback onPermissionGranted;
  final VoidCallback onPermissionDenied;

  const LocationPermissionScreen({
    Key? key,
    required this.onPermissionGranted,
    required this.onPermissionDenied,
  }) : super(key: key);

  @override
  State<LocationPermissionScreen> createState() => _LocationPermissionScreenState();
}

class _LocationPermissionScreenState extends State<LocationPermissionScreen> {
  final _permissionManager = LocationPermissionManager();
  bool _isRequesting = false;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(24.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              // ìœ„ì¹˜ ì•„ì´ì½˜
              Container(
                width: 120,
                height: 120,
                decoration: BoxDecoration(
                  color: Theme.of(context).primaryColor.withOpacity(0.1),
                  shape: BoxShape.circle,
                ),
                child: Icon(
                  Icons.location_on,
                  size: 60,
                  color: Theme.of(context).primaryColor,
                ),
              ),
              const SizedBox(height: 32),
              
              // ì œëª©
              Text(
                'ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•´ìš”',
                style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 16),
              
              // ì„¤ëª…
              Text(
                'FallingoëŠ” ì£¼ë³€ ë§›ì§‘ì„ ì°¾ê³ \ní˜„ì¥ ì¸ì¦ì„ ìœ„í•´ ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
                textAlign: TextAlign.center,
                style: Theme.of(context).textTheme.bodyLarge?.copyWith(
                  color: Colors.grey[600],
                ),
              ),
              const SizedBox(height: 48),
              
              // ê¶Œí•œ ìš”ì²­ ë²„íŠ¼
              ElevatedButton(
                onPressed: _isRequesting ? null : _requestPermission,
                style: ElevatedButton.styleFrom(
                  minimumSize: const Size(double.infinity, 56),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(12),
                  ),
                ),
                child: _isRequesting
                    ? const CircularProgressIndicator(color: Colors.white)
                    : const Text('ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©í•˜ê¸°'),
              ),
              const SizedBox(height: 16),
              
              // ë‚˜ì¤‘ì— í•˜ê¸°
              TextButton(
                onPressed: widget.onPermissionDenied,
                child: const Text('ë‚˜ì¤‘ì— í•˜ê¸°'),
              ),
              
              // ì¶”ê°€ ì•ˆë‚´
              const SizedBox(height: 32),
              Container(
                padding: const EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.blue[50],
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  children: [
                    Icon(Icons.info_outline, color: Colors.blue[700]),
                    const SizedBox(width: 12),
                    Expanded(
                      child: Text(
                        'ìœ„ì¹˜ ì •ë³´ëŠ” ì„œë¹„ìŠ¤ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°\nì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.',
                        style: TextStyle(
                          fontSize: 12,
                          color: Colors.blue[700],
                        ),
                      ),
                    ),
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }

  Future<void> _requestPermission() async {
    setState(() => _isRequesting = true);

    try {
      final status = await _permissionManager.requestPermission();
      
      switch (status) {
        case LocationPermissionStatus.granted:
          widget.onPermissionGranted();
          break;
        case LocationPermissionStatus.serviceDisabled:
          _showServiceDisabledDialog();
          break;
        case LocationPermissionStatus.permanentlyDenied:
          _showPermanentlyDeniedDialog();
          break;
        default:
          widget.onPermissionDenied();
      }
    } finally {
      setState(() => _isRequesting = false);
    }
  }

  void _showServiceDisabledDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('ìœ„ì¹˜ ì„œë¹„ìŠ¤ êº¼ì§'),
        content: const Text('ìœ„ì¹˜ ì„œë¹„ìŠ¤ê°€ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤.\nì„¤ì •ì—ì„œ ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì¼œì£¼ì„¸ìš”.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('ë‹«ê¸°'),
          ),
          TextButton(
            onPressed: () {
              Navigator.pop(context);
              Geolocator.openLocationSettings();
            },
            child: const Text('ì„¤ì •ìœ¼ë¡œ ì´ë™'),
          ),
        ],
      ),
    );
  }

  void _showPermanentlyDeniedDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('ê¶Œí•œì´ ê±°ë¶€ë¨'),
        content: const Text('ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.\nì„¤ì •ì—ì„œ ì§ì ‘ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('ë‹«ê¸°'),
          ),
          TextButton(
            onPressed: () {
              Navigator.pop(context);
              _permissionManager.openSettings();
            },
            child: const Text('ì„¤ì •ìœ¼ë¡œ ì´ë™'),
          ),
        ],
      ),
    );
  }
}
```

## 3. ê¶Œí•œ ê±°ë¶€ ì‹œ ì²˜ë¦¬

### [í•„ìˆ˜] ì œí•œëœ ê¸°ëŠ¥ UI
```dart
// íŒŒì¼: lib/features/feed/presentation/widgets/location_denied_widget.dart
import 'package:flutter/material.dart';

class LocationDeniedWidget extends StatelessWidget {
  final VoidCallback onRequestPermission;

  const LocationDeniedWidget({
    Key? key,
    required this.onRequestPermission,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(16),
      margin: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.orange[50],
        borderRadius: BorderRadius.circular(12),
        border: Border.all(color: Colors.orange[200]!),
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(
            Icons.location_off,
            size: 48,
            color: Colors.orange[700],
          ),
          const SizedBox(height: 16),
          Text(
            'ìœ„ì¹˜ ê¶Œí•œì´ ì—†ì–´ ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤',
            style: TextStyle(
              fontSize: 16,
              fontWeight: FontWeight.bold,
              color: Colors.orange[900],
            ),
          ),
          const SizedBox(height: 8),
          Text(
            'â€¢ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\n'
            'â€¢ í˜„ì¥ ì¸ì¦ í”¼ë“œë¥¼ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤\n'
            'â€¢ ê±°ë¦¬ ê¸°ë°˜ ê²€ìƒ‰ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤',
            style: TextStyle(
              fontSize: 14,
              color: Colors.orange[700],
              height: 1.5,
            ),
          ),
          const SizedBox(height: 16),
          ElevatedButton.icon(
            onPressed: onRequestPermission,
            icon: const Icon(Icons.location_on),
            label: const Text('ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©í•˜ê¸°'),
            style: ElevatedButton.styleFrom(
              backgroundColor: Colors.orange,
              foregroundColor: Colors.white,
            ),
          ),
        ],
      ),
    );
  }
}
```

### [í•„ìˆ˜] ëŒ€ì²´ ê¸°ëŠ¥ ì œê³µ
```dart
// íŒŒì¼: lib/features/feed/presentation/screens/feed_screen_limited.dart
class FeedScreenLimited extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Fallingo'),
      ),
      body: Column(
        children: [
          // ìœ„ì¹˜ ê¶Œí•œ ì—†ìŒ ì•ˆë‚´
          LocationDeniedWidget(
            onRequestPermission: () async {
              final result = await LocationPermissionManager().requestPermission();
              if (result == LocationPermissionStatus.granted) {
                // ì •ìƒ í”¼ë“œë¡œ ì´ë™
                Navigator.pushReplacementNamed(context, '/feed');
              }
            },
          ),
          
          // ì œí•œëœ ê¸°ëŠ¥: ì „êµ­ ì¸ê¸° ë©”ë‰´ë§Œ í‘œì‹œ
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Padding(
                  padding: const EdgeInsets.all(16),
                  child: Text(
                    'ì „êµ­ ì¸ê¸° ë©”ë‰´',
                    style: Theme.of(context).textTheme.titleLarge,
                  ),
                ),
                Expanded(
                  child: ListView.builder(
                    itemCount: 10, // Mock ë°ì´í„°
                    itemBuilder: (context, index) {
                      return ListTile(
                        leading: ClipRRect(
                          borderRadius: BorderRadius.circular(8),
                          child: Image.asset(
                            'assets/images/mock_food_$index.jpg',
                            width: 60,
                            height: 60,
                            fit: BoxFit.cover,
                          ),
                        ),
                        title: Text('ì¸ê¸° ë©”ë‰´ ${index + 1}'),
                        subtitle: const Text('ìœ„ì¹˜ ì •ë³´ ì—†ìŒ'),
                        trailing: const Icon(Icons.arrow_forward_ios),
                      );
                    },
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

## 4. ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì„¤ì •

### [í•„ìˆ˜] ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  (ì¸í”Œë£¨ì–¸ì„œ)
```dart
// íŒŒì¼: lib/features/influencer/services/background_location_service.dart
import 'dart:async';
import 'package:geolocator/geolocator.dart';
import 'package:workmanager/workmanager.dart';

class BackgroundLocationService {
  static const String taskName = 'influencer_location_update';
  static const Duration updateInterval = Duration(minutes: 15);
  
  /// ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì´ˆê¸°í™”
  static Future<void> initialize() async {
    await Workmanager().initialize(
      callbackDispatcher,
      isInDebugMode: false,
    );
  }

  /// ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  ì‹œì‘
  static Future<bool> startTracking(String userId, String userGrade) async {
    // ìˆ˜ëìƒ ë“±ê¸‰ ì´ìƒë§Œ ê°€ëŠ¥
    if (!['ìˆ˜ëìƒ', 'ëŒ€ì¥ê¸ˆâ­', 'ëŒ€ì¥ê¸ˆâ­â­', 'ëŒ€ì¥ê¸ˆâ­â­â­'].contains(userGrade)) {
      return false;
    }

    // ë°±ê·¸ë¼ìš´ë“œ ê¶Œí•œ í™•ì¸
    final hasPermission = await LocationPermissionManager().requestBackgroundPermission();
    if (!hasPermission) {
      return false;
    }

    // ì£¼ê¸°ì  ì‘ì—… ë“±ë¡
    await Workmanager().registerPeriodicTask(
      taskName,
      taskName,
      frequency: updateInterval,
      constraints: Constraints(
        networkType: NetworkType.connected,
        requiresBatteryNotLow: true,
      ),
      inputData: {
        'userId': userId,
        'userGrade': userGrade,
      },
    );

    return true;
  }

  /// ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  ì¤‘ì§€
  static Future<void> stopTracking() async {
    await Workmanager().cancelByUniqueName(taskName);
  }
}

// ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì²˜ë¦¬
void callbackDispatcher() {
  Workmanager().executeTask((task, inputData) async {
    if (task == BackgroundLocationService.taskName) {
      try {
        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        final position = await Geolocator.getCurrentPosition(
          desiredAccuracy: LocationAccuracy.balanced,
        );

        // ìµëª…í™”ëœ ìœ„ì¹˜ ì „ì†¡
        await _sendAnonymizedLocation(
          inputData!['userId'],
          position.latitude,
          position.longitude,
        );

        return Future.value(true);
      } catch (e) {
        print('Background location error: $e');
        return Future.value(false);
      }
    }
    return Future.value(false);
  });
}

Future<void> _sendAnonymizedLocation(String userId, double lat, double lng) async {
  // ìœ„ì¹˜ ìµëª…í™” (1km ë°˜ê²½)
  final anonymized = LocationPrivacy.anonymizeLocation(lat, lng, 1000);
  
  // API ì „ì†¡
  // await ApiService.updateInfluencerLocation(userId, anonymized);
}
```

### [ì„ íƒ] iOS ë°±ê·¸ë¼ìš´ë“œ ëª¨ë“œ ì„¤ì •
```xml
<!-- íŒŒì¼: ios/Runner/Info.plist -->
<key>UIBackgroundModes</key>
<array>
    <string>location</string>
    <string>fetch</string>
</array>

<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>Fallingoê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ì¸í”Œë£¨ì–¸ì„œë‹˜ì˜ ëŒ€ëµì ì¸ ìœ„ì¹˜ë¥¼ ê³µìœ í•˜ì—¬ íŒ¬ë“¤ì´ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</string>

<key>NSLocationWhenInUseUsageDescription</key>
<string>ì£¼ë³€ ë§›ì§‘ì„ ì°¾ê³  í˜„ì¥ ì¸ì¦ì„ ìœ„í•´ ìœ„ì¹˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</string>
```

## 5. ìœ„ì¹˜ ì •í™•ë„ ì„¤ì •

### [í•„ìˆ˜] ìƒí™©ë³„ ìœ„ì¹˜ ì •í™•ë„
```dart
// íŒŒì¼: lib/core/location/location_accuracy_manager.dart
import 'package:geolocator/geolocator.dart';

class LocationAccuracyManager {
  /// ìƒí™©ë³„ ìœ„ì¹˜ ì •í™•ë„ ê²°ì •
  static LocationAccuracy getAccuracy(LocationPurpose purpose) {
    switch (purpose) {
      case LocationPurpose.feedCreation:
        // í”¼ë“œ ìƒì„±: ë†’ì€ ì •í™•ë„ í•„ìš”
        return LocationAccuracy.high;
        
      case LocationPurpose.nearbySearch:
        // ì£¼ë³€ ê²€ìƒ‰: ê· í˜•ì¡íŒ ì •í™•ë„
        return LocationAccuracy.balanced;
        
      case LocationPurpose.influencerTracking:
        // ì¸í”Œë£¨ì–¸ì„œ ì¶”ì : ë‚®ì€ ì •í™•ë„ (ë°°í„°ë¦¬ ì ˆì•½)
        return LocationAccuracy.low;
        
      case LocationPurpose.mapView:
        // ì§€ë„ ë³´ê¸°: ì¤‘ê°„ ì •í™•ë„
        return LocationAccuracy.medium;
        
      default:
        return LocationAccuracy.balanced;
    }
  }

  /// ë°°í„°ë¦¬ íš¨ìœ¨ì ì¸ ìœ„ì¹˜ ìŠ¤íŠ¸ë¦¼
  static Stream<Position> getLocationStream({
    required LocationPurpose purpose,
    int? distanceFilter,
  }) {
    final accuracy = getAccuracy(purpose);
    
    // ê±°ë¦¬ í•„í„° ì„¤ì • (ë¯¸í„° ë‹¨ìœ„)
    final filter = distanceFilter ?? _getDefaultDistanceFilter(purpose);
    
    return Geolocator.getPositionStream(
      locationSettings: LocationSettings(
        accuracy: accuracy,
        distanceFilter: filter,
      ),
    );
  }

  static int _getDefaultDistanceFilter(LocationPurpose purpose) {
    switch (purpose) {
      case LocationPurpose.feedCreation:
        return 10; // 10m ë§ˆë‹¤ ì—…ë°ì´íŠ¸
      case LocationPurpose.nearbySearch:
        return 50; // 50m ë§ˆë‹¤ ì—…ë°ì´íŠ¸
      case LocationPurpose.influencerTracking:
        return 500; // 500m ë§ˆë‹¤ ì—…ë°ì´íŠ¸
      case LocationPurpose.mapView:
        return 20; // 20m ë§ˆë‹¤ ì—…ë°ì´íŠ¸
      default:
        return 50;
    }
  }
}

enum LocationPurpose {
  feedCreation,     // í”¼ë“œ ë“±ë¡
  nearbySearch,     // ì£¼ë³€ ê²€ìƒ‰
  influencerTracking, // ì¸í”Œë£¨ì–¸ì„œ ìœ„ì¹˜ ê³µìœ 
  mapView,          // ì§€ë„ ë³´ê¸°
}
```

### [í•„ìˆ˜] ìœ„ì¹˜ ìºì‹± ì „ëµ
```dart
// íŒŒì¼: lib/core/location/location_cache.dart
class LocationCache {
  static Position? _lastPosition;
  static DateTime? _lastUpdateTime;
  static const Duration cacheValidity = Duration(minutes: 5);

  /// ìºì‹œëœ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
  static Future<Position?> getCachedPosition({
    bool forceRefresh = false,
  }) async {
    // ê°•ì œ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ìºì‹œ ë§Œë£Œ
    if (forceRefresh || _isCacheExpired()) {
      try {
        _lastPosition = await Geolocator.getCurrentPosition(
          desiredAccuracy: LocationAccuracy.balanced,
        );
        _lastUpdateTime = DateTime.now();
      } catch (e) {
        print('Location error: $e');
      }
    }

    return _lastPosition;
  }

  static bool _isCacheExpired() {
    if (_lastUpdateTime == null) return true;
    return DateTime.now().difference(_lastUpdateTime!) > cacheValidity;
  }

  /// ìœ„ì¹˜ ë³€í™” ê°ì§€
  static Stream<bool> watchSignificantChanges({
    double threshold = 100, // ë¯¸í„°
  }) async* {
    Position? previousPosition = _lastPosition;

    await for (final position in Geolocator.getPositionStream()) {
      if (previousPosition == null) {
        previousPosition = position;
        yield true;
        continue;
      }

      final distance = Geolocator.distanceBetween(
        previousPosition.latitude,
        previousPosition.longitude,
        position.latitude,
        position.longitude,
      );

      if (distance >= threshold) {
        previousPosition = position;
        _lastPosition = position;
        _lastUpdateTime = DateTime.now();
        yield true;
      }
    }
  }
}
```

## 6. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸ ì •ìƒ í‘œì‹œ
- [ ] ê¶Œí•œ ê±°ë¶€ ì‹œ ì œí•œëœ ê¸°ëŠ¥ UI í‘œì‹œ
- [ ] ì„¤ì • ì•±ìœ¼ë¡œ ì´ë™ ê¸°ëŠ¥ ë™ì‘
- [ ] ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì  ì‹œì‘/ì¤‘ì§€
- [ ] ë°°í„°ë¦¬ íš¨ìœ¨ì ì¸ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
- [ ] ìœ„ì¹˜ ìºì‹œ ë§Œë£Œ ë° ê°±ì‹ 

### ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
```dart
// íŒŒì¼: test/permissions/location_permission_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';

void main() {
  group('Location Permission Tests', () {
    test('ê¶Œí•œ ìš”ì²­ í”Œë¡œìš°', () async {
      // 1. ìµœì´ˆ ì‹¤í–‰ ì‹œ ê¶Œí•œ ìš”ì²­ í™”ë©´ í‘œì‹œ
      // 2. í—ˆìš© ë²„íŠ¼ í´ë¦­
      // 3. ì‹œìŠ¤í…œ ê¶Œí•œ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
      // 4. í—ˆìš© ì„ íƒ ì‹œ ë©”ì¸ í™”ë©´ ì´ë™
    });

    test('ê¶Œí•œ ê±°ë¶€ ì‹œ ì œí•œ ëª¨ë“œ', () async {
      // 1. ê¶Œí•œ ê±°ë¶€
      // 2. ì œí•œëœ í”¼ë“œ í™”ë©´ í‘œì‹œ
      // 3. ìœ„ì¹˜ ê¸°ë°˜ ê¸°ëŠ¥ ë¹„í™œì„±í™” í™•ì¸
    });

    test('ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ì¶”ì ', () async {
      // 1. ìˆ˜ëìƒ ë“±ê¸‰ ì‚¬ìš©ì ë¡œê·¸ì¸
      // 2. ë°±ê·¸ë¼ìš´ë“œ ìœ„ì¹˜ ê³µìœ  í™œì„±í™”
      // 3. 15ë¶„ë§ˆë‹¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ í™•ì¸
    });
  });
}
```