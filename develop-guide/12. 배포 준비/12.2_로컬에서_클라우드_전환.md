# ğŸš€ 12.2 ë¡œì»¬ì—ì„œ í´ë¼ìš°ë“œ ì „í™˜

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [Supabase í´ë¼ìš°ë“œ ì„¤ì •](#2-supabase-í´ë¼ìš°ë“œ-ì„¤ì •)
3. [Backend ì „í™˜](#3-backend-ì „í™˜)
4. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#4-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
5. [ê²€ì¦](#5-ê²€ì¦)

## 1. ê°œìš”

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ Supabase í´ë¼ìš°ë“œ í™˜ê²½ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ê³¼ì •ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… ë¡œì»¬ â†’ í´ë¼ìš°ë“œ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
- âœ… í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬
- âœ… ë¬´ì¤‘ë‹¨ ì „í™˜

## 2. Supabase í´ë¼ìš°ë“œ ì„¤ì •

### [í•„ìˆ˜] Supabase í”„ë¡œì íŠ¸ ìƒì„±
```bash
# 1. https://supabase.com ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±
# 2. í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ URLê³¼ í‚¤ í™•ì¸

# í”„ë¡œì íŠ¸ ì •ë³´ ì˜ˆì‹œ:
# Project URL: https://xxxxx.supabase.co
# Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
# Service Role Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### [í•„ìˆ˜] ë¡œì»¬ DB ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# ë¡œì»¬ DB ë¤í”„
supabase db dump -f dump.sql

# í´ë¼ìš°ë“œì— ì—°ê²°
supabase link --project-ref your-project-ref

# ë§ˆì´ê·¸ë ˆì´ì…˜ í‘¸ì‹œ
supabase db push

# ë˜ëŠ” ì§ì ‘ SQL ì‹¤í–‰
psql -h db.xxxxx.supabase.co -p 5432 -d postgres -U postgres -f dump.sql
```

### [í•„ìˆ˜] Storage ë²„í‚· ì„¤ì •
```sql
-- íŒŒì¼: cloud/setup_storage.sql
-- Supabase Dashboard SQL Editorì—ì„œ ì‹¤í–‰

-- ë²„í‚· ìƒì„±
INSERT INTO storage.buckets (id, name, public)
VALUES 
  ('feed-images', 'feed-images', true),
  ('profile-images', 'profile-images', true)
ON CONFLICT (id) DO NOTHING;

-- RLS ì •ì±…ì€ ë¡œì»¬ê³¼ ë™ì¼í•˜ê²Œ ì ìš©
```

### [í•„ìˆ˜] ì¸ì¦ í”„ë¡œë°”ì´ë” ì„¤ì •
```yaml
# Supabase Dashboard > Authentication > Providers

# Google OAuth
- Client ID: your-google-client-id
- Client Secret: your-google-client-secret
- Redirect URL: https://your-project.supabase.co/auth/v1/callback

# Apple Sign In
- Client ID: com.example.fallingo
- Secret Key: -----BEGIN PRIVATE KEY-----...
```

## 3. Backend ì „í™˜

### [í•„ìˆ˜] Flask â†’ Edge Functions
```typescript
// íŒŒì¼: supabase/functions/feed-create/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders })
  }

  try {
    const supabaseClient = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    )

    // ì¸ì¦ í™•ì¸
    const authHeader = req.headers.get('Authorization')!
    const token = authHeader.replace('Bearer ', '')
    const { data: { user }, error: authError } = await supabaseClient.auth.getUser(token)
    
    if (authError || !user) {
      return new Response(
        JSON.stringify({ error: 'Unauthorized' }),
        { status: 401, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      )
    }

    // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±
    const { menu_id, content, image_urls, tags, location } = await req.json()

    // í”¼ë“œ ìƒì„±
    const { data: feed, error: feedError } = await supabaseClient
      .from('feeds')
      .insert({
        user_id: user.id,
        menu_id,
        content,
        image_urls,
        tags,
        location: `POINT(${location.longitude} ${location.latitude})`
      })
      .select()
      .single()

    if (feedError) {
      return new Response(
        JSON.stringify({ error: feedError.message }),
        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      )
    }

    return new Response(
      JSON.stringify(feed),
      { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    )

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    )
  }
})
```

### [í•„ìˆ˜] Edge Functions ë°°í¬
```bash
# Edge Function ìƒì„±
supabase functions new feed-create
supabase functions new feed-list
supabase functions new user-profile

# í•¨ìˆ˜ ë°°í¬
supabase functions deploy feed-create
supabase functions deploy feed-list
supabase functions deploy user-profile

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
supabase secrets set GOOGLE_MAPS_API_KEY=your-key
supabase secrets set VISION_API_KEY=your-key
```

### [ì„ íƒ] Cloud Run ëŒ€ì•ˆ
```python
# íŒŒì¼: backend/main.py (Cloud Runìš©)
import os
from flask import Flask
from supabase import create_client

app = Flask(__name__)

# Supabase í´ë¼ì´ì–¸íŠ¸ (í´ë¼ìš°ë“œ)
supabase = create_client(
    os.environ.get('SUPABASE_URL'),
    os.environ.get('SUPABASE_SERVICE_ROLE_KEY')
)

# ê¸°ì¡´ ë¼ìš°íŠ¸ ì¬ì‚¬ìš©...

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=int(os.environ.get('PORT', 8080)))
```

## 4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### [í•„ìˆ˜] Flutter í”„ë¡œë•ì…˜ ì„¤ì •
```dart
// íŒŒì¼: lib/core/config/production_config.dart
class ProductionConfig {
  static const String supabaseUrl = 'https://xxxxx.supabase.co';
  static const String supabaseAnonKey = 'eyJ...';
  static const String apiBaseUrl = 'https://xxxxx.supabase.co/functions/v1';
  
  // ì™¸ë¶€ APIëŠ” ë™ì¼
  static const String googleMapsApiKey = 'your-production-key';
}
```

### [í•„ìˆ˜] ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
```bash
# íŒŒì¼: scripts/build_production.sh
#!/bin/bash

# iOS ë¹Œë“œ
flutter build ipa \
  --dart-define=APP_ENV=production \
  --dart-define=SUPABASE_URL=https://xxxxx.supabase.co \
  --dart-define=SUPABASE_ANON_KEY=eyJ... \
  --dart-define=GOOGLE_MAPS_API_KEY=your-key

# Android ë¹Œë“œ
flutter build appbundle \
  --dart-define=APP_ENV=production \
  --dart-define=SUPABASE_URL=https://xxxxx.supabase.co \
  --dart-define=SUPABASE_ANON_KEY=eyJ... \
  --dart-define=GOOGLE_MAPS_API_KEY=your-key
```

### [í•„ìˆ˜] í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬
```dart
// íŒŒì¼: lib/core/config/config_manager.dart
class ConfigManager {
  static late final AppConfig config;
  
  static void initialize() {
    const env = String.fromEnvironment('APP_ENV', defaultValue: 'local');
    
    switch (env) {
      case 'local':
        config = LocalConfig();
        break;
      case 'staging':
        config = StagingConfig();
        break;
      case 'production':
        config = ProductionConfig();
        break;
      default:
        config = LocalConfig();
    }
  }
}

abstract class AppConfig {
  String get supabaseUrl;
  String get supabaseAnonKey;
  String get apiBaseUrl;
  String get googleMapsApiKey;
}
```

## 5. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Supabase í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ
- [ ] Storage ë²„í‚· ì„¤ì •
- [ ] ì¸ì¦ í”„ë¡œë°”ì´ë” êµ¬ì„±
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ë™ì‘ í™•ì¸

### ğŸ§ª í´ë¼ìš°ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸
```dart
// íŒŒì¼: test/cloud_connection_test.dart
void testCloudConnection() async {
  // í”„ë¡œë•ì…˜ í™˜ê²½ìœ¼ë¡œ Supabase ì´ˆê¸°í™”
  await Supabase.initialize(
    url: 'https://xxxxx.supabase.co',
    anonKey: 'your-anon-key',
  );
  
  final supabase = Supabase.instance.client;
  
  // ì—°ê²° í…ŒìŠ¤íŠ¸
  try {
    final response = await supabase
        .from('users')
        .select()
        .limit(1);
    
    print('í´ë¼ìš°ë“œ ì—°ê²° ì„±ê³µ!');
    print('ì‘ë‹µ: $response');
  } catch (e) {
    print('í´ë¼ìš°ë“œ ì—°ê²° ì‹¤íŒ¨: $e');
  }
}
```

### ğŸš€ ë‹¨ê³„ë³„ ì „í™˜ ì „ëµ
```yaml
# 1ë‹¨ê³„: ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸
- ë¡œì»¬ ê°œë°œ ì™„ë£Œ
- ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

# 2ë‹¨ê³„: ìŠ¤í…Œì´ì§• í™˜ê²½
- Supabase í”„ë¡œì íŠ¸ ìƒì„± (ê°œë°œìš©)
- ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸ ë°ì´í„°
- ë‚´ë¶€ í…ŒìŠ¤íŠ¸

# 3ë‹¨ê³„: í”„ë¡œë•ì…˜ ì¤€ë¹„
- í”„ë¡œë•ì…˜ Supabase í”„ë¡œì íŠ¸
- ë³´ì•ˆ ì„¤ì • ê°•í™”
- ì„±ëŠ¥ ìµœì í™”

# 4ë‹¨ê³„: ì ì§„ì  ì „í™˜
- ì¼ë¶€ ì‚¬ìš©ì ëŒ€ìƒ ë² íƒ€ í…ŒìŠ¤íŠ¸
- ëª¨ë‹ˆí„°ë§ ê°•í™”
- í”¼ë“œë°± ìˆ˜ì§‘

# 5ë‹¨ê³„: ì „ì²´ ì „í™˜
- ëª¨ë“  ì‚¬ìš©ì ë§ˆì´ê·¸ë ˆì´ì…˜
- ë¡œì»¬ í™˜ê²½ íê¸°
```

### ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„¤ì •
```typescript
// íŒŒì¼: supabase/functions/_shared/monitoring.ts
export function logMetric(name: string, value: number, tags?: Record<string, string>) {
  console.log(JSON.stringify({
    metric: name,
    value,
    tags,
    timestamp: new Date().toISOString()
  }))
}

export function logError(error: Error, context?: Record<string, any>) {
  console.error(JSON.stringify({
    error: error.message,
    stack: error.stack,
    context,
    timestamp: new Date().toISOString()
  }))
}
```