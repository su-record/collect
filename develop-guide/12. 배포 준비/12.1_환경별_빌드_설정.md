# ğŸ—ï¸ 12.1 í™˜ê²½ë³„ ë¹Œë“œ ì„¤ì •

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ë¹Œë“œ Flavor ì„¤ì •](#2-ë¹Œë“œ-flavor-ì„¤ì •)
3. [í™˜ê²½ë³„ ì•„ì´ì½˜/ì´ë¦„](#3-í™˜ê²½ë³„-ì•„ì´ì½˜ì´ë¦„)
4. [ì„œëª… í‚¤ ê´€ë¦¬](#4-ì„œëª…-í‚¤-ê´€ë¦¬)
5. [ProGuard ì„¤ì •](#5-proguard-ì„¤ì •)
6. [ê²€ì¦](#6-ê²€ì¦)

## 1. ê°œìš”
local, development, production í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ì„¤ì •ê³¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¹Œë“œ ì‹œìŠ¤í…œì„ êµ¬ì„±í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… Flutter Flavorsë¡œ í™˜ê²½ ë¶„ë¦¬
- âœ… í™˜ê²½ë³„ ì•± ì•„ì´ì½˜ ë° ì´ë¦„ êµ¬ë¶„
- âœ… ì•ˆì „í•œ ì„œëª… í‚¤ ê´€ë¦¬
- âœ… ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ìµœì í™”

## 2. ë¹Œë“œ Flavor ì„¤ì •

### [í•„ìˆ˜] Android Flavor ì„¤ì •
```gradle
// íŒŒì¼: android/app/build.gradle
android {
    compileSdkVersion 34
    
    defaultConfig {
        applicationId "com.fallingo.app"
        minSdkVersion 21
        targetSdkVersion 34
        versionCode 1
        versionName "1.0.0"
    }

    // ì„œëª… ì„¤ì •
    signingConfigs {
        release {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
            storePassword keystoreProperties['storePassword']
        }
    }

    // Flavor ì •ì˜
    flavorDimensions "environment"
    productFlavors {
        local {
            dimension "environment"
            applicationIdSuffix ".local"
            versionNameSuffix "-LOCAL"
            resValue "string", "app_name", "Fallingo Local"
            
            // ë¡œì»¬ í™˜ê²½ ì„¤ì •
            buildConfigField "String", "API_BASE_URL", '"http://10.0.2.2:5000/api"'
            buildConfigField "String", "ENVIRONMENT", '"local"'
        }
        
        dev {
            dimension "environment"
            applicationIdSuffix ".dev"
            versionNameSuffix "-DEV"
            resValue "string", "app_name", "Fallingo Dev"
            
            // ê°œë°œ í™˜ê²½ ì„¤ì •
            buildConfigField "String", "API_BASE_URL", '"https://dev-api.fallingo.com"'
            buildConfigField "String", "ENVIRONMENT", '"development"'
        }
        
        prod {
            dimension "environment"
            resValue "string", "app_name", "Fallingo"
            
            // ìš´ì˜ í™˜ê²½ ì„¤ì •
            buildConfigField "String", "API_BASE_URL", '"https://api.fallingo.com"'
            buildConfigField "String", "ENVIRONMENT", '"production"'
        }
    }

    buildTypes {
        debug {
            debuggable true
            minifyEnabled false
        }
        
        release {
            debuggable false
            minifyEnabled true
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release
        }
    }
}

// Flavorë³„ í™˜ê²½ ì„¤ì • íŒŒì¼ ì²˜ë¦¬
// SupabaseëŠ” google-services.jsonì´ í•„ìš” ì—†ìŒ
// ëŒ€ì‹  í™˜ê²½ë³„ ì„¤ì •ì„ BuildConfigë¡œ ê´€ë¦¬
```

### [í•„ìˆ˜] iOS Flavor ì„¤ì •
```ruby
# íŒŒì¼: ios/Flutter/Local.xcconfig
#include "Generated.xcconfig"

APP_NAME = Fallingo Local
APP_BUNDLE_ID_SUFFIX = .local
FLUTTER_BUILD_MODE = debug

# íŒŒì¼: ios/Flutter/Dev.xcconfig
#include "Generated.xcconfig"

APP_NAME = Fallingo Dev
APP_BUNDLE_ID_SUFFIX = .dev
FLUTTER_BUILD_MODE = debug

# íŒŒì¼: ios/Flutter/Prod.xcconfig
#include "Generated.xcconfig"

APP_NAME = Fallingo
APP_BUNDLE_ID_SUFFIX = 
FLUTTER_BUILD_MODE = release
```

### [í•„ìˆ˜] iOS ìŠ¤í‚´ ì„¤ì •
```xml
<!-- íŒŒì¼: ios/Runner.xcodeproj/xcshareddata/xcschemes/local.xcscheme -->
<Scheme
   LastUpgradeVersion = "1430"
   version = "1.3">
   <BuildAction>
      <BuildActionEntries>
         <BuildActionEntry>
            <BuildableReference
               BuildableIdentifier = "primary"
               BlueprintIdentifier = "97C146ED1CF9000F007C117D"
               BuildableName = "Runner.app"
               BlueprintName = "Runner"
               ReferencedContainer = "container:Runner.xcodeproj">
            </BuildableReference>
         </BuildActionEntry>
      </BuildActionEntries>
   </BuildAction>
   <LaunchAction
      buildConfiguration = "Debug-local">
      <BuildableProductRunnable>
         <BuildableReference
            BuildableIdentifier = "primary"
            BlueprintIdentifier = "97C146ED1CF9000F007C117D"
            BuildableName = "Runner.app"
            BlueprintName = "Runner"
            ReferencedContainer = "container:Runner.xcodeproj">
         </BuildableReference>
      </BuildableProductRunnable>
   </LaunchAction>
</Scheme>
```

### [í•„ìˆ˜] Dart í™˜ê²½ ì„¤ì • ì—°ë™
```dart
// íŒŒì¼: lib/main_local.dart
import 'package:flutter/material.dart';
import 'app.dart';

void main() {
  const environment = String.fromEnvironment(
    'APP_ENV',
    defaultValue: 'local',
  );
  
  runApp(FallingoApp(environment: environment));
}

// íŒŒì¼: lib/main_dev.dart
void main() {
  const environment = String.fromEnvironment(
    'APP_ENV',
    defaultValue: 'development',
  );
  
  runApp(FallingoApp(environment: environment));
}

// íŒŒì¼: lib/main_prod.dart
void main() {
  const environment = String.fromEnvironment(
    'APP_ENV',
    defaultValue: 'production',
  );
  
  runApp(FallingoApp(environment: environment));
}
```

## 3. í™˜ê²½ë³„ ì•„ì´ì½˜/ì´ë¦„

### [í•„ìˆ˜] ì•± ì•„ì´ì½˜ ì„¤ì •
```yaml
# íŒŒì¼: pubspec.yaml
dev_dependencies:
  flutter_launcher_icons: ^0.13.1

flutter_icons:
  android: true
  ios: true
  
  # í™˜ê²½ë³„ ì•„ì´ì½˜ ì„¤ì •
  image_path_android: "assets/icons/app_icon.png"
  image_path_ios: "assets/icons/app_icon_ios.png"
  
  # Adaptive ì•„ì´ì½˜ (Android)
  adaptive_icon_background: "#FF6B35"
  adaptive_icon_foreground: "assets/icons/app_icon_foreground.png"
```

### [í•„ìˆ˜] í™˜ê²½ë³„ ì•„ì´ì½˜ íŒŒì¼ êµ¬ì¡°
```
assets/icons/
â”œâ”€â”€ local/
â”‚   â”œâ”€â”€ app_icon.png (1024x1024)
â”‚   â”œâ”€â”€ app_icon_foreground.png (1024x1024)
â”‚   â””â”€â”€ app_icon_ios.png (1024x1024)
â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ app_icon.png
â”‚   â”œâ”€â”€ app_icon_foreground.png
â”‚   â””â”€â”€ app_icon_ios.png
â””â”€â”€ prod/
    â”œâ”€â”€ app_icon.png
    â”œâ”€â”€ app_icon_foreground.png
    â””â”€â”€ app_icon_ios.png
```

### [í•„ìˆ˜] ì•„ì´ì½˜ ìƒì„± ìŠ¤í¬ë¦½íŠ¸
```bash
# íŒŒì¼: scripts/generate_icons.sh
#!/bin/bash

FLAVORS=("local" "dev" "prod")

for FLAVOR in "${FLAVORS[@]}"
do
  echo "Generating icons for $FLAVOR..."
  
  # ì•„ì´ì½˜ íŒŒì¼ ë³µì‚¬
  cp -r assets/icons/$FLAVOR/* assets/icons/
  
  # flutter_launcher_icons ì‹¤í–‰
  flutter pub run flutter_launcher_icons:main
  
  # Android ì•„ì´ì½˜ ì´ë™
  if [ "$FLAVOR" != "prod" ]; then
    mv android/app/src/main/res android/app/src/$FLAVOR/
  fi
done

echo "Icon generation complete!"
```

### [ì„ íƒ] ìŠ¤í”Œë˜ì‹œ í™”ë©´ ì„¤ì •
```yaml
# íŒŒì¼: pubspec.yaml
flutter_native_splash:
  color: "#FF6B35"
  image: assets/images/splash_logo.png
  android_12:
    color: "#FF6B35"
    image: assets/images/splash_logo_android12.png
```

## 4. ì„œëª… í‚¤ ê´€ë¦¬

### [í•„ìˆ˜] Android í‚¤ìŠ¤í† ì–´ ìƒì„±
```bash
# í”„ë¡œë•ì…˜ í‚¤ ìƒì„±
keytool -genkey -v -keystore fallingo-release.keystore \
  -alias fallingo -keyalg RSA -keysize 2048 -validity 10000

# ê°œë°œìš© í‚¤ ìƒì„±
keytool -genkey -v -keystore fallingo-dev.keystore \
  -alias fallingo-dev -keyalg RSA -keysize 2048 -validity 10000
```

### [í•„ìˆ˜] í‚¤ìŠ¤í† ì–´ ì„¤ì • íŒŒì¼
```properties
# íŒŒì¼: android/key.properties (Git ì œì™¸)
storePassword=your_store_password
keyPassword=your_key_password
keyAlias=fallingo
storeFile=../keys/fallingo-release.keystore

# ê°œë°œìš©
dev.storePassword=dev_store_password
dev.keyPassword=dev_key_password
dev.keyAlias=fallingo-dev
dev.storeFile=../keys/fallingo-dev.keystore
```

### [í•„ìˆ˜] iOS ì¸ì¦ì„œ ê´€ë¦¬
```ruby
# íŒŒì¼: ios/fastlane/Fastfile
platform :ios do
  desc "Sync certificates"
  lane :sync_certificates do |options|
    environment = options[:env] || "dev"
    
    match(
      type: environment == "prod" ? "appstore" : "development",
      app_identifier: environment == "prod" ? 
        "com.fallingo.app" : 
        "com.fallingo.app.#{environment}",
      readonly: true
    )
  end
  
  desc "Build and upload"
  lane :build do |options|
    environment = options[:env] || "dev"
    
    sync_certificates(env: environment)
    
    build_app(
      scheme: environment.capitalize,
      export_method: environment == "prod" ? "app-store" : "development"
    )
  end
end
```

### [í•„ìˆ˜] ë³´ì•ˆ ê´€ë¦¬
```yaml
# íŒŒì¼: .gitignore
# ì„œëª… ê´€ë ¨ íŒŒì¼ ì œì™¸
android/key.properties
android/app/upload-keystore.jks
android/app/fallingo-*.keystore
*.keystore
*.jks

# iOS ì¸ì¦ì„œ ì œì™¸
ios/Runner.xcworkspace/xcshareddata/
ios/fastlane/report.xml
ios/fastlane/Preview.html
ios/fastlane/screenshots
ios/fastlane/test_output
```

## 5. ProGuard ì„¤ì •

### [í•„ìˆ˜] ProGuard ê·œì¹™
```pro
# íŒŒì¼: android/app/proguard-rules.pro

# Flutter ê¸°ë³¸ ê·œì¹™
-keep class io.flutter.app.** { *; }
-keep class io.flutter.plugin.**  { *; }
-keep class io.flutter.util.**  { *; }
-keep class io.flutter.view.**  { *; }
-keep class io.flutter.**  { *; }
-keep class io.flutter.plugins.**  { *; }

# Supabase
-keep class io.supabase.** { *; }
-keep class com.supabase.** { *; }
-dontwarn io.supabase.**
-dontwarn com.supabase.**

# PostgreSQL/PostGIS ê´€ë ¨
-keep class org.postgresql.** { *; }
-dontwarn org.postgresql.**

# Gson (JSON íŒŒì‹±)
-keepattributes Signature
-keepattributes *Annotation*
-dontwarn sun.misc.**
-keep class com.google.gson.** { *; }

# ëª¨ë¸ í´ë˜ìŠ¤ (íŒ¨í‚¤ì§€ì— ë§ê²Œ ìˆ˜ì •)
-keep class com.fallingo.app.models.** { *; }
-keepclassmembers class com.fallingo.app.models.** { *; }

# ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ
-keepclasseswithmembernames class * {
    native <methods>;
}

# Enum
-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

# Parcelable
-keepclassmembers class * implements android.os.Parcelable {
    public static final ** CREATOR;
}

# WebView
-keepclassmembers class * extends android.webkit.WebViewClient {
    public void *(android.webkit.WebView, java.lang.String, android.graphics.Bitmap);
    public boolean *(android.webkit.WebView, java.lang.String);
}

# ë””ë²„ê¹… ì •ë³´ ì œê±° (ë¦´ë¦¬ì¦ˆ)
-assumenosideeffects class android.util.Log {
    public static *** d(...);
    public static *** v(...);
    public static *** i(...);
}
```

### [ì„ íƒ] R8 ìµœì í™”
```gradle
// íŒŒì¼: android/gradle.properties
android.enableR8=true
android.enableR8.fullMode=true
```

## 6. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê° Flavorë³„ ë¹Œë“œ ì„±ê³µ
- [ ] í™˜ê²½ë³„ ì•± ì´ë¦„/ì•„ì´ì½˜ êµ¬ë¶„
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì˜¬ë°”ë¥¸ ì„¤ì •
- [ ] ì„œëª…ëœ APK/IPA ìƒì„±
- [ ] ProGuard ì ìš© í›„ ì •ìƒ ë™ì‘
- [ ] ë¹Œë“œ í¬ê¸° ìµœì í™” í™•ì¸

### ğŸ—ï¸ ë¹Œë“œ ëª…ë ¹ì–´
```bash
# Android ë¹Œë“œ
# Local Debug
flutter build apk --flavor local --debug -t lib/main_local.dart

# Dev Debug  
flutter build apk --flavor dev --debug -t lib/main_dev.dart

# Production Release
flutter build apk --flavor prod --release -t lib/main_prod.dart

# iOS ë¹Œë“œ
# Local Debug
flutter build ios --flavor local --debug -t lib/main_local.dart

# Production Release
flutter build ios --flavor prod --release -t lib/main_prod.dart
```

### ğŸ“± ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
# Android ì„¤ì¹˜
adb install build/app/outputs/flutter-apk/app-local-debug.apk

# iOS ì‹¤í–‰ (ì‹œë®¬ë ˆì´í„°)
flutter run --flavor local -t lib/main_local.dart

# íŠ¹ì • ê¸°ê¸°ì—ì„œ ì‹¤í–‰
flutter run --flavor dev -t lib/main_dev.dart -d <device_id>
```