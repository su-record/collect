# ğŸ“¸ 6.9.1 ì¹´ë©”ë¼ ê¶Œí•œ ë° ì‹¤ì‹œê°„ ì¸ì‹

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ê¶Œí•œ ì„¤ì •](#2-ê¶Œí•œ-ì„¤ì •)
3. [êµ¬í˜„](#3-êµ¬í˜„)
4. [ê²€ì¦](#4-ê²€ì¦)

## 1. ê°œìš”
í˜„ì¥ ì¸ì¦ í”¼ë“œ ë“±ë¡ì˜ ì²« ë‹¨ê³„ì¸ ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ê³¼ ì‹¤ì‹œê°„ ìŒì‹ ì¸ì‹ ì˜¤ë²„ë ˆì´ êµ¬í˜„ì…ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… ì¹´ë©”ë¼/ê°¤ëŸ¬ë¦¬ ê¶Œí•œ ìš”ì²­ ë° ì²˜ë¦¬
- âœ… ì‹¤ì‹œê°„ ì¹´ë©”ë¼ í”„ë¦¬ë·° êµ¬í˜„
- âœ… Mock Cloud Vision API ìŒì‹ ì¸ì‹ ì˜¤ë²„ë ˆì´
- âœ… ì´¬ì˜ ë²„íŠ¼ ë° UI ì»¨íŠ¸ë¡¤

## 2. ê¶Œí•œ ì„¤ì •

### [í•„ìˆ˜] í”Œë«í¼ë³„ ê¶Œí•œ ì„¤ì •

#### iOS ì„¤ì •
```xml
<!-- íŒŒì¼: ios/Runner/Info.plist -->
<key>NSCameraUsageDescription</key>
<string>ìŒì‹ ì‚¬ì§„ì„ ì´¬ì˜í•˜ì—¬ ì¶”ì²œì„ ë“±ë¡í•˜ê¸° ìœ„í•´ ì¹´ë©”ë¼ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>ê°¤ëŸ¬ë¦¬ì—ì„œ ìŒì‹ ì‚¬ì§„ì„ ì„ íƒí•˜ê¸° ìœ„í•´ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</string>
<key>NSLocationWhenInUseUsageDescription</key>
<string>í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ë§›ì§‘ ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ìœ„ì¹˜ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</string>
```

#### Android ì„¤ì •
```xml
<!-- íŒŒì¼: android/app/src/main/AndroidManifest.xml -->
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
```

### [í•„ìˆ˜] íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
```yaml
# íŒŒì¼: pubspec.yaml
dependencies:
  camera: ^0.10.5
  permission_handler: ^11.0.0
  image_picker: ^1.0.0
```

## 3. êµ¬í˜„

### [í•„ìˆ˜] ê¶Œí•œ ìš”ì²­ í—¬í¼
```dart
// íŒŒì¼: lib/core/utils/permission_helper.dart
import 'package:permission_handler/permission_handler.dart';

class PermissionHelper {
  // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
  static Future<bool> requestCameraPermission() async {
    final status = await Permission.camera.request();
    return status == PermissionStatus.granted;
  }
  
  // ê°¤ëŸ¬ë¦¬ ê¶Œí•œ ìš”ì²­
  static Future<bool> requestGalleryPermission() async {
    final status = await Permission.photos.request();
    return status == PermissionStatus.granted;
  }
  
  // ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
  static Future<bool> requestLocationPermission() async {
    final status = await Permission.location.request();
    return status == PermissionStatus.granted;
  }
  
  // ê¶Œí•œ ê±°ë¶€ ì‹œ ì„¤ì • í™”ë©´ ì´ë™
  static Future<void> openSettings() async {
    await openAppSettings();
  }
}
```

### [í•„ìˆ˜] ì¹´ë©”ë¼ í™”ë©´ êµ¬í˜„
```dart
// íŒŒì¼: lib/features/feed/screens/camera_screen.dart
import 'package:flutter/material.dart';
import 'package:camera/camera.dart';
import 'package:fallingo/core/config/app_config.dart';

class CameraScreen extends StatefulWidget {
  final int photoIndex;  // í˜„ì¬ ì´¬ì˜ ì¤‘ì¸ ì‚¬ì§„ ë²ˆí˜¸ (0-4)
  
  const CameraScreen({Key? key, this.photoIndex = 0}) : super(key: key);
  
  @override
  _CameraScreenState createState() => _CameraScreenState();
}

class _CameraScreenState extends State<CameraScreen> {
  CameraController? _controller;
  List<CameraDescription>? _cameras;
  bool _isInitialized = false;
  bool _isFoodDetected = false;  // ìŒì‹ ê°ì§€ ì—¬ë¶€
  
  // Mock ìŒì‹ ì¸ì‹ ê²°ê³¼
  Map<String, dynamic>? _recognitionResult;
  
  @override
  void initState() {
    super.initState();
    _initializeCamera();
  }
  
  Future<void> _initializeCamera() async {
    // ê¶Œí•œ í™•ì¸
    final hasPermission = await PermissionHelper.requestCameraPermission();
    if (!hasPermission) {
      // ê¶Œí•œ ê±°ë¶€ ì²˜ë¦¬
      _showPermissionDialog();
      return;
    }
    
    // ì¹´ë©”ë¼ ì´ˆê¸°í™”
    _cameras = await availableCameras();
    if (_cameras!.isNotEmpty) {
      _controller = CameraController(
        _cameras![0],
        ResolutionPreset.high,
      );
      
      await _controller!.initialize();
      setState(() => _isInitialized = true);
      
      // ì²« ë²ˆì§¸ ì‚¬ì§„ì¸ ê²½ìš°ì—ë§Œ ìŒì‹ ì¸ì‹ ì‹œì‘
      if (widget.photoIndex == 0) {
        if (AppConfig.current.isLocal) {
          _startMockRecognition();
        } else {
          _startRealTimeRecognition();
        }
      } else {
        // 2-5ë²ˆì§¸ ì‚¬ì§„ì€ ìŒì‹ ê°ì§€ ë¶ˆí•„ìš”
        setState(() => _isFoodDetected = true);
      }
    }
  }
  
  // Mock ì‹¤ì‹œê°„ ìŒì‹ ì¸ì‹
  void _startMockRecognition() {
    Future.delayed(Duration(seconds: 2), () {
      if (mounted) {
        setState(() {
          _isFoodDetected = true;  // Mockì—ì„œëŠ” í•­ìƒ ê°ì§€
          _recognitionResult = {
            'menu': 'ê¹€ì¹˜ì°Œê°œ',
            'recommendCount': 234,
            'registeredCount': 15,
            'lastRegistered': '2ì‹œê°„ ì „',
          };
        });
      }
    });
  }
  
  // ì‹¤ì œ ì‹¤ì‹œê°„ ìŒì‹ ì¸ì‹
  void _startRealTimeRecognition() {
    // TODO: Cloud Vision API ì—°ë™
    // ìŒì‹ì´ ê°ì§€ë˜ë©´ _isFoodDetected = trueë¡œ ì„¤ì •
  }
  
  @override
  Widget build(BuildContext context) {
    if (!_isInitialized) {
      return Scaffold(
        backgroundColor: Colors.black,
        body: Center(
          child: CircularProgressIndicator(
            valueColor: AlwaysStoppedAnimation(AppColors.primaryOrange),
          ),
        ),
      );
    }
    
    return Scaffold(
      backgroundColor: Colors.black,
      body: Stack(
        children: [
          // ì¹´ë©”ë¼ í”„ë¦¬ë·°
          CameraPreview(_controller!),
          
          // ìƒë‹¨ ì»¨íŠ¸ë¡¤
          SafeArea(
            child: Padding(
              padding: EdgeInsets.all(16),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  // ë‹«ê¸° ë²„íŠ¼
                  IconButton(
                    icon: Icon(Icons.close, color: Colors.white, size: 32),
                    onPressed: () => Navigator.pop(context),
                  ),
                  // í˜„ì¬ ì‚¬ì§„ ë²ˆí˜¸ í‘œì‹œ
                  Container(
                    padding: EdgeInsets.symmetric(horizontal: 16, vertical: 8),
                    decoration: BoxDecoration(
                      color: Colors.black.withOpacity(0.5),
                      borderRadius: BorderRadius.circular(20),
                    ),
                    child: Text(
                      '${widget.photoIndex + 1} / 5',
                      style: TextStyle(color: Colors.white, fontSize: 16),
                    ),
                  ),
                  // ê°¤ëŸ¬ë¦¬ ë²„íŠ¼ (ì²« ë²ˆì§¸ ì‚¬ì§„ì—ì„œë§Œ ë¹„í™œì„±í™”)
                  IconButton(
                    icon: Icon(Icons.photo_library, 
                      color: widget.photoIndex == 0 ? Colors.grey : Colors.white, 
                      size: 32
                    ),
                    onPressed: widget.photoIndex == 0 ? null : _pickFromGallery,
                  ),
                ],
              ),
            ),
          ),
          
          // ìŒì‹ ë¯¸ê°ì§€ ê²½ê³  (ì²« ë²ˆì§¸ ì‚¬ì§„ì—ì„œë§Œ)
          if (widget.photoIndex == 0 && !_isFoodDetected)
            Positioned(
              bottom: 200,
              left: 20,
              right: 20,
              child: Container(
                padding: EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.red.withOpacity(0.8),
                  borderRadius: BorderRadius.circular(12),
                ),
                child: Column(
                  children: [
                    Icon(Icons.warning, color: Colors.white, size: 32),
                    SizedBox(height: 8),
                    Text(
                      'âš ï¸ ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤',
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 16,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    SizedBox(height: 4),
                    Text(
                      'Please capture food photo',
                      style: TextStyle(color: Colors.white70, fontSize: 14),
                    ),
                    Text(
                      'è¯·æ‹æ‘„é£Ÿç‰©ç…§ç‰‡',
                      style: TextStyle(color: Colors.white70, fontSize: 14),
                    ),
                  ],
                ),
              ),
            ),
          
          // Mock ì¸ì‹ ê²°ê³¼ ì˜¤ë²„ë ˆì´ (ì²« ë²ˆì§¸ ì‚¬ì§„ì—ì„œë§Œ)
          if (widget.photoIndex == 0 && _recognitionResult != null)
            Positioned(
              bottom: 120,
              left: 20,
              right: 20,
              child: Container(
                padding: EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.black.withOpacity(0.7),
                  borderRadius: BorderRadius.circular(12),
                ),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'ğŸ² ${_recognitionResult!['menu']} ì¸ì‹ë¨',
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    SizedBox(height: 8),
                    Text(
                      'ğŸ‘ ${_recognitionResult!['recommendCount']}ê°œ ì¶”ì²œ',
                      style: TextStyle(color: Colors.white70),
                    ),
                    Text(
                      'ğŸ“ ì´ ìœ„ì¹˜ì—ì„œ ${_recognitionResult!['registeredCount']}ë²ˆ ë“±ë¡ë¨',
                      style: TextStyle(color: Colors.white70),
                    ),
                    Text(
                      'ğŸ•’ ìµœê·¼ ë“±ë¡: ${_recognitionResult!['lastRegistered']}',
                      style: TextStyle(color: Colors.white70),
                    ),
                  ],
                ),
              ),
            ),
          
          // ì´¬ì˜ ë²„íŠ¼
          Align(
            alignment: Alignment.bottomCenter,
            child: Padding(
              padding: EdgeInsets.only(bottom: 40),
              child: GestureDetector(
                onTap: (widget.photoIndex == 0 && !_isFoodDetected) 
                    ? null 
                    : _takePicture,
                child: Container(
                  width: 80,
                  height: 80,
                  decoration: BoxDecoration(
                    shape: BoxShape.circle,
                    border: Border.all(
                      color: (widget.photoIndex == 0 && !_isFoodDetected)
                          ? Colors.grey
                          : Colors.white,
                      width: 4,
                    ),
                    color: (widget.photoIndex == 0 && !_isFoodDetected)
                        ? Colors.grey.withOpacity(0.3)
                        : Colors.white.withOpacity(0.3),
                  ),
                  child: Center(
                    child: Container(
                      width: 60,
                      height: 60,
                      decoration: BoxDecoration(
                        shape: BoxShape.circle,
                        color: (widget.photoIndex == 0 && !_isFoodDetected)
                            ? Colors.grey
                            : Colors.white,
                      ),
                    ),
                  ),
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  // ì‚¬ì§„ ì´¬ì˜
  Future<void> _takePicture() async {
    if (_controller == null || !_controller!.value.isInitialized) return;
    
    try {
      final image = await _controller!.takePicture();
      // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™ (6.9.2 ì°¸ì¡°)
      Navigator.pushNamed(
        context,
        '/feed/register/process',
        arguments: {'imagePath': image.path},
      );
    } catch (e) {
      print('Error taking picture: $e');
    }
  }
  
  // ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ
  Future<void> _pickFromGallery() async {
    final hasPermission = await PermissionHelper.requestGalleryPermission();
    if (!hasPermission) {
      _showPermissionDialog();
      return;
    }
    
    // ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ì„ íƒì€ í˜„ì¥ ì¸ì¦ ë¶ˆê°€ ì•ˆë‚´
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('ğŸ“ í˜„ì¥ ì¸ì¦ í•„ìš”'),
        content: Text('FallingoëŠ” í˜„ì¥ì—ì„œ ì§ì ‘ ì´¬ì˜í•œ ì‚¬ì§„ë§Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('í™•ì¸', style: TextStyle(color: AppColors.primaryOrange)),
          ),
        ],
      ),
    );
  }
  
  // ê¶Œí•œ ê±°ë¶€ ë‹¤ì´ì–¼ë¡œê·¸
  void _showPermissionDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('ğŸ“¸ ê¶Œí•œ í•„ìš”'),
        content: Text('ìŒì‹ ì‚¬ì§„ì„ ì´¬ì˜í•˜ê¸° ìœ„í•´ ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('ì·¨ì†Œ'),
          ),
          TextButton(
            onPressed: () async {
              Navigator.pop(context);
              await PermissionHelper.openSettings();
            },
            child: Text('ì„¤ì •ìœ¼ë¡œ ì´ë™', style: TextStyle(color: AppColors.primaryOrange)),
          ),
        ],
      ),
    );
  }
  
  @override
  void dispose() {
    _controller?.dispose();
    super.dispose();
  }
}
```

### [ì„ íƒ] ì¹´ë©”ë¼ ê°€ì´ë“œ ì˜¤ë²„ë ˆì´
```dart
// íŒŒì¼: lib/features/feed/widgets/camera_guide_overlay.dart
class CameraGuideOverlay extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.symmetric(horizontal: 20, vertical: 10),
      decoration: BoxDecoration(
        color: Colors.black.withOpacity(0.6),
        borderRadius: BorderRadius.circular(20),
      ),
      child: Text(
        'ìŒì‹ì´ í™”ë©´ ì¤‘ì•™ì— ì˜¤ë„ë¡ ì´¬ì˜í•´ì£¼ì„¸ìš”',
        style: TextStyle(color: Colors.white, fontSize: 14),
      ),
    );
  }
}
```

## 4. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] iOS/Android ê¶Œí•œ ì„¤ì • ì™„ë£Œ
- [ ] ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ì •ìƒ ì‘ë™
- [ ] ê¶Œí•œ ê±°ë¶€ ì‹œ ì•ˆë‚´ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
- [ ] ì¹´ë©”ë¼ í”„ë¦¬ë·° ì •ìƒ í‘œì‹œ
- [ ] Mock ìŒì‹ ì¸ì‹ ì˜¤ë²„ë ˆì´ í‘œì‹œ
- [ ] ì´¬ì˜ ë²„íŠ¼ ì‘ë™ í™•ì¸
- [ ] ê°¤ëŸ¬ë¦¬ ë²„íŠ¼ í´ë¦­ ì‹œ í˜„ì¥ ì¸ì¦ ì•ˆë‚´