# ğŸ—ºï¸ 6.6 ì§€ë„ ê¸°ë°˜ íƒìƒ‰ êµ¬í˜„

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [í•µì‹¬ êµ¬í˜„](#2-í•µì‹¬-êµ¬í˜„)
3. [Mock ë°ì´í„°](#3-mock-ë°ì´í„°)
4. [ê²€ì¦](#4-ê²€ì¦)

## 1. ê°œìš”

ì§€ë„ ê¸°ë°˜ íƒìƒ‰ í™”ë©´ì€ í”¼ë“œì˜ ì»¤ë®¤ë‹ˆí‹° ì§€ë„ì™€ ë³„ê°œë¡œ ì „ì²´ í™”ë©´ìœ¼ë¡œ ë§›ì§‘ì„ íƒìƒ‰í•˜ëŠ” ì „ìš© í™”ë©´ì…ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… í”¼ë“œ ì§€ë„ì™€ ë…ë¦½ëœ ì „ì²´ í™”ë©´ ì§€ë„
- âœ… ë‹¤ì–‘í•œ ë§ˆì»¤ íƒ€ì… ë° ë””ìì¸
- âœ… ë§ˆì»¤ í´ëŸ¬ìŠ¤í„°ë§ ë° í•„í„°ë§

### ğŸ—ºï¸ í”¼ë“œ ì§€ë„ vs íƒìƒ‰ ì§€ë„ êµ¬ë¶„
| êµ¬ë¶„ | í”¼ë“œ ë‚´ ì§€ë„ | íƒìƒ‰ ì „ìš© ì§€ë„ |
|------|-------------|--------------|
| **í¬ê¸°** | í™”ë©´ì˜ 40-50% | ì „ì²´ í™”ë©´ |
| **ë§ˆì»¤** | ì œí•œì  (3-5ê°œ) | ë¬´ì œí•œ |
| **ê¸°ëŠ¥** | ê°„ë‹¨í•œ í† ê¸€ | ìƒì„¸ í•„í„°/ê²€ìƒ‰ |
| **ìš©ë„** | ë¹ ë¥¸ í™•ì¸ | ê¹Šì´ ìˆëŠ” íƒìƒ‰ |

## 2. í•µì‹¬ êµ¬í˜„

### [í•„ìˆ˜] ì§€ë„ íƒìƒ‰ í™”ë©´
```dart
// íŒŒì¼: lib/screens/map_exploration_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';

// Provider
final mapStateProvider = StateProvider((ref) => MapExplorationState());
final selectedPlaceProvider = StateProvider<PlaceData?>((ref) => null);

class MapExplorationScreen extends ConsumerStatefulWidget {
  @override
  ConsumerState<MapExplorationScreen> createState() => _MapExplorationScreenState();
}

class _MapExplorationScreenState extends ConsumerState<MapExplorationScreen> {
  GoogleMapController? _mapController;
  
  @override
  Widget build(BuildContext context) {
    final mapState = ref.watch(mapStateProvider);
    final selectedPlace = ref.watch(selectedPlaceProvider);
    
    return Scaffold(
      body: Stack(
        children: [
          // ì „ì²´ í™”ë©´ ì§€ë„ (Mock)
          _buildFullScreenMap(),
          
          // ìƒë‹¨ ê²€ìƒ‰ë°”
          Positioned(
            top: MediaQuery.of(context).padding.top + 16,
            left: 16,
            right: 16,
            child: _SearchBar(),
          ),
          
          // í•„í„° ì¹©
          Positioned(
            top: MediaQuery.of(context).padding.top + 80,
            left: 16,
            right: 16,
            child: _FilterChips(),
          ),
          
          // í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼
          Positioned(
            bottom: selectedPlace != null ? 280 : 100,
            right: 16,
            child: _LocationButton(),
          ),
          
          // ì„ íƒëœ ì¥ì†Œ ì¹´ë“œ
          if (selectedPlace != null)
            Positioned(
              bottom: 0,
              left: 0,
              right: 0,
              child: _PlaceDetailCard(place: selectedPlace),
            ),
        ],
      ),
    );
  }
  
  Widget _buildFullScreenMap() {
    return Container(
      color: Colors.grey[200],
      child: Stack(
        children: [
          // Mock ì§€ë„ ë°°ê²½
          Center(
            child: Icon(Icons.map, size: 100, color: Colors.grey[400]),
          ),
          
          // Mock ë§ˆì»¤ë“¤
          ..._buildMockMarkers(),
        ],
      ),
    );
  }
  
  List<Widget> _buildMockMarkers() {
    return mockMapData.map((place) {
      return Positioned(
        left: place.mockX * MediaQuery.of(context).size.width,
        top: place.mockY * MediaQuery.of(context).size.height,
        child: _MarkerWidget(
          place: place,
          onTap: () => ref.read(selectedPlaceProvider.notifier).state = place,
        ),
      );
    }).toList();
  }
}

// ê²€ìƒ‰ë°”
class _SearchBar extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Container(
      height: 48,
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(24),
        boxShadow: [BoxShadow(
          color: Colors.black.withOpacity(0.1),
          blurRadius: 8,
          offset: Offset(0, 2),
        )],
      ),
      child: InkWell(
        onTap: () {},
        borderRadius: BorderRadius.circular(24),
        child: Padding(
          padding: EdgeInsets.symmetric(horizontal: 16),
          child: Row(
            children: [
              Icon(Icons.search, color: Colors.grey),
              SizedBox(width: 12),
              Text('ë§›ì§‘ ê²€ìƒ‰', style: TextStyle(color: Colors.grey[600])),
              Spacer(),
              Icon(Icons.tune, color: Color(0xFFFF6B35)),
            ],
          ),
        ),
      ),
    );
  }
}

// í•„í„° ì¹©
class _FilterChips extends ConsumerWidget {
  final filters = [
    FilterData('ğŸŒŸ ëŒ€ì¥ê¸ˆ', MarkerType.influencer, Colors.yellow[700]!),
    FilterData('ğŸ… ì¸ì¦ë§›ì§‘', MarkerType.certified, Colors.green),
    FilterData('ğŸ“ ì¸ê¸°ë©”ë‰´', MarkerType.popular, Colors.red),
    FilterData('ğŸŠ ì´ë²¤íŠ¸', MarkerType.event, Colors.purple),
    FilterData('ğŸœ í•œì‹', MarkerType.korean, Colors.blue),
    FilterData('ğŸ• ì–‘ì‹', MarkerType.western, Colors.orange),
  ];
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final mapState = ref.watch(mapStateProvider);
    
    return Container(
      height: 40,
      child: ListView.builder(
        scrollDirection: Axis.horizontal,
        itemCount: filters.length,
        itemBuilder: (context, index) {
          final filter = filters[index];
          final isActive = mapState.activeFilters.contains(filter.type);
          
          return Padding(
            padding: EdgeInsets.only(right: 8),
            child: FilterChip(
              label: Text(filter.label),
              selected: isActive,
              selectedColor: filter.color.withOpacity(0.2),
              onSelected: (selected) {
                ref.read(mapStateProvider.notifier).update((state) {
                  final newFilters = List<MarkerType>.from(state.activeFilters);
                  if (selected) {
                    newFilters.add(filter.type);
                  } else {
                    newFilters.remove(filter.type);
                  }
                  return state.copyWith(activeFilters: newFilters);
                });
              },
            ),
          );
        },
      ),
    );
  }
}

// ë§ˆì»¤ ìœ„ì ¯
class _MarkerWidget extends StatelessWidget {
  final PlaceData place;
  final VoidCallback onTap;
  
  _MarkerWidget({required this.place, required this.onTap});
  
  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap,
      child: Container(
        width: 40,
        height: 50,
        child: Stack(
          alignment: Alignment.center,
          children: [
            // ë§ˆì»¤ ë””ìì¸
            CustomPaint(
              size: Size(40, 50),
              painter: _MarkerPainter(color: _getMarkerColor(place.type)),
            ),
            // ì•„ì´ì½˜
            Positioned(
              top: 5,
              child: Container(
                width: 30,
                height: 30,
                decoration: BoxDecoration(
                  color: Colors.white,
                  shape: BoxShape.circle,
                ),
                child: Center(
                  child: Text(
                    _getMarkerIcon(place.type),
                    style: TextStyle(fontSize: 16),
                  ),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  Color _getMarkerColor(MarkerType type) {
    switch (type) {
      case MarkerType.influencer: return Colors.yellow[700]!;
      case MarkerType.certified: return Colors.green;
      case MarkerType.popular: return Colors.red;
      case MarkerType.event: return Colors.purple;
      case MarkerType.korean: return Colors.blue;
      case MarkerType.western: return Colors.orange;
      default: return Colors.grey;
    }
  }
  
  String _getMarkerIcon(MarkerType type) {
    switch (type) {
      case MarkerType.influencer: return 'â­';
      case MarkerType.certified: return 'âœ“';
      case MarkerType.popular: return 'ğŸ”¥';
      case MarkerType.event: return 'ğŸ‰';
      case MarkerType.korean: return 'ğŸœ';
      case MarkerType.western: return 'ğŸ•';
      default: return 'ğŸ“';
    }
  }
}

// ë§ˆì»¤ í˜ì¸í„°
class _MarkerPainter extends CustomPainter {
  final Color color;
  
  _MarkerPainter({required this.color});
  
  @override
  void paint(Canvas canvas, Size size) {
    final paint = Paint()
      ..color = color
      ..style = PaintingStyle.fill;
    
    final path = Path()
      ..moveTo(size.width / 2, size.height)
      ..lineTo(size.width * 0.3, size.height * 0.6)
      ..arcToPoint(
        Offset(size.width * 0.7, size.height * 0.6),
        radius: Radius.circular(size.width / 2),
        clockwise: false,
      )
      ..close();
    
    canvas.drawPath(path, paint);
    
    // í…Œë‘ë¦¬
    paint
      ..style = PaintingStyle.stroke
      ..strokeWidth = 2
      ..color = Colors.white;
    canvas.drawPath(path, paint);
  }
  
  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}

// ì¥ì†Œ ìƒì„¸ ì¹´ë“œ
class _PlaceDetailCard extends ConsumerWidget {
  final PlaceData place;
  
  _PlaceDetailCard({required this.place});
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Container(
      height: 250,
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),
        boxShadow: [BoxShadow(
          color: Colors.black12,
          blurRadius: 10,
          offset: Offset(0, -2),
        )],
      ),
      child: Column(
        children: [
          // í•¸ë“¤
          Container(
            width: 40,
            height: 4,
            margin: EdgeInsets.symmetric(vertical: 12),
            decoration: BoxDecoration(
              color: Colors.grey[300],
              borderRadius: BorderRadius.circular(2),
            ),
          ),
          // ì½˜í…ì¸ 
          Expanded(
            child: Padding(
              padding: EdgeInsets.symmetric(horizontal: 16),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // í—¤ë”
                  Row(
                    children: [
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Row(
                              children: [
                                Text(
                                  place.name,
                                  style: TextStyle(
                                    fontSize: 20,
                                    fontWeight: FontWeight.bold,
                                  ),
                                ),
                                if (place.isCertified) ...[
                                  SizedBox(width: 8),
                                  Container(
                                    padding: EdgeInsets.symmetric(
                                      horizontal: 8,
                                      vertical: 2,
                                    ),
                                    decoration: BoxDecoration(
                                      color: Colors.green,
                                      borderRadius: BorderRadius.circular(12),
                                    ),
                                    child: Text(
                                      'ì¸ì¦',
                                      style: TextStyle(
                                        color: Colors.white,
                                        fontSize: 12,
                                        fontWeight: FontWeight.bold,
                                      ),
                                    ),
                                  ),
                                ],
                              ],
                            ),
                            SizedBox(height: 4),
                            Text(
                              place.address,
                              style: TextStyle(
                                fontSize: 14,
                                color: Colors.grey[600],
                              ),
                            ),
                          ],
                        ),
                      ),
                      IconButton(
                        icon: Icon(Icons.close),
                        onPressed: () {
                          ref.read(selectedPlaceProvider.notifier).state = null;
                        },
                      ),
                    ],
                  ),
                  SizedBox(height: 16),
                  // ë©”ë‰´ ë¦¬ìŠ¤íŠ¸
                  Text('ëŒ€í‘œ ë©”ë‰´', style: TextStyle(fontWeight: FontWeight.bold)),
                  SizedBox(height: 8),
                  ...place.topMenus.map((menu) => Padding(
                    padding: EdgeInsets.only(bottom: 8),
                    child: Row(
                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
                      children: [
                        Text(menu.name),
                        Text(
                          'â‚©${menu.price}',
                          style: TextStyle(
                            color: Color(0xFFFF6B35),
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                      ],
                    ),
                  )),
                  Spacer(),
                  // ì•¡ì…˜ ë²„íŠ¼
                  Row(
                    children: [
                      Expanded(
                        child: OutlinedButton.icon(
                          onPressed: () {},
                          icon: Icon(Icons.bookmark_border),
                          label: Text('ì €ì¥'),
                        ),
                      ),
                      SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: () {},
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Color(0xFFFF6B35),
                          ),
                          icon: Icon(Icons.directions),
                          label: Text('ê¸¸ì°¾ê¸°'),
                        ),
                      ),
                    ],
                  ),
                  SizedBox(height: 16),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}

// í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼
class _LocationButton extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Container(
      width: 48,
      height: 48,
      decoration: BoxDecoration(
        color: Colors.white,
        shape: BoxShape.circle,
        boxShadow: [BoxShadow(
          color: Colors.black.withOpacity(0.1),
          blurRadius: 8,
          offset: Offset(0, 2),
        )],
      ),
      child: IconButton(
        icon: Icon(Icons.my_location, color: Color(0xFFFF6B35)),
        onPressed: () {},
      ),
    );
  }
}
```

### [ì„ íƒ] ë§ˆì»¤ í´ëŸ¬ìŠ¤í„°ë§
```dart
// íŒŒì¼: lib/utils/marker_clustering.dart
class MarkerCluster {
  final List<PlaceData> places;
  final double centerLat;
  final double centerLng;
  
  MarkerCluster({
    required this.places,
    required this.centerLat,
    required this.centerLng,
  });
  
  int get count => places.length;
  
  // í´ëŸ¬ìŠ¤í„° ë§ˆì»¤ ìƒì„±
  Widget buildClusterMarker() {
    return Container(
      width: 50,
      height: 50,
      decoration: BoxDecoration(
        color: Color(0xFFFF6B35),
        shape: BoxShape.circle,
        border: Border.all(color: Colors.white, width: 3),
      ),
      child: Center(
        child: Text(
          '$count',
          style: TextStyle(
            color: Colors.white,
            fontWeight: FontWeight.bold,
            fontSize: 16,
          ),
        ),
      ),
    );
  }
}
```

## 3. Mock ë°ì´í„°

### [í•„ìˆ˜] ë°ì´í„° ëª¨ë¸ ë° Mock
```dart
// íŒŒì¼: lib/mock/map_mock_data.dart

// ë§ˆì»¤ íƒ€ì…
enum MarkerType {
  influencer,
  certified,
  popular,
  event,
  korean,
  western,
}

// ì¥ì†Œ ë°ì´í„°
class PlaceData {
  final String id;
  final String name;
  final String address;
  final MarkerType type;
  final bool isCertified;
  final List<MenuData> topMenus;
  final double mockX; // Mock ìœ„ì¹˜ (0.0 ~ 1.0)
  final double mockY; // Mock ìœ„ì¹˜ (0.0 ~ 1.0)
  
  PlaceData({
    required this.id,
    required this.name,
    required this.address,
    required this.type,
    required this.isCertified,
    required this.topMenus,
    required this.mockX,
    required this.mockY,
  });
}

// ë©”ë‰´ ë°ì´í„°
class MenuData {
  final String name;
  final int price;
  
  MenuData({required this.name, required this.price});
}

// í•„í„° ë°ì´í„°
class FilterData {
  final String label;
  final MarkerType type;
  final Color color;
  
  FilterData(this.label, this.type, this.color);
}

// ì§€ë„ ìƒíƒœ
class MapExplorationState {
  final List<MarkerType> activeFilters;
  final double zoomLevel;
  
  MapExplorationState({
    this.activeFilters = const [],
    this.zoomLevel = 14.0,
  });
  
  MapExplorationState copyWith({
    List<MarkerType>? activeFilters,
    double? zoomLevel,
  }) {
    return MapExplorationState(
      activeFilters: activeFilters ?? this.activeFilters,
      zoomLevel: zoomLevel ?? this.zoomLevel,
    );
  }
}

// Mock ë°ì´í„°
final mockMapData = [
  PlaceData(
    id: '1',
    name: 'ëŒ€ì¥ê¸ˆ ì¶”ì²œ ë§›ì§‘',
    address: 'ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
    type: MarkerType.influencer,
    isCertified: true,
    topMenus: [
      MenuData(name: 'íŠ¹ì„  í•œì •ì‹', price: 35000),
      MenuData(name: 'ì „ë³µì£½', price: 15000),
    ],
    mockX: 0.3,
    mockY: 0.4,
  ),
  PlaceData(
    id: '2',
    name: 'ì¸ì¦ ê°ˆë¹„ì§‘',
    address: 'ì„œì´ˆêµ¬ ê°•ë‚¨ëŒ€ë¡œ 456',
    type: MarkerType.certified,
    isCertified: true,
    topMenus: [
      MenuData(name: 'ì–‘ë…ê°ˆë¹„', price: 28000),
      MenuData(name: 'ëƒ‰ë©´', price: 10000),
    ],
    mockX: 0.5,
    mockY: 0.3,
  ),
  PlaceData(
    id: '3',
    name: 'í•«í”Œ íŒŒìŠ¤íƒ€',
    address: 'ê°•ë‚¨êµ¬ ë…¼í˜„ë¡œ 789',
    type: MarkerType.popular,
    isCertified: false,
    topMenus: [
      MenuData(name: 'íŠ¸ëŸ¬í”Œ íŒŒìŠ¤íƒ€', price: 22000),
      MenuData(name: 'ë§ˆë¥´ê²Œë¦¬íƒ€ í”¼ì', price: 18000),
    ],
    mockX: 0.7,
    mockY: 0.5,
  ),
  PlaceData(
    id: '4',
    name: 'í‘¸ë“œ í˜ìŠ¤í‹°ë²Œ',
    address: 'ê°•ë‚¨êµ¬ ì½”ì—‘ìŠ¤',
    type: MarkerType.event,
    isCertified: false,
    topMenus: [
      MenuData(name: 'íŠ¹ë³„ ì´ë²¤íŠ¸', price: 0),
    ],
    mockX: 0.6,
    mockY: 0.6,
  ),
];
```

## 4. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í”¼ë“œ ì§€ë„ì™€ íƒìƒ‰ ì§€ë„ ëª…í™•íˆ êµ¬ë¶„
- [ ] ë§ˆì»¤ íƒ€ì…ë³„ ë””ìì¸ ì ìš©
- [ ] í•„í„° ê¸°ëŠ¥ ì •ìƒ ì‘ë™
- [ ] ì¥ì†Œ ì„ íƒ ì‹œ ìƒì„¸ ì¹´ë“œ í‘œì‹œ
- [ ] Mock ë°ì´í„°ë¡œ ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥

### ğŸ“Š ë§ˆì»¤ ë””ìì¸ ê°€ì´ë“œ
| íƒ€ì… | ìƒ‰ìƒ | ì•„ì´ì½˜ | ìš©ë„ |
|------|------|--------|------|
| ëŒ€ì¥ê¸ˆ | ë…¸ë€ìƒ‰ | â­ | ì¸í”Œë£¨ì–¸ì„œ ì¶”ì²œ |
| ì¸ì¦ë§›ì§‘ | ì´ˆë¡ìƒ‰ | âœ“ | ê²€ì¦ëœ ë§›ì§‘ |
| ì¸ê¸°ë©”ë‰´ | ë¹¨ê°„ìƒ‰ | ğŸ”¥ | ì¶”ì²œ ë§ì€ ê³³ |
| ì´ë²¤íŠ¸ | ë³´ë¼ìƒ‰ | ğŸ‰ | íŠ¹ë³„ í–‰ì‚¬ |
| ì¹´í…Œê³ ë¦¬ | ê°ê° | ğŸœğŸ• | ìŒì‹ ì¢…ë¥˜ë³„ |