# ğŸ”” 6.8 ì•Œë¦¼ ëª©ë¡ í™”ë©´

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [Provider ì„¤ì •](#2-provider-ì„¤ì •)
3. [ì•Œë¦¼ í™”ë©´ êµ¬í˜„](#3-ì•Œë¦¼-í™”ë©´-êµ¬í˜„)
4. [ì•Œë¦¼ íƒ€ì…ë³„ ì²˜ë¦¬](#4-ì•Œë¦¼-íƒ€ì…ë³„-ì²˜ë¦¬)
5. [ì‹¤ì‹œê°„ ì•Œë¦¼ ìˆ˜ì‹ ](#5-ì‹¤ì‹œê°„-ì•Œë¦¼-ìˆ˜ì‹ )
6. [ì•Œë¦¼ ì„¤ì • ê´€ë¦¬](#6-ì•Œë¦¼-ì„¤ì •-ê´€ë¦¬)

## 1. ê°œìš”

ì•Œë¦¼ í™”ë©´ì€ ì‚¬ìš©ìì˜ ëª¨ë“  í™œë™ ì•Œë¦¼ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ê³  í‘œì‹œí•˜ëŠ” í—ˆë¸Œ ì—­í• ì„ í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… ë‹¤ì–‘í•œ ì•Œë¦¼ íƒ€ì… ì§€ì›
- âœ… ì‹¤ì‹œê°„ ì•Œë¦¼ ì—…ë°ì´íŠ¸
- âœ… ì½ìŒ/ì•ˆì½ìŒ ìƒíƒœ ê´€ë¦¬

## 2. Provider ì„¤ì •

### [í•„ìˆ˜] ì•Œë¦¼ ê´€ë ¨ Provider
```dart
// íŒŒì¼: lib/providers/notification/notification_provider.dart
import 'package:riverpod_annotation/riverpod_annotation.dart';
import 'package:fallingo/models/notification.dart';
import 'package:fallingo/services/notification_service.dart';
import 'package:fallingo/providers/auth/auth_provider.dart';

part 'notification_provider.g.dart';

// ì•Œë¦¼ ëª©ë¡ Provider
@riverpod
class NotificationList extends _$NotificationList {
  @override
  Future<List<AppNotification>> build() async {
    final user = ref.watch(currentUserProvider);
    if (user == null) return [];
    
    final service = ref.read(notificationServiceProvider);
    return service.getNotifications(user.id);
  }

  // ì•Œë¦¼ ìƒˆë¡œê³ ì¹¨
  Future<void> refresh() async {
    ref.invalidateSelf();
  }

  // ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
  Future<void> markAsRead(String notificationId) async {
    final service = ref.read(notificationServiceProvider);
    await service.markAsRead(notificationId);
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸
    final currentList = state.valueOrNull ?? [];
    final updatedList = currentList.map((notification) {
      if (notification.id == notificationId) {
        return notification.copyWith(isRead: true);
      }
      return notification;
    }).toList();
    
    state = AsyncValue.data(updatedList);
  }

  // ëª¨ë‘ ì½ìŒ ì²˜ë¦¬
  Future<void> markAllAsRead() async {
    final user = ref.watch(currentUserProvider);
    if (user == null) return;
    
    final service = ref.read(notificationServiceProvider);
    await service.markAllAsRead(user.id);
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸
    final currentList = state.valueOrNull ?? [];
    final updatedList = currentList.map((notification) {
      return notification.copyWith(isRead: true);
    }).toList();
    
    state = AsyncValue.data(updatedList);
  }

  // ì•Œë¦¼ ì‚­ì œ
  Future<void> deleteNotification(String notificationId) async {
    final service = ref.read(notificationServiceProvider);
    await service.deleteNotification(notificationId);
    
    // ìƒíƒœì—ì„œ ì œê±°
    final currentList = state.valueOrNull ?? [];
    final updatedList = currentList
        .where((notification) => notification.id != notificationId)
        .toList();
    
    state = AsyncValue.data(updatedList);
  }
}

// ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°œìˆ˜ Provider
@riverpod
Future<int> unreadNotificationCount(UnreadNotificationCountRef ref) async {
  final notifications = await ref.watch(notificationListProvider.future);
  return notifications.where((n) => !n.isRead).length;
}

// ì‹¤ì‹œê°„ ì•Œë¦¼ ìŠ¤íŠ¸ë¦¼ Provider
@riverpod
Stream<AppNotification> notificationStream(NotificationStreamRef ref) {
  final user = ref.watch(currentUserProvider);
  if (user == null) return const Stream.empty();
  
  final service = ref.read(notificationServiceProvider);
  return service.streamNotifications(user.id);
}

// ì•Œë¦¼ ì„¤ì • Provider
@freezed
class NotificationSettings with _$NotificationSettings {
  const factory NotificationSettings({
    @Default(true) bool pushEnabled,
    @Default(true) bool feedRecommendations,
    @Default(true) bool comments,
    @Default(true) bool follows,
    @Default(true) bool nearbyInfluencers,
    @Default(true) bool events,
    @Default(false) bool marketing,
  }) = _NotificationSettings;
}

@riverpod
class UserNotificationSettings extends _$UserNotificationSettings {
  @override
  Future<NotificationSettings> build() async {
    final user = ref.watch(currentUserProvider);
    if (user == null) return const NotificationSettings();
    
    final service = ref.read(notificationServiceProvider);
    return service.getSettings(user.id);
  }

  Future<void> updateSettings(NotificationSettings settings) async {
    final user = ref.watch(currentUserProvider);
    if (user == null) return;
    
    state = const AsyncValue.loading();
    state = await AsyncValue.guard(() async {
      final service = ref.read(notificationServiceProvider);
      await service.updateSettings(user.id, settings);
      return settings;
    });
  }
}
```

## 3. ì•Œë¦¼ í™”ë©´ êµ¬í˜„

### [í•„ìˆ˜] ë©”ì¸ ì•Œë¦¼ í™”ë©´
```dart
// íŒŒì¼: lib/screens/notification/notification_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:fallingo/providers/notification/notification_provider.dart';
import 'package:fallingo/models/notification.dart';
import 'package:fallingo/widgets/notification/notification_tile.dart';
import 'package:fallingo/core/theme/app_colors.dart';

class NotificationScreen extends ConsumerStatefulWidget {
  const NotificationScreen({Key? key}) : super(key: key);

  @override
  ConsumerState<NotificationScreen> createState() => _NotificationScreenState();
}

class _NotificationScreenState extends ConsumerState<NotificationScreen> {
  @override
  void initState() {
    super.initState();
    // í™”ë©´ ì§„ì… ì‹œ ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
    WidgetsBinding.instance.addPostFrameCallback((_) {
      _markVisibleNotificationsAsRead();
    });
  }

  @override
  Widget build(BuildContext context) {
    final notificationsAsync = ref.watch(notificationListProvider);

    return Scaffold(
      backgroundColor: Colors.grey[50],
      appBar: AppBar(
        title: const Text('ì•Œë¦¼'),
        backgroundColor: AppColors.primaryOrange,
        actions: [
          // ì„¤ì • ë²„íŠ¼
          IconButton(
            icon: const Icon(Icons.settings),
            onPressed: () => _navigateToSettings(context),
          ),
          // ëª¨ë‘ ì½ìŒ ë²„íŠ¼
          TextButton(
            onPressed: notificationsAsync.maybeWhen(
              data: (notifications) {
                final hasUnread = notifications.any((n) => !n.isRead);
                return hasUnread ? _markAllAsRead : null;
              },
              orElse: () => null,
            ),
            child: const Text(
              'ëª¨ë‘ ì½ìŒ',
              style: TextStyle(color: Colors.white),
            ),
          ),
        ],
      ),
      body: notificationsAsync.when(
        data: (notifications) => _buildNotificationList(notifications),
        loading: () => const Center(
          child: CircularProgressIndicator(
            valueColor: AlwaysStoppedAnimation<Color>(AppColors.primaryOrange),
          ),
        ),
        error: (error, stack) => _buildErrorWidget(error),
      ),
    );
  }

  Widget _buildNotificationList(List<AppNotification> notifications) {
    if (notifications.isEmpty) {
      return Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.notifications_none,
              size: 80,
              color: Colors.grey[400],
            ),
            const SizedBox(height: 16),
            Text(
              'ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤',
              style: TextStyle(
                fontSize: 16,
                color: Colors.grey[600],
              ),
            ),
          ],
        ),
      );
    }

    // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
    final groupedNotifications = _groupNotificationsByDate(notifications);

    return RefreshIndicator(
      onRefresh: () => ref.read(notificationListProvider.notifier).refresh(),
      child: ListView.builder(
        padding: const EdgeInsets.symmetric(vertical: 8),
        itemCount: groupedNotifications.length,
        itemBuilder: (context, index) {
          final entry = groupedNotifications.entries.elementAt(index);
          final dateLabel = entry.key;
          final dateNotifications = entry.value;

          return Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // ë‚ ì§œ í—¤ë”
              Padding(
                padding: const EdgeInsets.symmetric(
                  horizontal: 16,
                  vertical: 8,
                ),
                child: Text(
                  dateLabel,
                  style: TextStyle(
                    fontSize: 14,
                    fontWeight: FontWeight.bold,
                    color: Colors.grey[700],
                  ),
                ),
              ),
              // ì•Œë¦¼ ëª©ë¡
              ...dateNotifications.map((notification) {
                return Dismissible(
                  key: Key(notification.id),
                  direction: DismissDirection.endToStart,
                  background: Container(
                    alignment: Alignment.centerRight,
                    padding: const EdgeInsets.only(right: 16),
                    color: Colors.red,
                    child: const Icon(
                      Icons.delete,
                      color: Colors.white,
                    ),
                  ),
                  onDismissed: (_) => _deleteNotification(notification.id),
                  child: NotificationTile(
                    notification: notification,
                    onTap: () => _handleNotificationTap(notification),
                  ),
                );
              }).toList(),
            ],
          );
        },
      ),
    );
  }

  Map<String, List<AppNotification>> _groupNotificationsByDate(
    List<AppNotification> notifications,
  ) {
    final now = DateTime.now();
    final today = DateTime(now.year, now.month, now.day);
    final yesterday = today.subtract(const Duration(days: 1));

    final grouped = <String, List<AppNotification>>{};

    for (final notification in notifications) {
      final date = DateTime(
        notification.createdAt.year,
        notification.createdAt.month,
        notification.createdAt.day,
      );

      String dateLabel;
      if (date == today) {
        dateLabel = 'ì˜¤ëŠ˜';
      } else if (date == yesterday) {
        dateLabel = 'ì–´ì œ';
      } else if (date.isAfter(today.subtract(const Duration(days: 7)))) {
        dateLabel = 'ì´ë²ˆ ì£¼';
      } else {
        dateLabel = '${date.month}ì›” ${date.day}ì¼';
      }

      grouped.putIfAbsent(dateLabel, () => []).add(notification);
    }

    return grouped;
  }

  Widget _buildErrorWidget(Object error) {
    return Center(
      child: Padding(
        padding: const EdgeInsets.all(16),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.error_outline,
              size: 60,
              color: Colors.red[300],
            ),
            const SizedBox(height: 16),
            const Text(
              'ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
              style: TextStyle(fontSize: 18),
            ),
            const SizedBox(height: 8),
            Text(
              error.toString(),
              style: TextStyle(color: Colors.grey[600]),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: 16),
            ElevatedButton(
              onPressed: () {
                ref.refresh(notificationListProvider);
              },
              child: const Text('ë‹¤ì‹œ ì‹œë„'),
            ),
          ],
        ),
      ),
    );
  }

  Future<void> _markVisibleNotificationsAsRead() async {
    final notifications = ref.read(notificationListProvider).valueOrNull ?? [];
    final unreadNotifications = notifications.where((n) => !n.isRead);

    for (final notification in unreadNotifications) {
      await ref
          .read(notificationListProvider.notifier)
          .markAsRead(notification.id);
    }
  }

  Future<void> _markAllAsRead() async {
    await ref.read(notificationListProvider.notifier).markAllAsRead();
  }

  Future<void> _deleteNotification(String notificationId) async {
    await ref
        .read(notificationListProvider.notifier)
        .deleteNotification(notificationId);

    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: const Text('ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'),
          action: SnackBarAction(
            label: 'ì‹¤í–‰ ì·¨ì†Œ',
            onPressed: () {
              // TODO: ì‚­ì œ ì·¨ì†Œ êµ¬í˜„
              ref.refresh(notificationListProvider);
            },
          ),
        ),
      );
    }
  }

  void _handleNotificationTap(AppNotification notification) {
    // ì½ìŒ ì²˜ë¦¬
    if (!notification.isRead) {
      ref
          .read(notificationListProvider.notifier)
          .markAsRead(notification.id);
    }

    // íƒ€ì…ë³„ ë„¤ë¹„ê²Œì´ì…˜
    switch (notification.type) {
      case NotificationType.feedRecommend:
      case NotificationType.comment:
        Navigator.pushNamed(
          context,
          '/feed/detail',
          arguments: notification.targetId,
        );
        break;
      case NotificationType.follow:
        Navigator.pushNamed(
          context,
          '/profile',
          arguments: notification.targetId,
        );
        break;
      case NotificationType.nearbyInfluencer:
        Navigator.pushNamed(
          context,
          '/map',
          arguments: {'focusUserId': notification.targetId},
        );
        break;
      case NotificationType.event:
        Navigator.pushNamed(
          context,
          '/event/detail',
          arguments: notification.targetId,
        );
        break;
      case NotificationType.gradeUp:
      case NotificationType.system:
        // íŠ¹ë³„í•œ ë™ì‘ ì—†ìŒ
        break;
    }
  }

  void _navigateToSettings(BuildContext context) {
    Navigator.pushNamed(context, '/notification/settings');
  }
}
```

## 4. ì•Œë¦¼ íƒ€ì…ë³„ ì²˜ë¦¬

### [í•„ìˆ˜] ì•Œë¦¼ íƒ€ì¼ ìœ„ì ¯
```dart
// íŒŒì¼: lib/widgets/notification/notification_tile.dart
import 'package:flutter/material.dart';
import 'package:fallingo/models/notification.dart';
import 'package:fallingo/core/theme/app_colors.dart';
import 'package:timeago/timeago.dart' as timeago;

class NotificationTile extends StatelessWidget {
  final AppNotification notification;
  final VoidCallback onTap;

  const NotificationTile({
    Key? key,
    required this.notification,
    required this.onTap,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Material(
      color: notification.isRead ? Colors.white : Colors.blue[50],
      child: InkWell(
        onTap: onTap,
        child: Container(
          padding: const EdgeInsets.all(16),
          decoration: BoxDecoration(
            border: Border(
              bottom: BorderSide(
                color: Colors.grey[200]!,
                width: 0.5,
              ),
            ),
          ),
          child: Row(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // ì•„ì´ì½˜
              _buildIcon(),
              const SizedBox(width: 12),
              // ë‚´ìš©
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    // ì œëª©
                    Text(
                      _getTitle(),
                      style: TextStyle(
                        fontWeight: notification.isRead
                            ? FontWeight.normal
                            : FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 4),
                    // ë³¸ë¬¸
                    Text(
                      notification.message,
                      style: TextStyle(
                        fontSize: 14,
                        color: Colors.grey[700],
                      ),
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                    const SizedBox(height: 4),
                    // ì‹œê°„
                    Text(
                      timeago.format(notification.createdAt, locale: 'ko'),
                      style: TextStyle(
                        fontSize: 12,
                        color: Colors.grey[500],
                      ),
                    ),
                  ],
                ),
              ),
              // ì´ë¯¸ì§€ (ìˆëŠ” ê²½ìš°)
              if (notification.imageUrl != null) ...[
                const SizedBox(width: 12),
                ClipRRect(
                  borderRadius: BorderRadius.circular(8),
                  child: Image.network(
                    notification.imageUrl!,
                    width: 60,
                    height: 60,
                    fit: BoxFit.cover,
                    errorBuilder: (_, __, ___) => Container(
                      width: 60,
                      height: 60,
                      color: Colors.grey[300],
                      child: const Icon(Icons.image, color: Colors.grey),
                    ),
                  ),
                ),
              ],
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildIcon() {
    IconData iconData;
    Color iconColor;

    switch (notification.type) {
      case NotificationType.feedRecommend:
        iconData = Icons.favorite;
        iconColor = Colors.red;
        break;
      case NotificationType.comment:
        iconData = Icons.comment;
        iconColor = Colors.blue;
        break;
      case NotificationType.follow:
        iconData = Icons.person_add;
        iconColor = Colors.green;
        break;
      case NotificationType.nearbyInfluencer:
        iconData = Icons.star;
        iconColor = Colors.amber;
        break;
      case NotificationType.event:
        iconData = Icons.celebration;
        iconColor = Colors.purple;
        break;
      case NotificationType.gradeUp:
        iconData = Icons.emoji_events;
        iconColor = AppColors.primaryOrange;
        break;
      case NotificationType.system:
        iconData = Icons.info;
        iconColor = Colors.grey;
        break;
    }

    return Container(
      width: 40,
      height: 40,
      decoration: BoxDecoration(
        color: iconColor.withOpacity(0.1),
        shape: BoxShape.circle,
      ),
      child: Icon(
        iconData,
        color: iconColor,
        size: 20,
      ),
    );
  }

  String _getTitle() {
    switch (notification.type) {
      case NotificationType.feedRecommend:
        return '${notification.fromUserName}ë‹˜ì´ íšŒì›ë‹˜ì˜ í”¼ë“œë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤';
      case NotificationType.comment:
        return '${notification.fromUserName}ë‹˜ì´ ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤';
      case NotificationType.follow:
        return '${notification.fromUserName}ë‹˜ì´ íŒ”ë¡œìš°í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤';
      case NotificationType.nearbyInfluencer:
        return 'ê·¼ì²˜ì— ì¸í”Œë£¨ì–¸ì„œê°€ ìˆìŠµë‹ˆë‹¤!';
      case NotificationType.event:
        return 'ìƒˆë¡œìš´ ì´ë²¤íŠ¸';
      case NotificationType.gradeUp:
        return 'ğŸ‰ ë“±ê¸‰ì´ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤!';
      case NotificationType.system:
        return 'ì‹œìŠ¤í…œ ì•Œë¦¼';
    }
  }
}
```

## 5. ì‹¤ì‹œê°„ ì•Œë¦¼ ìˆ˜ì‹ 

### [í•„ìˆ˜] ì‹¤ì‹œê°„ ì•Œë¦¼ ë¦¬ìŠ¤ë„ˆ
```dart
// íŒŒì¼: lib/widgets/notification/realtime_notification_listener.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:fallingo/providers/notification/notification_provider.dart';
import 'package:fallingo/models/notification.dart';

class RealtimeNotificationListener extends ConsumerStatefulWidget {
  final Widget child;

  const RealtimeNotificationListener({
    Key? key,
    required this.child,
  }) : super(key: key);

  @override
  ConsumerState<RealtimeNotificationListener> createState() =>
      _RealtimeNotificationListenerState();
}

class _RealtimeNotificationListenerState
    extends ConsumerState<RealtimeNotificationListener> {
  @override
  Widget build(BuildContext context) {
    // ì‹¤ì‹œê°„ ì•Œë¦¼ êµ¬ë…
    ref.listen(notificationStreamProvider, (previous, next) {
      next.whenData((notification) {
        _showInAppNotification(notification);
        // ì•Œë¦¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        ref.refresh(notificationListProvider);
        ref.refresh(unreadNotificationCountProvider);
      });
    });

    return widget.child;
  }

  void _showInAppNotification(AppNotification notification) {
    // íŠ¹ë³„í•œ ì•Œë¦¼ íƒ€ì…ë³„ ì²˜ë¦¬
    if (notification.type == NotificationType.nearbyInfluencer) {
      _showInfluencerNotification(notification);
    } else if (notification.type == NotificationType.gradeUp) {
      _showGradeUpAnimation(notification);
    } else {
      _showDefaultNotification(notification);
    }
  }

  void _showDefaultNotification(AppNotification notification) {
    final overlay = Overlay.of(context);
    final overlayEntry = OverlayEntry(
      builder: (context) => _NotificationBanner(
        notification: notification,
        onTap: () {
          // ì•Œë¦¼ íƒ­ ì²˜ë¦¬
          _handleNotificationTap(notification);
        },
      ),
    );

    overlay.insert(overlayEntry);

    // 3ì´ˆ í›„ ìë™ ì œê±°
    Future.delayed(const Duration(seconds: 3), () {
      overlayEntry.remove();
    });
  }

  void _showInfluencerNotification(AppNotification notification) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Row(
          children: [
            const Icon(Icons.star, color: Colors.yellow),
            const SizedBox(width: 8),
            Expanded(
              child: Text(notification.message),
            ),
          ],
        ),
        backgroundColor: Colors.orange,
        action: SnackBarAction(
          label: 'ë³´ê¸°',
          textColor: Colors.white,
          onPressed: () => _handleNotificationTap(notification),
        ),
      ),
    );
  }

  void _showGradeUpAnimation(AppNotification notification) {
    showDialog(
      context: context,
      barrierDismissible: false,
      builder: (context) => _GradeUpDialog(
        notification: notification,
      ),
    );
  }

  void _handleNotificationTap(AppNotification notification) {
    // NotificationScreenì˜ í•¸ë“¤ëŸ¬ì™€ ë™ì¼í•œ ë¡œì§
  }
}

// ì•Œë¦¼ ë°°ë„ˆ ìœ„ì ¯
class _NotificationBanner extends StatefulWidget {
  final AppNotification notification;
  final VoidCallback onTap;

  const _NotificationBanner({
    required this.notification,
    required this.onTap,
  });

  @override
  State<_NotificationBanner> createState() => _NotificationBannerState();
}

class _NotificationBannerState extends State<_NotificationBanner>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<Offset> _offsetAnimation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 300),
      vsync: this,
    );
    _offsetAnimation = Tween<Offset>(
      begin: const Offset(0.0, -1.0),
      end: Offset.zero,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeOut,
    ));
    _controller.forward();
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Positioned(
      top: MediaQuery.of(context).padding.top + 8,
      left: 16,
      right: 16,
      child: SlideTransition(
        position: _offsetAnimation,
        child: Material(
          elevation: 8,
          borderRadius: BorderRadius.circular(12),
          child: InkWell(
            onTap: widget.onTap,
            borderRadius: BorderRadius.circular(12),
            child: Container(
              padding: const EdgeInsets.all(16),
              decoration: BoxDecoration(
                color: Colors.white,
                borderRadius: BorderRadius.circular(12),
              ),
              child: Row(
                children: [
                  // ì•„ì´ì½˜
                  Icon(
                    _getIcon(widget.notification.type),
                    color: AppColors.primaryOrange,
                  ),
                  const SizedBox(width: 12),
                  // ë‚´ìš©
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        Text(
                          _getTitle(widget.notification.type),
                          style: const TextStyle(
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                        Text(
                          widget.notification.message,
                          style: TextStyle(
                            fontSize: 14,
                            color: Colors.grey[700],
                          ),
                          maxLines: 1,
                          overflow: TextOverflow.ellipsis,
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }

  IconData _getIcon(NotificationType type) {
    // NotificationTileì˜ ë¡œì§ê³¼ ë™ì¼
  }

  String _getTitle(NotificationType type) {
    // NotificationTileì˜ ë¡œì§ê³¼ ë™ì¼
  }
}

// ë“±ê¸‰ ìƒìŠ¹ ë‹¤ì´ì–¼ë¡œê·¸
class _GradeUpDialog extends StatelessWidget {
  final AppNotification notification;

  const _GradeUpDialog({required this.notification});

  @override
  Widget build(BuildContext context) {
    return Dialog(
      backgroundColor: Colors.transparent,
      child: Container(
        padding: const EdgeInsets.all(24),
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(16),
        ),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            // í­ì£½ ì• ë‹ˆë©”ì´ì…˜ (Lottie ë˜ëŠ” ì»¤ìŠ¤í…€)
            Container(
              width: 120,
              height: 120,
              decoration: BoxDecoration(
                color: AppColors.primaryOrange.withOpacity(0.1),
                shape: BoxShape.circle,
              ),
              child: const Icon(
                Icons.emoji_events,
                size: 60,
                color: AppColors.primaryOrange,
              ),
            ),
            const SizedBox(height: 24),
            const Text(
              'ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰',
              style: TextStyle(
                fontSize: 24,
                fontWeight: FontWeight.bold,
              ),
            ),
            const SizedBox(height: 16),
            Text(
              notification.message,
              style: const TextStyle(fontSize: 16),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: 24),
            ElevatedButton(
              onPressed: () => Navigator.pop(context),
              style: ElevatedButton.styleFrom(
                backgroundColor: AppColors.primaryOrange,
                padding: const EdgeInsets.symmetric(
                  horizontal: 32,
                  vertical: 12,
                ),
              ),
              child: const Text('í™•ì¸'),
            ),
          ],
        ),
      ),
    );
  }
}
```

## 6. ì•Œë¦¼ ì„¤ì • ê´€ë¦¬

### [í•„ìˆ˜] ì•Œë¦¼ ì„¤ì • í™”ë©´
```dart
// íŒŒì¼: lib/screens/notification/notification_settings_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:fallingo/providers/notification/notification_provider.dart';
import 'package:fallingo/core/theme/app_colors.dart';

class NotificationSettingsScreen extends ConsumerWidget {
  const NotificationSettingsScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final settingsAsync = ref.watch(userNotificationSettingsProvider);

    return Scaffold(
      appBar: AppBar(
        title: const Text('ì•Œë¦¼ ì„¤ì •'),
        backgroundColor: AppColors.primaryOrange,
      ),
      body: settingsAsync.when(
        data: (settings) => _buildSettingsList(context, ref, settings),
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (error, _) => Center(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              const Icon(Icons.error_outline, size: 48, color: Colors.red),
              const SizedBox(height: 16),
              Text('ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: $error'),
              TextButton(
                onPressed: () => ref.refresh(userNotificationSettingsProvider),
                child: const Text('ë‹¤ì‹œ ì‹œë„'),
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildSettingsList(
    BuildContext context,
    WidgetRef ref,
    NotificationSettings settings,
  ) {
    return ListView(
      children: [
        // í‘¸ì‹œ ì•Œë¦¼ ë§ˆìŠ¤í„° ìŠ¤ìœ„ì¹˜
        SwitchListTile(
          title: const Text('í‘¸ì‹œ ì•Œë¦¼'),
          subtitle: const Text('ëª¨ë“  í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤'),
          value: settings.pushEnabled,
          activeColor: AppColors.primaryOrange,
          onChanged: (value) {
            _updateSettings(
              ref,
              settings.copyWith(pushEnabled: value),
            );
          },
        ),
        const Divider(),
        
        // ì¹´í…Œê³ ë¦¬ë³„ ì„¤ì •
        _buildCategoryHeader('í™œë™ ì•Œë¦¼'),
        SwitchListTile(
          title: const Text('ì¶”ì²œ ì•Œë¦¼'),
          subtitle: const Text('ë‚´ í”¼ë“œê°€ ì¶”ì²œë°›ì•˜ì„ ë•Œ ì•Œë¦¼'),
          value: settings.feedRecommendations,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(feedRecommendations: value),
                  );
                }
              : null,
        ),
        SwitchListTile(
          title: const Text('ëŒ“ê¸€ ì•Œë¦¼'),
          subtitle: const Text('ë‚´ í”¼ë“œì— ëŒ“ê¸€ì´ ë‹¬ë ¸ì„ ë•Œ ì•Œë¦¼'),
          value: settings.comments,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(comments: value),
                  );
                }
              : null,
        ),
        SwitchListTile(
          title: const Text('íŒ”ë¡œìš° ì•Œë¦¼'),
          subtitle: const Text('ëˆ„êµ°ê°€ ë‚˜ë¥¼ íŒ”ë¡œìš°í–ˆì„ ë•Œ ì•Œë¦¼'),
          value: settings.follows,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(follows: value),
                  );
                }
              : null,
        ),
        
        const Divider(),
        _buildCategoryHeader('ì£¼ë³€ ì•Œë¦¼'),
        SwitchListTile(
          title: const Text('ì¸í”Œë£¨ì–¸ì„œ ê·¼ì²˜ ì•Œë¦¼'),
          subtitle: const Text('ì¸í”Œë£¨ì–¸ì„œê°€ 1km ì´ë‚´ì— ìˆì„ ë•Œ ì•Œë¦¼'),
          value: settings.nearbyInfluencers,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(nearbyInfluencers: value),
                  );
                }
              : null,
        ),
        SwitchListTile(
          title: const Text('ì´ë²¤íŠ¸ ì•Œë¦¼'),
          subtitle: const Text('ì£¼ë³€ ì´ë²¤íŠ¸ ë° í–‰ì‚¬ ì•Œë¦¼'),
          value: settings.events,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(events: value),
                  );
                }
              : null,
        ),
        
        const Divider(),
        _buildCategoryHeader('ê¸°íƒ€'),
        SwitchListTile(
          title: const Text('ë§ˆì¼€íŒ… ì•Œë¦¼'),
          subtitle: const Text('ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜ ë“± ë§ˆì¼€íŒ… ì •ë³´'),
          value: settings.marketing,
          activeColor: AppColors.primaryOrange,
          enabled: settings.pushEnabled,
          onChanged: settings.pushEnabled
              ? (value) {
                  _updateSettings(
                    ref,
                    settings.copyWith(marketing: value),
                  );
                }
              : null,
        ),
        
        const SizedBox(height: 24),
        
        // ì•ˆë‚´ ë¬¸êµ¬
        Padding(
          padding: const EdgeInsets.all(16),
          child: Text(
            '* ì‹œìŠ¤í…œ ì•Œë¦¼(ë“±ê¸‰ ìƒìŠ¹, ì„œë¹„ìŠ¤ ê³µì§€ ë“±)ì€ í•­ìƒ ìˆ˜ì‹ ë©ë‹ˆë‹¤.',
            style: TextStyle(
              fontSize: 12,
              color: Colors.grey[600],
            ),
          ),
        ),
      ],
    );
  }

  Widget _buildCategoryHeader(String title) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      color: Colors.grey[100],
      child: Text(
        title,
        style: const TextStyle(
          fontSize: 14,
          fontWeight: FontWeight.bold,
          color: Colors.grey,
        ),
      ),
    );
  }

  Future<void> _updateSettings(
    WidgetRef ref,
    NotificationSettings settings,
  ) async {
    await ref
        .read(userNotificationSettingsProvider.notifier)
        .updateSettings(settings);
  }
  
}
```

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì•Œë¦¼ ëª©ë¡ Provider êµ¬í˜„
- [ ] ë‚ ì§œë³„ ê·¸ë£¹í™” ê¸°ëŠ¥
- [ ] ì‹¤ì‹œê°„ ì•Œë¦¼ ìˆ˜ì‹  ì²˜ë¦¬
- [ ] ì•Œë¦¼ ì„¤ì • ê´€ë¦¬
- [ ] ì½ìŒ/ì•ˆì½ìŒ ìƒíƒœ ê´€ë¦¬