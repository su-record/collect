# ğŸ”‘ 4.3 ì¸ì¦ UI íë¦„

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ì¸ì¦ ì„œë¹„ìŠ¤](#2-ì¸ì¦-ì„œë¹„ìŠ¤)
3. [ì¸ì¦ í™”ë©´](#3-ì¸ì¦-í™”ë©´)
4. [ì¸ì¦ ìƒíƒœ ê´€ë¦¬](#4-ì¸ì¦-ìƒíƒœ-ê´€ë¦¬)
5. [ìœ„ì¹˜ ë° êµ­ê°€ ì„¤ì •](#5-ìœ„ì¹˜-ë°-êµ­ê°€-ì„¤ì •)
6. [ë¼ìš°íŒ… ì„¤ì •](#6-ë¼ìš°íŒ…-ì„¤ì •)
7. [ê²€ì¦](#7-ê²€ì¦)

## 1. ê°œìš”

ì‚¬ìš©ì ì¸ì¦ UI íë¦„ê³¼ ìƒíƒœ ê´€ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… ì§ê´€ì ì¸ ë¡œê·¸ì¸/íšŒì›ê°€ì… UI
- âœ… ìë™ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
- âœ… ì¸ì¦ í›„ ìœ„ì¹˜ ê¶Œí•œ ë° êµ­ê°€ ì„¤ì •
- âœ… ì¸ì¦ ê¸°ë°˜ ë¼ìš°íŒ…
- âœ… Feature-based ì•„í‚¤í…ì²˜ ì ìš©

## 2. ì¸ì¦ ì„œë¹„ìŠ¤

### [í•„ìˆ˜] ê¸°ë³¸ ì¸ì¦ ì„œë¹„ìŠ¤
```dart
// íŒŒì¼: lib/services/auth_service.dart
import 'package:supabase_flutter/supabase_flutter.dart';

class AuthService {
  final _supabase = Supabase.instance.client;
  
  // ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸
  Future<AuthResponse> signInWithEmail({
    required String email,
    required String password,
  }) async {
    try {
      final response = await _supabase.auth.signInWithPassword(
        email: email,
        password: password,
      );
      
      if (response.session == null) {
        throw Exception('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
      
      return response;
    } on AuthException catch (e) {
      throw _handleAuthError(e);
    } catch (e) {
      throw Exception('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }
  }
  
  // ì´ë©”ì¼ë¡œ íšŒì›ê°€ì…
  Future<AuthResponse> signUpWithEmail({
    required String email,
    required String password,
    required String nickname,
  }) async {
    try {
      // 1. íšŒì›ê°€ì…
      final response = await _supabase.auth.signUp(
        email: email,
        password: password,
      );
      
      if (response.user == null) {
        throw Exception('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
      }
      
      // 2. ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„±
      await _supabase.from('users').insert({
        'id': response.user!.id,
        'email': email,
        'nickname': nickname,
        'created_at': DateTime.now().toIso8601String(),
      });
      
      return response;
    } on AuthException catch (e) {
      throw _handleAuthError(e);
    } catch (e) {
      throw Exception('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: $e');
    }
  }
  
  // ë¡œê·¸ì•„ì›ƒ
  Future<void> signOut() async {
    try {
      await _supabase.auth.signOut();
    } catch (e) {
      throw Exception('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }
  }
  
  // í˜„ì¬ ì‚¬ìš©ì
  User? get currentUser => _supabase.auth.currentUser;
  
  // ì„¸ì…˜
  Session? get currentSession => _supabase.auth.currentSession;
  
  // AuthException ì²˜ë¦¬
  String _handleAuthError(AuthException e) {
    switch (e.code) {
      case 'invalid_credentials':
        return 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤';
      case 'user_not_found':
        return 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
      case 'email_exists':
        return 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤';
      case 'weak_password':
        return 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤';
      case 'email_not_confirmed':
        return 'ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤';
      default:
        return e.message;
    }
  }
}
```

### [í•„ìˆ˜] ì†Œì…œ ì¸ì¦ ì„œë¹„ìŠ¤
```dart
// íŒŒì¼: lib/services/social_auth_service.dart
import 'dart:io';
import 'package:supabase_flutter/supabase_flutter.dart';
import 'package:google_sign_in/google_sign_in.dart';
import 'package:sign_in_with_apple/sign_in_with_apple.dart';
import 'package:crypto/crypto.dart';
import 'dart:convert';
import 'dart:math';

enum SocialProvider { google, apple }

class SocialAuthService {
  final _supabase = Supabase.instance.client;
  final _googleSignIn = GoogleSignIn();
  
  // ì‚¬ìš© ê°€ëŠ¥í•œ ì†Œì…œ ë¡œê·¸ì¸ ì œê³µì
  List<SocialProvider> get availableProviders {
    final providers = [SocialProvider.google];
    
    // iOSì—ì„œë§Œ Apple ë¡œê·¸ì¸ ì œê³µ
    if (Platform.isIOS) {
      providers.add(SocialProvider.apple);
    }
    
    return providers;
  }
  
  // ì†Œì…œ ë¡œê·¸ì¸
  Future<AuthResponse> signIn(SocialProvider provider) async {
    switch (provider) {
      case SocialProvider.google:
        return _signInWithGoogle();
      case SocialProvider.apple:
        return _signInWithApple();
    }
  }
  
  // Google ë¡œê·¸ì¸
  Future<AuthResponse> _signInWithGoogle() async {
    try {
      // Google ë¡œê·¸ì¸ ì‹œì‘
      final googleUser = await _googleSignIn.signIn();
      if (googleUser == null) {
        throw Exception('Google ë¡œê·¸ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤');
      }
      
      // ì¸ì¦ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      final googleAuth = await googleUser.authentication;
      final accessToken = googleAuth.accessToken;
      final idToken = googleAuth.idToken;
      
      if (accessToken == null || idToken == null) {
        throw Exception('Google ì¸ì¦ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
      
      // Supabaseë¡œ ë¡œê·¸ì¸
      final response = await _supabase.auth.signInWithIdToken(
        provider: OAuthProvider.google,
        idToken: idToken,
        accessToken: accessToken,
      );
      
      // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
      if (response.user != null) {
        await _updateUserProfile(
          userId: response.user!.id,
          email: googleUser.email,
          nickname: googleUser.displayName ?? googleUser.email.split('@').first,
          avatarUrl: googleUser.photoUrl,
        );
      }
      
      return response;
    } catch (e) {
      throw Exception('Google ë¡œê·¸ì¸ ì‹¤íŒ¨: $e');
    }
  }
  
  // Apple ë¡œê·¸ì¸
  Future<AuthResponse> _signInWithApple() async {
    try {
      // Apple ë¡œê·¸ì¸ ìš”ì²­ì„ ìœ„í•œ ì„ì˜ì˜ ë¬¸ìì—´ ìƒì„±
      final rawNonce = _generateNonce();
      final hashedNonce = sha256.convert(utf8.encode(rawNonce)).toString();
      
      // Apple ë¡œê·¸ì¸ ì‹œì‘
      final credential = await SignInWithApple.getAppleIDCredential(
        scopes: [
          AppleIDAuthorizationScopes.email,
          AppleIDAuthorizationScopes.fullName,
        ],
        nonce: hashedNonce,
      );
      
      // ID í† í° í™•ì¸
      final idToken = credential.identityToken;
      if (idToken == null) {
        throw Exception('Apple ID Tokenì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
      
      // Supabaseë¡œ ë¡œê·¸ì¸
      final response = await _supabase.auth.signInWithIdToken(
        provider: OAuthProvider.apple,
        idToken: idToken,
        nonce: rawNonce,
      );
      
      // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
      if (response.user != null) {
        final fullName = '${credential.givenName ?? ''} ${credential.familyName ?? ''}'.trim();
        await _updateUserProfile(
          userId: response.user!.id,
          email: credential.email ?? response.user!.email ?? '',
          nickname: fullName.isNotEmpty ? fullName : 'Apple User',
        );
      }
      
      return response;
    } catch (e) {
      throw Exception('Apple ë¡œê·¸ì¸ ì‹¤íŒ¨: $e');
    }
  }
  
  // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
  Future<void> _updateUserProfile({
    required String userId,
    required String email,
    required String nickname,
    String? avatarUrl,
  }) async {
    try {
      // ê¸°ì¡´ í”„ë¡œí•„ í™•ì¸
      final existing = await _supabase
          .from('users')
          .select()
          .eq('id', userId)
          .maybeSingle();
      
      if (existing == null) {
        // ì‹ ê·œ ì‚¬ìš©ì
        await _supabase.from('users').insert({
          'id': userId,
          'email': email,
          'nickname': nickname,
          'avatar_url': avatarUrl,
          'created_at': DateTime.now().toIso8601String(),
        });
      } else {
        // ê¸°ì¡´ ì‚¬ìš©ì - í•„ìš”ì‹œ ì—…ë°ì´íŠ¸
        final updates = <String, dynamic>{};
        if (existing['avatar_url'] == null && avatarUrl != null) {
          updates['avatar_url'] = avatarUrl;
        }
        
        if (updates.isNotEmpty) {
          await _supabase
              .from('users')
              .update(updates)
              .eq('id', userId);
        }
      }
    } catch (e) {
      // í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ëŠ” ë¡œê·¸ì¸ì„ ë§‰ì§€ ì•ŠìŒ
      print('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: $e');
    }
  }
  
  // Nonce ìƒì„±
  String _generateNonce([int length = 32]) {
    const charset = '0123456789ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvwxyz-._';
    final random = Random.secure();
    return List.generate(length, (_) => charset[random.nextInt(charset.length)]).join();
  }
  
  // ë¡œê·¸ì•„ì›ƒ
  Future<void> signOut() async {
    await _googleSignIn.signOut();
    await _supabase.auth.signOut();
  }
}
```

## 3. ì¸ì¦ í™”ë©´

### [í•„ìˆ˜] ë¡œê·¸ì¸ í™”ë©´
```dart
// íŒŒì¼: lib/features/auth/presentation/screens/login_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../../../../services/auth_service.dart';
import '../../../../services/social_auth_service.dart';

class LoginScreen extends ConsumerStatefulWidget {
  const LoginScreen({Key? key}) : super(key: key);

  @override
  ConsumerState<LoginScreen> createState() => _LoginScreenState();
}

class _LoginScreenState extends ConsumerState<LoginScreen> {
  final _formKey = GlobalKey<FormState>();
  final _emailController = TextEditingController();
  final _passwordController = TextEditingController();
  final _authService = AuthService();
  final _socialAuth = SocialAuthService();
  
  bool _isLoading = false;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: SingleChildScrollView(
          padding: const EdgeInsets.all(24.0),
          child: Form(
            key: _formKey,
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.stretch,
              children: [
                const SizedBox(height: 80),
                // ë¡œê³ 
                Center(
                  child: Container(
                    width: 100,
                    height: 100,
                    decoration: BoxDecoration(
                      color: Theme.of(context).primaryColor,
                      borderRadius: BorderRadius.circular(20),
                    ),
                    child: const Icon(
                      Icons.restaurant,
                      size: 60,
                      color: Colors.white,
                    ),
                  ),
                ),
                const SizedBox(height: 48),
                
                // ì´ë©”ì¼ ì…ë ¥
                TextFormField(
                  controller: _emailController,
                  decoration: const InputDecoration(
                    labelText: 'ì´ë©”ì¼',
                    prefixIcon: Icon(Icons.email_outlined),
                  ),
                  keyboardType: TextInputType.emailAddress,
                  validator: (value) {
                    if (value?.isEmpty ?? true) {
                      return 'ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”';
                    }
                    if (!value!.contains('@')) {
                      return 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”';
                    }
                    return null;
                  },
                ),
                const SizedBox(height: 16),
                
                // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
                TextFormField(
                  controller: _passwordController,
                  decoration: const InputDecoration(
                    labelText: 'ë¹„ë°€ë²ˆí˜¸',
                    prefixIcon: Icon(Icons.lock_outline),
                  ),
                  obscureText: true,
                  validator: (value) {
                    if (value?.isEmpty ?? true) {
                      return 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
                    }
                    if (value!.length < 6) {
                      return 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                    }
                    return null;
                  },
                ),
                const SizedBox(height: 24),
                
                // ë¡œê·¸ì¸ ë²„íŠ¼
                ElevatedButton(
                  onPressed: _isLoading ? null : _handleLogin,
                  style: ElevatedButton.styleFrom(
                    padding: const EdgeInsets.symmetric(vertical: 16),
                  ),
                  child: _isLoading
                      ? const CircularProgressIndicator()
                      : const Text('ë¡œê·¸ì¸'),
                ),
                const SizedBox(height: 16),
                
                // íšŒì›ê°€ì… ë§í¬
                TextButton(
                  onPressed: () {
                    Navigator.pushNamed(context, '/signup');
                  },
                  child: const Text('ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…'),
                ),
                
                const SizedBox(height: 32),
                const Divider(),
                const SizedBox(height: 32),
                
                // ì†Œì…œ ë¡œê·¸ì¸
                const Text(
                  'ê°„í¸ ë¡œê·¸ì¸',
                  textAlign: TextAlign.center,
                  style: TextStyle(color: Colors.grey),
                ),
                const SizedBox(height: 16),
                
                // Google ë¡œê·¸ì¸
                OutlinedButton.icon(
                  onPressed: () => _handleSocialLogin(SocialProvider.google),
                  icon: const Icon(
                    Icons.g_mobiledata,
                    size: 24,
                  ),
                  label: const Text('Googleë¡œ ê³„ì†í•˜ê¸°'),
                  style: OutlinedButton.styleFrom(
                    padding: const EdgeInsets.symmetric(vertical: 12),
                  ),
                ),
                
                // Apple ë¡œê·¸ì¸ (iOSë§Œ)
                if (_socialAuth.availableProviders.contains(SocialProvider.apple))
                  ...[
                    const SizedBox(height: 12),
                    OutlinedButton.icon(
                      onPressed: () => _handleSocialLogin(SocialProvider.apple),
                      icon: const Icon(Icons.apple),
                      label: const Text('Appleë¡œ ê³„ì†í•˜ê¸°'),
                      style: OutlinedButton.styleFrom(
                        padding: const EdgeInsets.symmetric(vertical: 12),
                        foregroundColor: Colors.black,
                      ),
                    ),
                  ],
              ],
            ),
          ),
        ),
      ),
    );
  }
  
  Future<void> _handleLogin() async {
    if (!_formKey.currentState!.validate()) return;
    
    setState(() => _isLoading = true);
    
    try {
      await _authService.signInWithEmail(
        email: _emailController.text,
        password: _passwordController.text,
      );
      
      if (mounted) {
        // ë¡œê·¸ì¸ ì„±ê³µ í›„ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì´ë™
        Navigator.pushReplacementNamed(context, '/location-setup');
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text(e.toString())),
        );
      }
    } finally {
      if (mounted) {
        setState(() => _isLoading = false);
      }
    }
  }
  
  Future<void> _handleSocialLogin(SocialProvider provider) async {
    try {
      await _socialAuth.signIn(provider);
      
      if (mounted) {
        // ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í›„ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì´ë™
        Navigator.pushReplacementNamed(context, '/location-setup');
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text(e.toString())),
        );
      }
    }
  }
  
  @override
  void dispose() {
    _emailController.dispose();
    _passwordController.dispose();
    super.dispose();
  }
}
```

### [í•„ìˆ˜] íšŒì›ê°€ì… í™”ë©´
```dart
// íŒŒì¼: lib/features/auth/presentation/screens/signup_screen.dart
import 'package:flutter/material.dart';
import '../../../../services/auth_service.dart';

class SignupScreen extends StatefulWidget {
  const SignupScreen({Key? key}) : super(key: key);

  @override
  State<SignupScreen> createState() => _SignupScreenState();
}

class _SignupScreenState extends State<SignupScreen> {
  final _formKey = GlobalKey<FormState>();
  final _emailController = TextEditingController();
  final _passwordController = TextEditingController();
  final _nicknameController = TextEditingController();
  final _authService = AuthService();
  
  bool _isLoading = false;
  bool _agreedToTerms = false;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('íšŒì›ê°€ì…'),
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(24.0),
        child: Form(
          key: _formKey,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: [
              // ì´ë©”ì¼
              TextFormField(
                controller: _emailController,
                decoration: const InputDecoration(
                  labelText: 'ì´ë©”ì¼',
                  prefixIcon: Icon(Icons.email_outlined),
                ),
                keyboardType: TextInputType.emailAddress,
                validator: _validateEmail,
              ),
              const SizedBox(height: 16),
              
              // ë¹„ë°€ë²ˆí˜¸
              TextFormField(
                controller: _passwordController,
                decoration: const InputDecoration(
                  labelText: 'ë¹„ë°€ë²ˆí˜¸',
                  prefixIcon: Icon(Icons.lock_outline),
                  helperText: '6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”',
                ),
                obscureText: true,
                validator: _validatePassword,
              ),
              const SizedBox(height: 16),
              
              // ë‹‰ë„¤ì„
              TextFormField(
                controller: _nicknameController,
                decoration: const InputDecoration(
                  labelText: 'ë‹‰ë„¤ì„',
                  prefixIcon: Icon(Icons.person_outline),
                  helperText: '2-20ì, í•œê¸€/ì˜ë¬¸/ìˆ«ì',
                ),
                validator: _validateNickname,
              ),
              const SizedBox(height: 24),
              
              // ì•½ê´€ ë™ì˜
              CheckboxListTile(
                value: _agreedToTerms,
                onChanged: (value) {
                  setState(() => _agreedToTerms = value ?? false);
                },
                title: const Text('ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•©ë‹ˆë‹¤'),
                controlAffinity: ListTileControlAffinity.leading,
              ),
              const SizedBox(height: 24),
              
              // ê°€ì… ë²„íŠ¼
              ElevatedButton(
                onPressed: (_isLoading || !_agreedToTerms) 
                    ? null 
                    : _handleSignup,
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(vertical: 16),
                ),
                child: _isLoading
                    ? const CircularProgressIndicator()
                    : const Text('ê°€ì…í•˜ê¸°'),
              ),
            ],
          ),
        ),
      ),
    );
  }
  
  String? _validateEmail(String? value) {
    if (value?.isEmpty ?? true) return 'ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”';
    if (!RegExp(r'^[\w\.-]+@[\w\.-]+\.\w+$').hasMatch(value!)) {
      return 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”';
    }
    return null;
  }
  
  String? _validatePassword(String? value) {
    if (value?.isEmpty ?? true) return 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
    if (value!.length < 6) return '6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”';
    return null;
  }
  
  String? _validateNickname(String? value) {
    if (value?.isEmpty ?? true) return 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”';
    if (value!.length < 2 || value.length > 20) {
      return '2-20ì ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”';
    }
    if (!RegExp(r'^[a-zA-Z0-9ê°€-í£]+$').hasMatch(value)) {
      return 'í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤';
    }
    return null;
  }
  
  Future<void> _handleSignup() async {
    if (!_formKey.currentState!.validate()) return;
    
    setState(() => _isLoading = true);
    
    try {
      await _authService.signUpWithEmail(
        email: _emailController.text,
        password: _passwordController.text,
        nickname: _nicknameController.text,
      );
      
      if (mounted) {
        // ê°€ì… ì™„ë£Œ í›„ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì´ë™
        Navigator.pushReplacementNamed(context, '/location-setup');
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text(e.toString())),
        );
      }
    } finally {
      if (mounted) {
        setState(() => _isLoading = false);
      }
    }
  }
  
  @override
  void dispose() {
    _emailController.dispose();
    _passwordController.dispose();
    _nicknameController.dispose();
    super.dispose();
  }
}
```

## 4. ì¸ì¦ ìƒíƒœ ê´€ë¦¬

### [í•„ìˆ˜] Auth State Provider
```dart
// íŒŒì¼: lib/features/auth/presentation/providers/auth_state_provider.dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

// ì¸ì¦ ìƒíƒœ ìŠ¤íŠ¸ë¦¼
final authStateProvider = StreamProvider<AuthState>((ref) {
  return Supabase.instance.client.auth.onAuthStateChange;
});

// í˜„ì¬ ì‚¬ìš©ì
final currentUserProvider = Provider<User?>((ref) {
  final authState = ref.watch(authStateProvider);
  return authState.maybeWhen(
    data: (state) => state.session?.user,
    orElse: () => null,
  );
});

// ë¡œê·¸ì¸ ì—¬ë¶€
final isAuthenticatedProvider = Provider<bool>((ref) {
  final user = ref.watch(currentUserProvider);
  return user != null;
});

// ì‚¬ìš©ì í”„ë¡œí•„
final userProfileProvider = FutureProvider.autoDispose<Map<String, dynamic>?>((ref) async {
  final user = ref.watch(currentUserProvider);
  if (user == null) return null;
  
  final response = await Supabase.instance.client
      .from('users')
      .select()
      .eq('id', user.id)
      .single();
      
  return response;
});

// ìœ„ì¹˜ ê¶Œí•œ ìƒíƒœ
final locationPermissionProvider = StateProvider<bool>((ref) => false);

// ì‚¬ìš©ì êµ­ê°€ ì„¤ì •
final userCountryProvider = StateProvider<String?>((ref) => null);
```

## 5. ìœ„ì¹˜ ë° êµ­ê°€ ì„¤ì •

### [í•„ìˆ˜] ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ í™”ë©´
```dart
// íŒŒì¼: lib/features/auth/presentation/screens/location_setup_screen.dart
import 'package:flutter/material.dart';
import 'package:geolocator/geolocator.dart';
import 'package:geocoding/geocoding.dart';
import '../../../../core/theme/app_colors.dart';

class LocationSetupScreen extends StatefulWidget {
  const LocationSetupScreen({Key? key}) : super(key: key);

  @override
  State<LocationSetupScreen> createState() => _LocationSetupScreenState();
}

class _LocationSetupScreenState extends State<LocationSetupScreen> {
  bool _isLoading = false;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(24.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              // ìœ„ì¹˜ ì•„ì´ì½˜
              Icon(
                Icons.location_on,
                size: 80,
                color: AppColors.primaryOrange,
              ),
              const SizedBox(height: 32),
              
              // ì œëª©
              const Text(
                'ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤',
                style: TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 16),
              
              // ì„¤ëª…
              const Text(
                'FallingoëŠ” í˜„ì¬ ìœ„ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ\n'
                'ì£¼ë³€ ë§›ì§‘ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.\n'
                'ìœ„ì¹˜ ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: 16,
                  color: Colors.grey,
                ),
              ),
              const SizedBox(height: 48),
              
              // ê¶Œí•œ ìš”ì²­ ë²„íŠ¼
              ElevatedButton(
                onPressed: _isLoading ? null : _requestLocationPermission,
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 48,
                    vertical: 16,
                  ),
                ),
                child: _isLoading
                    ? const CircularProgressIndicator()
                    : const Text('ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©'),
              ),
              
              const SizedBox(height: 16),
              
              // ë‚˜ì¤‘ì— ì„¤ì •
              TextButton(
                onPressed: () {
                  Navigator.pushReplacementNamed(context, '/home');
                },
                child: const Text('ë‚˜ì¤‘ì— ì„¤ì •í•˜ê¸°'),
              ),
            ],
          ),
        ),
      ),
    );
  }
  
  Future<void> _requestLocationPermission() async {
    setState(() => _isLoading = true);
    
    try {
      // ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
      final permission = await Geolocator.requestPermission();
      
      if (permission == LocationPermission.denied ||
          permission == LocationPermission.deniedForever) {
        if (mounted) {
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text('ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ ë³€ê²½í•´ì£¼ì„¸ìš”.'),
            ),
          );
          Navigator.pushReplacementNamed(context, '/home');
        }
        return;
      }
      
      // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
      final position = await Geolocator.getCurrentPosition();
      
      // êµ­ê°€ ê°ì§€
      final placemarks = await placemarkFromCoordinates(
        position.latitude,
        position.longitude,
      );
      
      final country = placemarks.first.isoCountryCode ?? 'KR';
      
      if (mounted) {
        // êµ­ê°€ í™•ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
        Navigator.pushReplacementNamed(
          context,
          '/country-confirm',
          arguments: country,
        );
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: $e')),
        );
        Navigator.pushReplacementNamed(context, '/home');
      }
    } finally {
      if (mounted) {
        setState(() => _isLoading = false);
      }
    }
  }
}
```

### [í•„ìˆ˜] êµ­ê°€ í™•ì¸ í™”ë©´
```dart
// íŒŒì¼: lib/features/auth/presentation/screens/country_confirm_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:supabase_flutter/supabase_flutter.dart';
import '../providers/auth_state_provider.dart';
import '../../../../core/constants/countries.dart';

class CountryConfirmScreen extends ConsumerWidget {
  final String detectedCountry;
  
  const CountryConfirmScreen({
    Key? key,
    required this.detectedCountry,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final countryName = Countries.getName(detectedCountry);
    final countryFlag = Countries.getFlag(detectedCountry);
    
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(24.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              // êµ­ê¸°
              Text(
                countryFlag,
                style: const TextStyle(fontSize: 80),
              ),
              const SizedBox(height: 32),
              
              // í™•ì¸ ë©”ì‹œì§€
              Text(
                '$countryNameì—ì„œ\nì ‘ì†í•˜ì‹  ê²Œ ë§ë‚˜ìš”?',
                textAlign: TextAlign.center,
                style: const TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 48),
              
              // í™•ì¸ ë²„íŠ¼
              ElevatedButton(
                onPressed: () async {
                  // êµ­ê°€ ì„¤ì • ì €ì¥
                  ref.read(userCountryProvider.notifier).state = detectedCountry;
                  await _saveUserCountry(ref, detectedCountry);
                  
                  if (context.mounted) {
                    Navigator.pushReplacementNamed(context, '/home');
                  }
                },
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 48,
                    vertical: 16,
                  ),
                ),
                child: const Text('ë„¤, ë§ìŠµë‹ˆë‹¤'),
              ),
              const SizedBox(height: 16),
              
              // ë³€ê²½ ë²„íŠ¼
              OutlinedButton(
                onPressed: () {
                  Navigator.pushNamed(context, '/country-select');
                },
                style: OutlinedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 48,
                    vertical: 16,
                  ),
                ),
                child: const Text('ì•„ë‹ˆìš”, ë‹¤ë¥¸ êµ­ê°€ì…ë‹ˆë‹¤'),
              ),
            ],
          ),
        ),
      ),
    );
  }
  
  Future<void> _saveUserCountry(WidgetRef ref, String country) async {
    final user = ref.read(currentUserProvider);
    if (user == null) return;
    
    await Supabase.instance.client
        .from('users')
        .update({'country': country})
        .eq('id', user.id);
  }
}
```

### [í•„ìˆ˜] êµ­ê°€ ì„ íƒ í™”ë©´
```dart
// íŒŒì¼: lib/features/auth/presentation/screens/country_select_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:supabase_flutter/supabase_flutter.dart';
import '../providers/auth_state_provider.dart';
import '../../../../core/constants/countries.dart';

class CountrySelectScreen extends ConsumerStatefulWidget {
  const CountrySelectScreen({Key? key}) : super(key: key);

  @override
  ConsumerState<CountrySelectScreen> createState() => _CountrySelectScreenState();
}

class _CountrySelectScreenState extends ConsumerState<CountrySelectScreen> {
  final _searchController = TextEditingController();
  List<String> _filteredCountries = Countries.supportedCountries;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('êµ­ê°€ ì„ íƒ'),
      ),
      body: Column(
        children: [
          // ê²€ìƒ‰ì°½
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: TextField(
              controller: _searchController,
              decoration: const InputDecoration(
                hintText: 'êµ­ê°€ ê²€ìƒ‰',
                prefixIcon: Icon(Icons.search),
                border: OutlineInputBorder(),
              ),
              onChanged: _filterCountries,
            ),
          ),
          
          // êµ­ê°€ ëª©ë¡
          Expanded(
            child: ListView.builder(
              itemCount: _filteredCountries.length,
              itemBuilder: (context, index) {
                final countryCode = _filteredCountries[index];
                final countryName = Countries.getName(countryCode);
                final countryFlag = Countries.getFlag(countryCode);
                
                return ListTile(
                  leading: Text(
                    countryFlag,
                    style: const TextStyle(fontSize: 32),
                  ),
                  title: Text(countryName),
                  onTap: () async {
                    ref.read(userCountryProvider.notifier).state = countryCode;
                    await _saveUserCountry(countryCode);
                    
                    if (mounted) {
                      Navigator.pushReplacementNamed(context, '/home');
                    }
                  },
                );
              },
            ),
          ),
        ],
      ),
    );
  }
  
  void _filterCountries(String query) {
    setState(() {
      if (query.isEmpty) {
        _filteredCountries = Countries.supportedCountries;
      } else {
        _filteredCountries = Countries.supportedCountries
            .where((code) => Countries.getName(code)
                .toLowerCase()
                .contains(query.toLowerCase()))
            .toList();
      }
    });
  }
  
  Future<void> _saveUserCountry(String country) async {
    final user = ref.read(currentUserProvider);
    if (user == null) return;
    
    await Supabase.instance.client
        .from('users')
        .update({'country': country})
        .eq('id', user.id);
  }
  
  @override
  void dispose() {
    _searchController.dispose();
    super.dispose();
  }
}
```

### [í•„ìˆ˜] êµ­ê°€ ìƒìˆ˜ ì •ì˜
```dart
// íŒŒì¼: lib/core/constants/countries.dart
class Countries {
  static const List<String> supportedCountries = [
    'KR', // í•œêµ­
    'JP', // ì¼ë³¸
    'CN', // ì¤‘êµ­
    'TW', // ëŒ€ë§Œ
    'US', // ë¯¸êµ­
    'TH', // íƒœêµ­
    'VN', // ë² íŠ¸ë‚¨
    'SG', // ì‹±ê°€í¬ë¥´
    'MY', // ë§ë ˆì´ì‹œì•„
    'ID', // ì¸ë„ë„¤ì‹œì•„
  ];
  
  static String getName(String code) {
    switch (code) {
      case 'KR': return 'ëŒ€í•œë¯¼êµ­';
      case 'JP': return 'ì¼ë³¸';
      case 'CN': return 'ì¤‘êµ­';
      case 'TW': return 'ëŒ€ë§Œ';
      case 'US': return 'ë¯¸êµ­';
      case 'TH': return 'íƒœêµ­';
      case 'VN': return 'ë² íŠ¸ë‚¨';
      case 'SG': return 'ì‹±ê°€í¬ë¥´';
      case 'MY': return 'ë§ë ˆì´ì‹œì•„';
      case 'ID': return 'ì¸ë„ë„¤ì‹œì•„';
      default: return code;
    }
  }
  
  static String getFlag(String code) {
    switch (code) {
      case 'KR': return 'ğŸ‡°ğŸ‡·';
      case 'JP': return 'ğŸ‡¯ğŸ‡µ';
      case 'CN': return 'ğŸ‡¨ğŸ‡³';
      case 'TW': return 'ğŸ‡¹ğŸ‡¼';
      case 'US': return 'ğŸ‡ºğŸ‡¸';
      case 'TH': return 'ğŸ‡¹ğŸ‡­';
      case 'VN': return 'ğŸ‡»ğŸ‡³';
      case 'SG': return 'ğŸ‡¸ğŸ‡¬';
      case 'MY': return 'ğŸ‡²ğŸ‡¾';
      case 'ID': return 'ğŸ‡®ğŸ‡©';
      default: return 'ğŸŒ';
    }
  }
}
```

## 6. ë¼ìš°íŒ… ì„¤ì •

### [í•„ìˆ˜] ì¸ì¦ ê¸°ë°˜ ë¼ìš°íŒ…
```dart
// íŒŒì¼: lib/router/app_router.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../features/auth/presentation/providers/auth_state_provider.dart';
import '../features/auth/presentation/screens/login_screen.dart';
import '../features/auth/presentation/screens/signup_screen.dart';
import '../features/auth/presentation/screens/location_setup_screen.dart';
import '../features/auth/presentation/screens/country_confirm_screen.dart';
import '../features/auth/presentation/screens/country_select_screen.dart';
import '../features/home/home_screen.dart';
import '../features/splash/splash_screen.dart';

class AppRouter {
  static Route<dynamic> generateRoute(RouteSettings settings) {
    switch (settings.name) {
      case '/':
        return MaterialPageRoute(builder: (_) => const AuthWrapper());
      case '/login':
        return MaterialPageRoute(builder: (_) => const LoginScreen());
      case '/signup':
        return MaterialPageRoute(builder: (_) => const SignupScreen());
      case '/location-setup':
        return MaterialPageRoute(builder: (_) => const LocationSetupScreen());
      case '/country-confirm':
        final country = settings.arguments as String;
        return MaterialPageRoute(
          builder: (_) => CountryConfirmScreen(detectedCountry: country),
        );
      case '/country-select':
        return MaterialPageRoute(builder: (_) => const CountrySelectScreen());
      case '/home':
        return MaterialPageRoute(builder: (_) => const HomeScreen());
      default:
        return MaterialPageRoute(
          builder: (_) => const Scaffold(
            body: Center(child: Text('í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')),
          ),
        );
    }
  }
}

// ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ ë¼ìš°íŒ…
class AuthWrapper extends ConsumerWidget {
  const AuthWrapper({Key? key}) : super(key: key);
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authState = ref.watch(authStateProvider);
    
    return authState.when(
      data: (state) {
        if (state.session != null) {
          // ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ êµ­ê°€ ì„¤ì • í™•ì¸
          final userCountry = ref.watch(userCountryProvider);
          if (userCountry == null) {
            return const LocationSetupScreen();
          }
          return const HomeScreen();
        } else {
          return const LoginScreen();
        }
      },
      loading: () => const SplashScreen(),
      error: (_, __) => const LoginScreen(),
    );
  }
}
```

### [í•„ìˆ˜] main.dart ì„¤ì •
```dart
// íŒŒì¼: lib/main.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:supabase_flutter/supabase_flutter.dart';
import 'core/config/app_config.dart';
import 'core/theme/app_theme.dart';
import 'router/app_router.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // í™˜ê²½ ì„¤ì • ì¶œë ¥
  final config = AppConfig.instance;
  config.printConfig();
  
  // Supabase ì´ˆê¸°í™”
  await Supabase.initialize(
    url: config.supabaseUrl,
    anonKey: config.supabaseAnonKey,
    authOptions: const FlutterAuthClientOptions(
      authFlowType: AuthFlowType.pkce,
      autoRefreshToken: true,
    ),
  );
  
  runApp(
    const ProviderScope(
      child: FallingoApp(),
    ),
  );
}

class FallingoApp extends ConsumerWidget {
  const FallingoApp({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return MaterialApp(
      title: 'Fallingo',
      theme: AppTheme.lightTheme,
      debugShowCheckedModeBanner: false,
      onGenerateRoute: AppRouter.generateRoute,
      initialRoute: '/',
    );
  }
}

// ì „ì—­ Supabase í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼
final supabase = Supabase.instance.client;
```

## 7. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ UI ë™ì‘
- [ ] íšŒì›ê°€ì… í¼ ê²€ì¦
- [ ] ì†Œì…œ ë¡œê·¸ì¸ ë²„íŠ¼
- [ ] ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ í™”ë©´
- [ ] GPS ê¸°ë°˜ êµ­ê°€ ìë™ ê°ì§€
- [ ] êµ­ê°€ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
- [ ] êµ­ê°€ ì„ íƒ í™”ë©´ ë™ì‘
- [ ] ìë™ ë¡œê·¸ì¸ ìœ ì§€
- [ ] ë¡œê·¸ì•„ì›ƒ í›„ ë¼ìš°íŒ…

### ğŸ§ª ì¸ì¦ íë¦„ í…ŒìŠ¤íŠ¸
```dart
// íŒŒì¼: test/auth_flow_test.dart
void main() {
  testWidgets('ë¡œê·¸ì¸ í›„ ìœ„ì¹˜ ì„¤ì • í™”ë©´ ì´ë™', (tester) async {
    // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ìœ„ì¹˜ ì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ëŠ”ì§€ í™•ì¸
  });
  
  testWidgets('êµ­ê°€ ê°ì§€ ë° í™•ì¸', (tester) async {
    // GPSë¡œ êµ­ê°€ ê°ì§€ í›„ í™•ì¸ í™”ë©´ í‘œì‹œ í…ŒìŠ¤íŠ¸
  });
}
```

### ğŸ“Œ ì£¼ìš” ê°œì„  ì‚¬í•­
1. **Feature-based ì•„í‚¤í…ì²˜**: ë” ì²´ê³„ì ì¸ í´ë” êµ¬ì¡° ì ìš©
2. **ì„œë¹„ìŠ¤ ë ˆì´ì–´ ì¶”ê°€**: AuthService, SocialAuthService êµ¬í˜„
3. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**: AuthException ì„¸ë¶€ ì²˜ë¦¬
4. **UI ìµœì í™”**: ì´ë¯¸ì§€ ì—†ì´ë„ ë™ì‘í•˜ë„ë¡ ì•„ì´ì½˜ í™œìš©