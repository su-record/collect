# ğŸ”§ 0.7 Flask í”„ë¡œì íŠ¸ ì´ˆê¸°ì„¤ì •

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [Flask í”„ë¡œì íŠ¸ ì„¤ì •](#2-flask-í”„ë¡œì íŠ¸-ì„¤ì •)
3. [ê¸°ë³¸ ì½”ë“œ êµ¬ì„±](#3-ê¸°ë³¸-ì½”ë“œ-êµ¬ì„±)
4. [ê²€ì¦](#4-ê²€ì¦)

## 1. ê°œìš”

Fallingo ë°±ì—”ë“œ ì„œë²„ë¥¼ Flaskë¡œ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì´ˆê¸° í”„ë¡œì íŠ¸ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸

- âœ… Flask ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ©í† ë¦¬ íŒ¨í„´ ì ìš©
- âœ… í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬ (ë¡œì»¬/ìš´ì˜)
- âœ… CORS ë° ì—ëŸ¬ í•¸ë“¤ë§ ì„¤ì •

## 2. Flask í”„ë¡œì íŠ¸ ì„¤ì •

### [í•„ìˆ˜] requirements.txt

```txt
# íŒŒì¼: backend/requirements.txt
# Fallingo Backend Requirements - Python 3.13
# Flask í•µì‹¬
Flask==3.0.0
Flask-CORS==4.0.0
Flask-RESTful==0.3.10

# í™˜ê²½ ë³€ìˆ˜
python-dotenv==1.0.0

# Supabase í´ë¼ì´ì–¸íŠ¸
supabase==2.4.0

# ë°ì´í„° ê²€ì¦
marshmallow==3.20.1

# ì´ë¯¸ì§€ ì²˜ë¦¬
Pillow  # Python 3.13 í˜¸í™˜ì„±ì„ ìœ„í•´ ë²„ì „ ì§€ì • ì—†ì´ ìµœì‹  ë²„ì „ ì‚¬ìš©

# ìœ í‹¸ë¦¬í‹°
requests==2.31.0
python-dateutil==2.8.2

# ê°œë°œ ë„êµ¬
flask-debugtoolbar==0.14.1

# í…ŒìŠ¤íŠ¸
pytest==7.4.3
pytest-flask==1.3.0

# ìš´ì˜ í™˜ê²½ìš©
gunicorn==21.2.0
```

âš ï¸ **ì£¼ì˜**: Python 3.13 í•„ìˆ˜! ë‹¤ë¥¸ ë²„ì „ì€ í˜¸í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### [í•„ìˆ˜] .env.example

```bash
# íŒŒì¼: backend/.env.example
# Flask ì„¤ì •
FLASK_APP=run.py
FLASK_ENV=development
FLASK_DEBUG=True
SECRET_KEY=your-secret-key-here

# API ì„¤ì •
API_HOST=0.0.0.0
API_PORT=5000

# ì™¸ë¶€ API í‚¤ (ì‹¤ì œ ê°’ì€ .envì— ì„¤ì •)
GOOGLE_MAPS_API_KEY=
OPEN_METEO_API_KEY=
CLOUD_VISION_API_KEY=

# íŒŒì¼ ì—…ë¡œë“œ
UPLOAD_FOLDER=uploads
MAX_CONTENT_LENGTH=16777216  # 16MB
```

### [í•„ìˆ˜] .gitignore

```gitignore
# íŒŒì¼: backend/.gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/

# Flask
instance/
.webassets-cache

# í™˜ê²½ ì„¤ì •
.env
.env.local

# ì—…ë¡œë“œ íŒŒì¼
uploads/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# ë¡œê·¸
*.log
```

## 3. ê¸°ë³¸ ì½”ë“œ êµ¬ì„±

### [í•„ìˆ˜] config.py

```python
# íŒŒì¼: backend/config/config.py
import os
from datetime import timedelta

class Config:
    """ê¸°ë³¸ ì„¤ì •"""
    # Flask
    SECRET_KEY = os.environ.get('SECRET_KEY', 'dev-secret-key')

    # API
    API_TITLE = 'Fallingo API'
    API_VERSION = 'v1'

    # CORS
    CORS_ORIGINS = ['http://localhost:3000', 'http://localhost:8080']

    # íŒŒì¼ ì—…ë¡œë“œ
    UPLOAD_FOLDER = os.environ.get('UPLOAD_FOLDER', 'uploads')
    MAX_CONTENT_LENGTH = int(os.environ.get('MAX_CONTENT_LENGTH', 16777216))
    ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif', 'webp'}

    # ì™¸ë¶€ API
    GOOGLE_MAPS_API_KEY = os.environ.get('GOOGLE_MAPS_API_KEY', '')
    OPEN_METEO_API_KEY = os.environ.get('OPEN_METEO_API_KEY', '')
    CLOUD_VISION_API_KEY = os.environ.get('CLOUD_VISION_API_KEY', '')

class LocalConfig(Config):
    """ë¡œì»¬ ê°œë°œ í™˜ê²½"""
    DEBUG = True
    TESTING = False
    ENV = 'local'

    # Mock ë°ì´í„° ì‚¬ìš©
    USE_MOCK_DATA = True

class ProductionConfig(Config):
    """ìš´ì˜ í™˜ê²½"""
    DEBUG = False
    TESTING = False
    ENV = 'production'

    # ì‹¤ì œ ì„œë¹„ìŠ¤ ì‚¬ìš©
    USE_MOCK_DATA = False

# í™˜ê²½ë³„ ì„¤ì • ë§¤í•‘
config = {
    'local': LocalConfig,
    'production': ProductionConfig,
    'default': LocalConfig
}
```

### [í•„ìˆ˜] Flask ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ©í† ë¦¬

```python
# íŒŒì¼: backend/app.py
from flask import Flask
from flask_cors import CORS
import os

def create_app(config_name=None):
    """ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ©í† ë¦¬"""
    # Flask ì•± ìƒì„±
    app = Flask(__name__)

    # ì„¤ì • ë¡œë“œ
    if config_name is None:
        config_name = os.environ.get('FLASK_ENV', 'local')

    from config.config import config
    app.config.from_object(config[config_name])

    # CORS ì„¤ì •
    CORS(app, origins=app.config['CORS_ORIGINS'])

    # ì—…ë¡œë“œ í´ë” ìƒì„±
    upload_folder = app.config['UPLOAD_FOLDER']
    if not os.path.exists(upload_folder):
        os.makedirs(upload_folder)

    # ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡
    from api.v1 import register_blueprints
    register_blueprints(app)

    # ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡
    from api.common.error_handlers import register_error_handlers
    register_error_handlers(app)

    @app.route('/health')
    def health_check():
        """í—¬ìŠ¤ ì²´í¬"""
        return {
            'status': 'healthy',
            'environment': app.config['ENV'],
            'version': app.config['API_VERSION']
        }

    return app
```

### [í•„ìˆ˜] API ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡

```python
# íŒŒì¼: backend/api/v1/__init__.py
def register_blueprints(app):
    """ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡"""
    from api.v1.auth.routes import auth_bp
    from api.v1.users.routes import users_bp
    from api.v1.posts.routes import posts_bp

    # API v1 prefixë¡œ ë“±ë¡
    api_prefix = f"/api/{app.config['API_VERSION']}"

    app.register_blueprint(auth_bp, url_prefix=f"{api_prefix}/auth")
    app.register_blueprint(users_bp, url_prefix=f"{api_prefix}/users")
    app.register_blueprint(posts_bp, url_prefix=f"{api_prefix}/posts")
```

### [í•„ìˆ˜] ì„œë²„ ì‹¤í–‰ íŒŒì¼

```python
# íŒŒì¼: backend/run.py
import os
import sys
from dotenv import load_dotenv

# backend ë””ë ‰í† ë¦¬ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from app import create_app

# .env íŒŒì¼ ë¡œë“œ
load_dotenv()

# ì•± ìƒì„±
app = create_app()

if __name__ == '__main__':
    host = os.environ.get('API_HOST', '0.0.0.0')
    port = int(os.environ.get('API_PORT', 5000))

    print(f"ğŸš€ Fallingo API ì„œë²„ ì‹œì‘")
    print(f"ğŸ“ ì£¼ì†Œ: http://{host}:{port}")
    print(f"ğŸŒ í™˜ê²½: {app.config['ENV']}")
    print(f"ğŸ”§ ë””ë²„ê·¸: {app.config['DEBUG']}")

    app.run(host=host, port=port)
```

### [í•„ìˆ˜] ê³µí†µ ì—ëŸ¬ í•¸ë“¤ëŸ¬

```python
# íŒŒì¼: backend/api/common/error_handlers.py
from flask import jsonify
from werkzeug.exceptions import HTTPException

def register_error_handlers(app):
    """ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡"""

    @app.errorhandler(HTTPException)
    def handle_http_exception(e):
        """HTTP ì˜ˆì™¸ ì²˜ë¦¬"""
        return jsonify({
            'error': {
                'code': e.code,
                'message': e.description,
                'type': e.name
            }
        }), e.code

    @app.errorhandler(Exception)
    def handle_exception(e):
        """ì¼ë°˜ ì˜ˆì™¸ ì²˜ë¦¬"""
        app.logger.error(f"Unhandled exception: {str(e)}")
        return jsonify({
            'error': {
                'code': 500,
                'message': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                'type': 'Internal Server Error'
            }
        }), 500

    @app.errorhandler(404)
    def handle_not_found(e):
        """404 ì²˜ë¦¬"""
        return jsonify({
            'error': {
                'code': 404,
                'message': 'ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                'type': 'Not Found'
            }
        }), 404
```

### [í•„ìˆ˜] ë„ë©”ì¸ë³„ ë¼ìš°íŠ¸ ì˜ˆì‹œ

```python
# íŒŒì¼: backend/api/v1/auth/routes.py
from flask import Blueprint, request, jsonify

auth_bp = Blueprint('auth', __name__)

@auth_bp.route('/login', methods=['POST'])
def login():
    """Supabase Authë¡œ í•˜ëŠ” ë¡œê·¸ì¸"""
    return jsonify({
        'message': 'Login endpoint - Connect to Supabase Auth',
        'method': request.method
    }), 200

@auth_bp.route('/signup', methods=['POST'])
def signup():
    """Supabase Authë¡œ í•˜ëŠ” íšŒì›ê°€ì…"""
    return jsonify({
        'message': 'Signup endpoint - Connect to Supabase Auth',
        'method': request.method
    }), 200
```

```python
# íŒŒì¼: backend/api/v1/users/routes.py
from flask import Blueprint, jsonify

users_bp = Blueprint('users', __name__)

@users_bp.route('/<user_id>', methods=['GET'])
def get_user(user_id):
    """ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ"""
    return jsonify({
        'message': f'Get user {user_id}',
        'user_id': user_id
    }), 200
```

```python
# íŒŒì¼: backend/api/v1/posts/routes.py
from flask import Blueprint, jsonify

posts_bp = Blueprint('posts', __name__)

@posts_bp.route('/', methods=['GET'])
def get_posts():
    """í”¼ë“œ ëª©ë¡ ì¡°íšŒ"""
    return jsonify({
        'message': 'Get posts list',
        'posts': []
    }), 200

@posts_bp.route('/', methods=['POST'])
def create_post():
    """ìƒˆ í”¼ë“œ ë“±ë¡"""
    return jsonify({
        'message': 'Create new post',
        'post_id': 'mock-id'
    }), 201
```

### [í•„ìˆ˜] **init**.py íŒŒì¼

íŒŒì´ì¬ íŒ¨í‚¤ì§€ë¡œ ì¸ì‹í•˜ê¸° ìœ„í•´ ê° ë””ë ‰í† ë¦¬ì— ë¹ˆ **init**.py íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤:

- backend/api/**init**.py
- backend/api/v1/**init**.py (ìœ„ì— ë‚´ìš© ì •ì˜)
- backend/api/v1/auth/**init**.py
- backend/api/v1/users/**init**.py
- backend/api/v1/posts/**init**.py
- backend/api/common/**init**.py
- backend/config/**init**.py
- backend/utils/**init**.py
- backend/models/**init**.py
- backend/services/**init**.py

## 4. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ê°€ìƒí™˜ê²½ì´ ìƒì„±ë˜ê³  í™œì„±í™”ë˜ì—ˆëŠ”ê°€?
- [ ] requirements.txtì˜ ëª¨ë“  íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì—ˆëŠ”ê°€?
- [ ] .env íŒŒì¼ì´ ìƒì„±ë˜ê³  ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] Flask ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ê°€?
- [ ] /health ì—”ë“œí¬ì¸íŠ¸ê°€ ì‘ë‹µí•˜ëŠ”ê°€?

### ì„œë²„ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸ (bash í„°ë¯¸ë„)

```bash
# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv

# í™œì„±í™”
source venv/Scripts/activate  # Windows Git Bash
source venv/bin/activate      # Mac/Linux

# pip ì—…ê·¸ë ˆì´ë“œ (í•„ìˆ˜!)
python -m pip install --upgrade pip setuptools wheel

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt

# .env íŒŒì¼ ìƒì„±
cp .env.example .env

# ì„œë²„ ì‹¤í–‰
python run.py

# í—¬ìŠ¤ ì²´í¬ í…ŒìŠ¤íŠ¸
curl http://localhost:5000/health

# API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
curl http://localhost:5000/api/v1/auth/login -X POST -H "Content-Type: application/json"
curl http://localhost:5000/api/v1/users/123
curl http://localhost:5000/api/v1/posts
```

### ì˜ˆìƒ ì‘ë‹µ

```json
// /health
{
  "status": "healthy",
  "environment": "local",
  "version": "v1"
}

// /api/v1/auth/login
{
  "message": "Login endpoint - Connect to Supabase Auth",
  "method": "POST"
}

// /api/v1/users/123
{
  "message": "Get user 123",
  "user_id": "123"
}

// /api/v1/posts
{
  "message": "Get posts list",
  "posts": []
```
