# 🎯 13.1 신규 사용자 온보딩

## 📋 목차
1. [개요](#1-개요)
2. [첫 실행 시나리오](#2-첫-실행-시나리오)
3. [권한 요청 순서](#3-권한-요청-순서)
4. [로그인 플로우](#4-로그인-플로우)
5. [첫 피드 확인](#5-첫-피드-확인)
6. [국가 선택 플로우](#6-국가-선택-플로우)
7. [첫 피드 등록 경험](#7-첫-피드-등록-경험)
8. [검증](#8-검증)

## 1. 개요
신규 사용자가 Fallingo를 처음 실행할 때의 전체 온보딩 프로세스를 단계별로 구현합니다.

### 📌 핵심 포인트
- ✅ 부드러운 첫 경험 제공
- ✅ 최소한의 권한으로 시작
- ✅ 점진적 권한 요청
- ✅ 즉시 가치 전달
- ✅ 글로벌 사용자 고려

## 2. 첫 실행 시나리오

### [필수] 온보딩 플로우 관리자
```dart
// 파일: lib/features/onboarding/managers/onboarding_manager.dart
import 'package:flutter/material.dart';
import 'package:shared_preferences/shared_preferences.dart';

class OnboardingManager {
  static const String _keyFirstRun = 'first_run';
  static const String _keyOnboardingComplete = 'onboarding_complete';
  static const String _keyLocationPermissionAsked = 'location_permission_asked';
  static const String _keyCountrySelected = 'country_selected';
  static const String _keyFirstFeedCreated = 'first_feed_created';
  
  final SharedPreferences _prefs;
  
  OnboardingManager(this._prefs);
  
  /// 첫 실행 여부 확인
  bool get isFirstRun => _prefs.getBool(_keyFirstRun) ?? true;
  
  /// 온보딩 완료 여부
  bool get isOnboardingComplete => _prefs.getBool(_keyOnboardingComplete) ?? false;
  
  /// 위치 권한 요청 여부
  bool get hasAskedLocationPermission => _prefs.getBool(_keyLocationPermissionAsked) ?? false;
  
  /// 국가 선택 여부
  String? get selectedCountry => _prefs.getString(_keyCountrySelected);
  
  /// 첫 피드 생성 여부
  bool get hasCreatedFirstFeed => _prefs.getBool(_keyFirstFeedCreated) ?? false;
  
  /// 온보딩 시작
  Future<void> startOnboarding() async {
    await _prefs.setBool(_keyFirstRun, false);
  }
  
  /// 온보딩 완료
  Future<void> completeOnboarding() async {
    await _prefs.setBool(_keyOnboardingComplete, true);
  }
  
  /// 위치 권한 요청 완료
  Future<void> markLocationPermissionAsked() async {
    await _prefs.setBool(_keyLocationPermissionAsked, true);
  }
  
  /// 국가 선택 완료
  Future<void> setSelectedCountry(String countryCode) async {
    await _prefs.setString(_keyCountrySelected, countryCode);
  }
  
  /// 첫 피드 생성 완료
  Future<void> markFirstFeedCreated() async {
    await _prefs.setBool(_keyFirstFeedCreated, true);
  }
  
  /// 온보딩 단계 결정
  OnboardingStep getNextStep() {
    if (isFirstRun) {
      return OnboardingStep.welcome;
    } else if (selectedCountry == null) {
      return OnboardingStep.countrySelection;
    } else if (!hasAskedLocationPermission) {
      return OnboardingStep.locationPermission;
    } else if (!isOnboardingComplete) {
      return OnboardingStep.tutorial;
    }
    return OnboardingStep.completed;
  }
}

enum OnboardingStep {
  welcome,
  countrySelection,
  locationPermission,
  tutorial,
  completed,
}
```

### [필수] 스플래시 화면 with 온보딩 체크
```dart
// 파일: lib/features/splash/screens/splash_screen.dart
import 'package:flutter/material.dart';
import '../../../core/config/app_config.dart';

class SplashScreen extends StatefulWidget {
  @override
  _SplashScreenState createState() => _SplashScreenState();
}

class _SplashScreenState extends State<SplashScreen> 
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _fadeAnimation;
  late Animation<double> _scaleAnimation;
  
  String? _weatherStatus;
  String? _locationName;
  
  @override
  void initState() {
    super.initState();
    _setupAnimations();
    _initializeApp();
  }
  
  void _setupAnimations() {
    _animationController = AnimationController(
      duration: const Duration(seconds: 2),
      vsync: this,
    );
    
    _fadeAnimation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: const Interval(0.0, 0.5),
    ));
    
    _scaleAnimation = Tween<double>(
      begin: 0.8,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: Curves.elasticOut,
    ));
    
    _animationController.forward();
  }
  
  Future<void> _initializeApp() async {
    try {
      // 1. 기본 초기화
      await Future.wait([
        _loadWeatherData(),
        _checkAppState(),
        Future.delayed(const Duration(seconds: 2)), // 최소 표시 시간
      ]);
      
      // 2. 다음 화면 결정
      _navigateToNextScreen();
      
    } catch (e) {
      print('Initialization error: $e');
      _navigateToErrorScreen();
    }
  }
  
  Future<void> _loadWeatherData() async {
    // Mock 날씨 데이터 (실제로는 API 호출)
    await Future.delayed(const Duration(milliseconds: 500));
    setState(() {
      _weatherStatus = '맑음';
      _locationName = '강남구';
    });
  }
  
  Future<void> _checkAppState() async {
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    
    // Supabase 초기화
    await Supabase.initialize(
      url: AppConfig.current.supabaseUrl,
      anonKey: AppConfig.current.supabaseAnonKey,
    );
    
    // 인증 상태 확인
    final supabase = Supabase.instance.client;
    final currentUser = supabase.auth.currentUser;
    
    // 온보딩 상태 저장
    if (currentUser == null && onboardingManager.isFirstRun) {
      // 첫 실행 + 로그인 안됨
      _nextRoute = '/onboarding/welcome';
    } else if (currentUser == null) {
      // 로그인 안됨
      _nextRoute = '/login';
    } else if (onboardingManager.selectedCountry == null) {
      // 국가 미선택
      _nextRoute = '/onboarding/country';
    } else if (!onboardingManager.isOnboardingComplete) {
      // 로그인 됨 + 온보딩 미완료
      _nextRoute = '/onboarding/permissions';
    } else {
      // 정상 진입
      _nextRoute = '/main';
    }
  }
  
  String _nextRoute = '/main';
  
  void _navigateToNextScreen() {
    Navigator.pushReplacementNamed(context, _nextRoute);
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topCenter,
            end: Alignment.bottomCenter,
            colors: [
              Theme.of(context).primaryColor,
              Theme.of(context).primaryColor.withOpacity(0.8),
            ],
          ),
        ),
        child: Stack(
          children: [
            // 날씨 효과 배경
            if (_weatherStatus == '맑음')
              _buildSunnyBackground(),
            
            // 메인 콘텐츠
            Center(
              child: AnimatedBuilder(
                animation: _animationController,
                builder: (context, child) {
                  return FadeTransition(
                    opacity: _fadeAnimation,
                    child: ScaleTransition(
                      scale: _scaleAnimation,
                      child: Column(
                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [
                          // 로고
                          Container(
                            width: 120,
                            height: 120,
                            decoration: BoxDecoration(
                              color: Colors.white,
                              shape: BoxShape.circle,
                              boxShadow: [
                                BoxShadow(
                                  color: Colors.black.withOpacity(0.2),
                                  blurRadius: 20,
                                  offset: const Offset(0, 10),
                                ),
                              ],
                            ),
                            child: Center(
                              child: Text(
                                '🍽️',
                                style: TextStyle(fontSize: 60),
                              ),
                            ),
                          ),
                          const SizedBox(height: 24),
                          
                          // 앱 이름
                          Text(
                            'Fallingo',
                            style: TextStyle(
                              fontSize: 36,
                              fontWeight: FontWeight.bold,
                              color: Colors.white,
                              letterSpacing: 1.2,
                            ),
                          ),
                          const SizedBox(height: 8),
                          
                          // 슬로건
                          Text(
                            '맛에 빠져들어, 함께 떠나는 미식 여정',
                            style: TextStyle(
                              fontSize: 14,
                              color: Colors.white.withOpacity(0.9),
                            ),
                          ),
                          
                          // 위치 정보
                          if (_locationName != null) ...[
                            const SizedBox(height: 40),
                            Row(
                              mainAxisAlignment: MainAxisAlignment.center,
                              children: [
                                Icon(
                                  Icons.location_on,
                                  color: Colors.white.withOpacity(0.8),
                                  size: 16,
                                ),
                                const SizedBox(width: 4),
                                Text(
                                  _locationName!,
                                  style: TextStyle(
                                    color: Colors.white.withOpacity(0.8),
                                    fontSize: 14,
                                  ),
                                ),
                              ],
                            ),
                          ],
                        ],
                      ),
                    ),
                  );
                },
              ),
            ),
            
            // 로딩 인디케이터
            Positioned(
              bottom: 80,
              left: 0,
              right: 0,
              child: Center(
                child: CircularProgressIndicator(
                  valueColor: AlwaysStoppedAnimation<Color>(
                    Colors.white.withOpacity(0.8),
                  ),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildSunnyBackground() {
    return Positioned(
      top: -100,
      right: -100,
      child: Container(
        width: 300,
        height: 300,
        decoration: BoxDecoration(
          shape: BoxShape.circle,
          gradient: RadialGradient(
            colors: [
              Colors.yellow.withOpacity(0.3),
              Colors.transparent,
            ],
          ),
        ),
      ),
    );
  }
}
```

## 3. 권한 요청 순서

### [필수] 웰컴 화면
```dart
// 파일: lib/features/onboarding/screens/welcome_screen.dart
class WelcomeScreen extends StatefulWidget {
  @override
  _WelcomeScreenState createState() => _WelcomeScreenState();
}

class _WelcomeScreenState extends State<WelcomeScreen> {
  final PageController _pageController = PageController();
  int _currentPage = 0;
  
  final List<OnboardingPage> _pages = [
    OnboardingPage(
      title: '진짜 맛집,\n현장에서 만나요',
      description: '실제 방문자만 작성할 수 있는\n믿을 수 있는 맛집 정보',
      image: 'assets/images/onboarding_1.png',
      icon: '📍',
    ),
    OnboardingPage(
      title: '메뉴 중심의\n스마트한 추천',
      description: '맛집이 아닌 맛있는 메뉴를\nAI가 실시간으로 추천해드려요',
      image: 'assets/images/onboarding_2.png',
      icon: '🍽️',
    ),
    OnboardingPage(
      title: '함께 성장하는\n미식 여정',
      description: '누룽지부터 수랏상까지\n당신만의 미식 레벨을 올려보세요',
      image: 'assets/images/onboarding_3.png',
      icon: '🏆',
    ),
  ];
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: Column(
          children: [
            // Skip 버튼
            Align(
              alignment: Alignment.topRight,
              child: TextButton(
                onPressed: _skip,
                child: Text(
                  '건너뛰기',
                  style: TextStyle(
                    color: Colors.grey[600],
                    fontSize: 16,
                  ),
                ),
              ),
            ),
            
            // 페이지 뷰
            Expanded(
              child: PageView.builder(
                controller: _pageController,
                onPageChanged: (index) {
                  setState(() {
                    _currentPage = index;
                  });
                },
                itemCount: _pages.length,
                itemBuilder: (context, index) {
                  return _buildPage(_pages[index]);
                },
              ),
            ),
            
            // 인디케이터
            Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: List.generate(
                _pages.length,
                (index) => _buildIndicator(index),
              ),
            ),
            const SizedBox(height: 32),
            
            // 시작 버튼
            Padding(
              padding: const EdgeInsets.symmetric(horizontal: 24),
              child: ElevatedButton(
                onPressed: _currentPage == _pages.length - 1 
                    ? _complete 
                    : _nextPage,
                style: ElevatedButton.styleFrom(
                  minimumSize: const Size(double.infinity, 56),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(28),
                  ),
                ),
                child: Text(
                  _currentPage == _pages.length - 1 
                      ? '시작하기' 
                      : '다음',
                  style: const TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.bold,
                  ),
                ),
              ),
            ),
            const SizedBox(height: 32),
          ],
        ),
      ),
    );
  }
  
  Widget _buildPage(OnboardingPage page) {
    return Padding(
      padding: const EdgeInsets.all(24),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          // 아이콘
          Text(
            page.icon,
            style: const TextStyle(fontSize: 80),
          ),
          const SizedBox(height: 48),
          
          // 제목
          Text(
            page.title,
            textAlign: TextAlign.center,
            style: const TextStyle(
              fontSize: 28,
              fontWeight: FontWeight.bold,
              height: 1.3,
            ),
          ),
          const SizedBox(height: 16),
          
          // 설명
          Text(
            page.description,
            textAlign: TextAlign.center,
            style: TextStyle(
              fontSize: 16,
              color: Colors.grey[600],
              height: 1.5,
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildIndicator(int index) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 4),
      width: _currentPage == index ? 24 : 8,
      height: 8,
      decoration: BoxDecoration(
        color: _currentPage == index 
            ? Theme.of(context).primaryColor 
            : Colors.grey[300],
        borderRadius: BorderRadius.circular(4),
      ),
    );
  }
  
  void _nextPage() {
    _pageController.nextPage(
      duration: const Duration(milliseconds: 300),
      curve: Curves.easeInOut,
    );
  }
  
  void _skip() {
    _complete();
  }
  
  void _complete() async {
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    await onboardingManager.startOnboarding();
    
    Navigator.pushReplacementNamed(context, '/login');
  }
}

class OnboardingPage {
  final String title;
  final String description;
  final String image;
  final String icon;
  
  OnboardingPage({
    required this.title,
    required this.description,
    required this.image,
    required this.icon,
  });
}
```

### [필수] 점진적 권한 요청
```dart
// 파일: lib/features/onboarding/screens/permission_onboarding_screen.dart
class PermissionOnboardingScreen extends StatefulWidget {
  @override
  _PermissionOnboardingScreenState createState() => 
      _PermissionOnboardingScreenState();
}

class _PermissionOnboardingScreenState extends State<PermissionOnboardingScreen> {
  bool _isRequestingPermission = false;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: const EdgeInsets.all(24),
          child: Column(
            children: [
              const Spacer(),
              
              // 아이콘 애니메이션
              TweenAnimationBuilder<double>(
                tween: Tween(begin: 0.0, end: 1.0),
                duration: const Duration(seconds: 1),
                builder: (context, value, child) {
                  return Transform.scale(
                    scale: value,
                    child: Container(
                      width: 120,
                      height: 120,
                      decoration: BoxDecoration(
                        color: Theme.of(context).primaryColor.withOpacity(0.1),
                        shape: BoxShape.circle,
                      ),
                      child: Icon(
                        Icons.location_on,
                        size: 60,
                        color: Theme.of(context).primaryColor,
                      ),
                    ),
                  );
                },
              ),
              const SizedBox(height: 48),
              
              // 제목
              Text(
                '주변 맛집을 찾아드릴게요',
                style: Theme.of(context).textTheme.headlineSmall?.copyWith(
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 16),
              
              // 설명
              Text(
                'Fallingo가 현재 위치를 기반으로\n가장 가까운 맛집을 추천해드립니다',
                textAlign: TextAlign.center,
                style: TextStyle(
                  fontSize: 16,
                  color: Colors.grey[600],
                  height: 1.5,
                ),
              ),
              const SizedBox(height: 48),
              
              // 혜택 리스트
              _buildBenefitItem(
                icon: Icons.near_me,
                title: '실시간 주변 맛집',
                description: '현재 위치에서 가까운 순으로 추천',
              ),
              _buildBenefitItem(
                icon: Icons.verified,
                title: '현장 인증 필수',
                description: '실제 방문만 가능한 신뢰도 높은 리뷰',
              ),
              _buildBenefitItem(
                icon: Icons.security,
                title: '안전한 위치 정보',
                description: '서비스 제공 목적으로만 사용',
              ),
              
              const Spacer(),
              
              // 버튼
              ElevatedButton(
                onPressed: _isRequestingPermission ? null : _requestPermission,
                style: ElevatedButton.styleFrom(
                  minimumSize: const Size(double.infinity, 56),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(12),
                  ),
                ),
                child: _isRequestingPermission
                    ? const SizedBox(
                        width: 24,
                        height: 24,
                        child: CircularProgressIndicator(
                          color: Colors.white,
                          strokeWidth: 2,
                        ),
                      )
                    : const Text(
                        '위치 권한 허용하고 시작하기',
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
              ),
              const SizedBox(height: 12),
              
              // 나중에 설정
              TextButton(
                onPressed: _skipPermission,
                child: Text(
                  '나중에 설정할게요',
                  style: TextStyle(
                    color: Colors.grey[600],
                    fontSize: 14,
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
  
  Widget _buildBenefitItem({
    required IconData icon,
    required String title,
    required String description,
  }) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 12),
      child: Row(
        children: [
          Container(
            width: 48,
            height: 48,
            decoration: BoxDecoration(
              color: Theme.of(context).primaryColor.withOpacity(0.1),
              borderRadius: BorderRadius.circular(12),
            ),
            child: Icon(
              icon,
              color: Theme.of(context).primaryColor,
              size: 24,
            ),
          ),
          const SizedBox(width: 16),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  title,
                  style: const TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.bold,
                  ),
                ),
                const SizedBox(height: 2),
                Text(
                  description,
                  style: TextStyle(
                    fontSize: 14,
                    color: Colors.grey[600],
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
  
  Future<void> _requestPermission() async {
    setState(() {
      _isRequestingPermission = true;
    });
    
    try {
      final permissionManager = LocationPermissionManager();
      final status = await permissionManager.requestPermission();
      
      // 권한 요청 완료 기록
      final prefs = await SharedPreferences.getInstance();
      final onboardingManager = OnboardingManager(prefs);
      await onboardingManager.markLocationPermissionAsked();
      
      if (status == LocationPermissionStatus.granted) {
        _navigateToMain();
      } else {
        _showPermissionDeniedDialog();
      }
    } finally {
      setState(() {
        _isRequestingPermission = false;
      });
    }
  }
  
  void _skipPermission() async {
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    await onboardingManager.markLocationPermissionAsked();
    await onboardingManager.completeOnboarding();
    
    _navigateToMain();
  }
  
  void _navigateToMain() {
    Navigator.pushNamedAndRemoveUntil(
      context,
      '/main',
      (route) => false,
    );
  }
  
  void _showPermissionDeniedDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('위치 권한이 필요해요'),
        content: const Text(
          '위치 권한 없이도 Fallingo를 사용할 수 있지만,\n'
          '주변 맛집 추천과 현장 인증 기능이 제한됩니다.',
        ),
        actions: [
          TextButton(
            onPressed: () {
              Navigator.pop(context);
              _skipPermission();
            },
            child: const Text('그래도 시작하기'),
          ),
          TextButton(
            onPressed: () {
              Navigator.pop(context);
              _requestPermission();
            },
            child: const Text('다시 시도'),
          ),
        ],
      ),
    );
  }
}
```

## 4. 로그인 플로우

### [필수] 소셜 로그인 화면
```dart
// 파일: lib/features/auth/screens/login_screen.dart
class LoginScreen extends StatefulWidget {
  @override
  _LoginScreenState createState() => _LoginScreenState();
}

class _LoginScreenState extends State<LoginScreen> 
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _fadeAnimation;
  late Animation<Offset> _slideAnimation;
  
  bool _isLoading = false;
  String? _errorMessage;
  
  @override
  void initState() {
    super.initState();
    _setupAnimations();
  }
  
  void _setupAnimations() {
    _animationController = AnimationController(
      duration: const Duration(milliseconds: 800),
      vsync: this,
    );
    
    _fadeAnimation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: const Interval(0.0, 0.6),
    ));
    
    _slideAnimation = Tween<Offset>(
      begin: const Offset(0, 0.3),
      end: Offset.zero,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: Curves.easeOutCubic,
    ));
    
    _animationController.forward();
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
            colors: [
              Theme.of(context).primaryColor.withOpacity(0.1),
              Colors.white,
            ],
          ),
        ),
        child: SafeArea(
          child: Padding(
            padding: const EdgeInsets.all(24),
            child: Column(
              children: [
                const Spacer(flex: 1),
                
                // 로고와 타이틀
                FadeTransition(
                  opacity: _fadeAnimation,
                  child: Column(
                    children: [
                      Container(
                        width: 100,
                        height: 100,
                        decoration: BoxDecoration(
                          color: Theme.of(context).primaryColor,
                          shape: BoxShape.circle,
                        ),
                        child: const Center(
                          child: Text(
                            '🍽️',
                            style: TextStyle(fontSize: 50),
                          ),
                        ),
                      ),
                      const SizedBox(height: 24),
                      Text(
                        'Fallingo',
                        style: Theme.of(context).textTheme.headlineLarge?.copyWith(
                          fontWeight: FontWeight.bold,
                          color: Theme.of(context).primaryColor,
                        ),
                      ),
                      const SizedBox(height: 8),
                      Text(
                        '맛에 빠져들어, 함께 떠나는 미식 여정',
                        style: TextStyle(
                          fontSize: 14,
                          color: Colors.grey[600],
                        ),
                      ),
                    ],
                  ),
                ),
                
                const Spacer(flex: 2),
                
                // 에러 메시지
                if (_errorMessage != null)
                  Container(
                    padding: const EdgeInsets.all(12),
                    margin: const EdgeInsets.only(bottom: 16),
                    decoration: BoxDecoration(
                      color: Colors.red[50],
                      borderRadius: BorderRadius.circular(8),
                      border: Border.all(color: Colors.red[200]!),
                    ),
                    child: Row(
                      children: [
                        Icon(Icons.error_outline, color: Colors.red[700], size: 20),
                        const SizedBox(width: 8),
                        Expanded(
                          child: Text(
                            _errorMessage!,
                            style: TextStyle(color: Colors.red[700], fontSize: 14),
                          ),
                        ),
                      ],
                    ),
                  ),
                
                // 로그인 버튼들
                SlideTransition(
                  position: _slideAnimation,
                  child: Column(
                    children: [
                      // Google 로그인
                      _buildSocialLoginButton(
                        onPressed: _isLoading ? null : () => _handleGoogleLogin(),
                        icon: 'assets/icons/google.png',
                        label: 'Google로 시작하기',
                        backgroundColor: Colors.white,
                        textColor: Colors.black87,
                        borderColor: Colors.grey[300]!,
                      ),
                      const SizedBox(height: 12),
                      
                      // Apple 로그인 (iOS만)
                      if (Theme.of(context).platform == TargetPlatform.iOS) ...[
                        _buildSocialLoginButton(
                          onPressed: _isLoading ? null : () => _handleAppleLogin(),
                          icon: 'assets/icons/apple.png',
                          label: 'Apple로 시작하기',
                          backgroundColor: Colors.black,
                          textColor: Colors.white,
                        ),
                        const SizedBox(height: 12),
                      ],
                      
                      // 이메일 로그인
                      TextButton(
                        onPressed: _isLoading ? null : () => _handleEmailLogin(),
                        child: Text(
                          '이메일로 로그인',
                          style: TextStyle(
                            color: Colors.grey[600],
                            fontSize: 14,
                          ),
                        ),
                      ),
                    ],
                  ),
                ),
                
                const Spacer(flex: 1),
                
                // 약관 동의
                Text(
                  '로그인하면 Fallingo의 서비스 이용약관과\n개인정보처리방침에 동의하는 것으로 간주됩니다.',
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey[500],
                    height: 1.5,
                  ),
                ),
                const SizedBox(height: 16),
              ],
            ),
          ),
        ),
      ),
    );
  }
  
  Widget _buildSocialLoginButton({
    required VoidCallback? onPressed,
    required String icon,
    required String label,
    required Color backgroundColor,
    required Color textColor,
    Color? borderColor,
  }) {
    return ElevatedButton(
      onPressed: onPressed,
      style: ElevatedButton.styleFrom(
        backgroundColor: backgroundColor,
        foregroundColor: textColor,
        minimumSize: const Size(double.infinity, 56),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12),
          side: borderColor != null
              ? BorderSide(color: borderColor)
              : BorderSide.none,
        ),
        elevation: 0,
      ),
      child: _isLoading
          ? SizedBox(
              width: 24,
              height: 24,
              child: CircularProgressIndicator(
                color: textColor,
                strokeWidth: 2,
              ),
            )
          : Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                Image.asset(
                  icon,
                  width: 24,
                  height: 24,
                ),
                const SizedBox(width: 12),
                Text(
                  label,
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w600,
                  ),
                ),
              ],
            ),
    );
  }
  
  Future<void> _handleGoogleLogin() async {
    setState(() {
      _isLoading = true;
      _errorMessage = null;
    });
    
    try {
      final authService = AuthService();
      final authResponse = await authService.signInWithGoogle();
      
      if (authResponse.user != null) {
        // 첫 로그인인지 확인
        final user = authResponse.user!;
        final isNewUser = user.createdAt == user.lastSignInAt;
        
        if (isNewUser) {
          // 신규 사용자 - 국가 선택으로
          Navigator.pushReplacementNamed(context, '/onboarding/country');
        } else {
          // 기존 사용자 - 국가 확인
          final prefs = await SharedPreferences.getInstance();
          final onboardingManager = OnboardingManager(prefs);
          
          if (onboardingManager.selectedCountry == null) {
            Navigator.pushReplacementNamed(context, '/onboarding/country');
          } else {
            Navigator.pushReplacementNamed(context, '/main');
          }
        }
      }
    } catch (e) {
      setState(() {
        _errorMessage = '로그인에 실패했습니다. 다시 시도해주세요.';
      });
    } finally {
      setState(() {
        _isLoading = false;
      });
    }
  }
  
  Future<void> _handleAppleLogin() async {
    // Apple 로그인 구현
  }
  
  void _handleEmailLogin() {
    Navigator.pushNamed(context, '/login/email');
  }
}
```

## 5. 첫 피드 확인

### [필수] 메인 화면 첫 진입
```dart
// 파일: lib/features/main/screens/main_screen.dart
class MainScreen extends StatefulWidget {
  @override
  _MainScreenState createState() => _MainScreenState();
}

class _MainScreenState extends State<MainScreen> {
  int _currentIndex = 0;
  bool _showWelcomeTooltip = false;
  bool _showFirstFeedGuide = false;
  
  @override
  void initState() {
    super.initState();
    _checkFirstVisit();
  }
  
  Future<void> _checkFirstVisit() async {
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    
    final hasSeenTooltip = prefs.getBool('has_seen_welcome_tooltip') ?? false;
    
    if (!hasSeenTooltip) {
      setState(() {
        _showWelcomeTooltip = true;
      });
      
      // 5초 후 자동으로 사라짐
      Future.delayed(const Duration(seconds: 5), () {
        if (mounted) {
          setState(() {
            _showWelcomeTooltip = false;
          });
          prefs.setBool('has_seen_welcome_tooltip', true);
        }
      });
    }
    
    // 첫 피드 생성 가이드
    if (!onboardingManager.hasCreatedFirstFeed) {
      Future.delayed(const Duration(seconds: 10), () {
        if (mounted && !onboardingManager.hasCreatedFirstFeed) {
          setState(() {
            _showFirstFeedGuide = true;
          });
        }
      });
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Stack(
        children: [
          // 메인 콘텐츠
          IndexedStack(
            index: _currentIndex,
            children: [
              FeedScreen(showTutorial: _showWelcomeTooltip),
              ExploreScreen(),
              const SizedBox(), // 카메라는 모달로 열림
              NotificationScreen(),
              ProfileScreen(),
            ],
          ),
          
          // 웰컴 투툴팁
          if (_showWelcomeTooltip)
            Positioned(
              bottom: 100,
              left: 0,
              right: 0,
              child: Center(
                child: Container(
                  margin: const EdgeInsets.symmetric(horizontal: 24),
                  padding: const EdgeInsets.all(16),
                  decoration: BoxDecoration(
                    color: Theme.of(context).primaryColor,
                    borderRadius: BorderRadius.circular(12),
                    boxShadow: [
                      BoxShadow(
                        color: Colors.black.withOpacity(0.2),
                        blurRadius: 10,
                        offset: const Offset(0, 5),
                      ),
                    ],
                  ),
                  child: Row(
                    children: [
                      const Icon(
                        Icons.waving_hand,
                        color: Colors.white,
                        size: 24,
                      ),
                      const SizedBox(width: 12),
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          mainAxisSize: MainAxisSize.min,
                          children: [
                            const Text(
                              '환영합니다! 🎉',
                              style: TextStyle(
                                color: Colors.white,
                                fontSize: 16,
                                fontWeight: FontWeight.bold,
                              ),
                            ),
                            const SizedBox(height: 4),
                            const Text(
                              '주변의 맛있는 메뉴들을 둘러보고\n마음에 드는 메뉴를 추천해보세요!',
                              style: TextStyle(
                                color: Colors.white,
                                fontSize: 14,
                              ),
                            ),
                          ],
                        ),
                      ),
                      IconButton(
                        onPressed: () {
                          setState(() {
                            _showWelcomeTooltip = false;
                          });
                        },
                        icon: const Icon(
                          Icons.close,
                          color: Colors.white,
                          size: 20,
                        ),
                      ),
                    ],
                  ),
                ),
              ),
            ),
          
          // 첫 피드 가이드
          if (_showFirstFeedGuide)
            Positioned(
              bottom: 80,
              left: 0,
              right: 0,
              child: Center(
                child: AnimatedScale(
                  scale: _showFirstFeedGuide ? 1.0 : 0.0,
                  duration: const Duration(milliseconds: 300),
                  child: Container(
                    width: 64,
                    height: 64,
                    decoration: BoxDecoration(
                      color: Theme.of(context).primaryColor,
                      shape: BoxShape.circle,
                      boxShadow: [
                        BoxShadow(
                          color: Theme.of(context).primaryColor.withOpacity(0.3),
                          blurRadius: 20,
                          spreadRadius: 5,
                        ),
                      ],
                    ),
                    child: const Icon(
                      Icons.arrow_upward,
                      color: Colors.white,
                      size: 32,
                    ),
                  ),
                ),
              ),
            ),
        ],
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: (index) {
          if (index == 2) {
            // 카메라 버튼
            _openCamera();
          } else {
            setState(() {
              _currentIndex = index;
            });
          }
        },
        type: BottomNavigationBarType.fixed,
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.home_outlined),
            activeIcon: Icon(Icons.home),
            label: '홈',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.explore_outlined),
            activeIcon: Icon(Icons.explore),
            label: '탐색',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.add_circle_outline, size: 32),
            activeIcon: Icon(Icons.add_circle, size: 32),
            label: '등록',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.notifications_outlined),
            activeIcon: Icon(Icons.notifications),
            label: '알림',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            activeIcon: Icon(Icons.person),
            label: '프로필',
          ),
        ],
      ),
    );
  }
  
  void _openCamera() {
    setState(() {
      _showFirstFeedGuide = false;
    });
    
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.transparent,
      builder: (context) => const FeedCreationFlow(isFirstFeed: true),
    );
  }
}
```

## 6. 국가 선택 플로우

### [필수] 국가 선택 화면
```dart
// 파일: lib/features/onboarding/screens/country_selection_screen.dart
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/app_localizations.dart';

class CountrySelectionScreen extends StatefulWidget {
  @override
  _CountrySelectionScreenState createState() => _CountrySelectionScreenState();
}

class _CountrySelectionScreenState extends State<CountrySelectionScreen> {
  String? _selectedCountry;
  final TextEditingController _searchController = TextEditingController();
  List<Country> _filteredCountries = [];
  
  final List<Country> _countries = [
    Country(code: 'KR', name: '대한민국', nameEn: 'South Korea', flag: '🇰🇷', languages: ['ko']),
    Country(code: 'US', name: '미국', nameEn: 'United States', flag: '🇺🇸', languages: ['en']),
    Country(code: 'JP', name: '일본', nameEn: 'Japan', flag: '🇯🇵', languages: ['ja']),
    Country(code: 'CN', name: '중국', nameEn: 'China', flag: '🇨🇳', languages: ['zh']),
    Country(code: 'TW', name: '대만', nameEn: 'Taiwan', flag: '🇹🇼', languages: ['zh']),
    Country(code: 'HK', name: '홍콩', nameEn: 'Hong Kong', flag: '🇭🇰', languages: ['zh', 'en']),
    Country(code: 'SG', name: '싱가포르', nameEn: 'Singapore', flag: '🇸🇬', languages: ['en', 'zh']),
    Country(code: 'TH', name: '태국', nameEn: 'Thailand', flag: '🇹🇭', languages: ['th', 'en']),
    Country(code: 'VN', name: '베트남', nameEn: 'Vietnam', flag: '🇻🇳', languages: ['vi', 'en']),
    Country(code: 'MY', name: '말레이시아', nameEn: 'Malaysia', flag: '🇲🇾', languages: ['ms', 'en']),
  ];
  
  @override
  void initState() {
    super.initState();
    _filteredCountries = _countries;
    _detectCurrentCountry();
  }
  
  Future<void> _detectCurrentCountry() async {
    // 위치 기반 또는 시스템 언어 기반 국가 감지
    final locale = Localizations.localeOf(context);
    final countryCode = locale.countryCode ?? 'KR';
    
    setState(() {
      _selectedCountry = countryCode;
    });
  }
  
  void _filterCountries(String query) {
    setState(() {
      if (query.isEmpty) {
        _filteredCountries = _countries;
      } else {
        _filteredCountries = _countries.where((country) {
          return country.name.contains(query) ||
                 country.nameEn.toLowerCase().contains(query.toLowerCase()) ||
                 country.code.contains(query.toUpperCase());
        }).toList();
      }
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      appBar: AppBar(
        backgroundColor: Colors.transparent,
        elevation: 0,
        title: Text(
          '어느 나라에 계신가요?',
          style: TextStyle(
            color: Colors.black,
            fontSize: 24,
            fontWeight: FontWeight.bold,
          ),
        ),
        centerTitle: false,
      ),
      body: Column(
        children: [
          // 검색바
          Padding(
            padding: const EdgeInsets.all(16),
            child: TextField(
              controller: _searchController,
              onChanged: _filterCountries,
              decoration: InputDecoration(
                hintText: '국가 검색',
                prefixIcon: Icon(Icons.search),
                filled: true,
                fillColor: Colors.grey[100],
                border: OutlineInputBorder(
                  borderRadius: BorderRadius.circular(12),
                  borderSide: BorderSide.none,
                ),
                contentPadding: const EdgeInsets.symmetric(
                  horizontal: 16,
                  vertical: 12,
                ),
              ),
            ),
          ),
          
          // 추천 국가 (상위 5개)
          if (_searchController.text.isEmpty) ...[
            Padding(
              padding: const EdgeInsets.symmetric(horizontal: 16),
              child: Align(
                alignment: Alignment.centerLeft,
                child: Text(
                  '추천',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.bold,
                    color: Colors.grey[700],
                  ),
                ),
              ),
            ),
            const SizedBox(height: 8),
          ],
          
          // 국가 리스트
          Expanded(
            child: ListView.builder(
              padding: const EdgeInsets.symmetric(horizontal: 16),
              itemCount: _filteredCountries.length,
              itemBuilder: (context, index) {
                final country = _filteredCountries[index];
                final isSelected = _selectedCountry == country.code;
                
                return Padding(
                  padding: const EdgeInsets.only(bottom: 8),
                  child: InkWell(
                    onTap: () {
                      setState(() {
                        _selectedCountry = country.code;
                      });
                    },
                    borderRadius: BorderRadius.circular(12),
                    child: Container(
                      padding: const EdgeInsets.all(16),
                      decoration: BoxDecoration(
                        color: isSelected 
                            ? Theme.of(context).primaryColor.withOpacity(0.1)
                            : Colors.grey[50],
                        borderRadius: BorderRadius.circular(12),
                        border: Border.all(
                          color: isSelected
                              ? Theme.of(context).primaryColor
                              : Colors.transparent,
                          width: 2,
                        ),
                      ),
                      child: Row(
                        children: [
                          Text(
                            country.flag,
                            style: const TextStyle(fontSize: 32),
                          ),
                          const SizedBox(width: 16),
                          Expanded(
                            child: Column(
                              crossAxisAlignment: CrossAxisAlignment.start,
                              children: [
                                Text(
                                  country.name,
                                  style: const TextStyle(
                                    fontSize: 16,
                                    fontWeight: FontWeight.bold,
                                  ),
                                ),
                                Text(
                                  country.nameEn,
                                  style: TextStyle(
                                    fontSize: 14,
                                    color: Colors.grey[600],
                                  ),
                                ),
                              ],
                            ),
                          ),
                          if (isSelected)
                            Icon(
                              Icons.check_circle,
                              color: Theme.of(context).primaryColor,
                              size: 24,
                            ),
                        ],
                      ),
                    ),
                  ),
                );
              },
            ),
          ),
          
          // 계속 버튼
          Padding(
            padding: const EdgeInsets.all(16),
            child: ElevatedButton(
              onPressed: _selectedCountry != null ? _continueToNext : null,
              style: ElevatedButton.styleFrom(
                minimumSize: const Size(double.infinity, 56),
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(12),
                ),
              ),
              child: const Text(
                '계속',
                style: TextStyle(
                  fontSize: 16,
                  fontWeight: FontWeight.bold,
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  Future<void> _continueToNext() async {
    if (_selectedCountry == null) return;
    
    // 국가 저장
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    await onboardingManager.setSelectedCountry(_selectedCountry!);
    
    // 선택한 국가의 주 언어로 앱 언어 설정
    final selectedCountryData = _countries.firstWhere(
      (c) => c.code == _selectedCountry,
    );
    
    if (selectedCountryData.languages.isNotEmpty) {
      // TODO: 앱 언어 변경 로직
      // ref.read(localeProvider.notifier).state = 
      //     Locale(selectedCountryData.languages.first);
    }
    
    // 다음 화면으로
    Navigator.pushReplacementNamed(context, '/onboarding/permissions');
  }
}

class Country {
  final String code;
  final String name;
  final String nameEn;
  final String flag;
  final List<String> languages;
  
  Country({
    required this.code,
    required this.name,
    required this.nameEn,
    required this.flag,
    required this.languages,
  });
}
```

## 7. 첫 피드 등록 경험

### [필수] 첫 피드 등록 가이드
```dart
// 파일: lib/features/feed/screens/first_feed_guide_screen.dart
class FirstFeedGuideScreen extends StatefulWidget {
  @override
  _FirstFeedGuideScreenState createState() => _FirstFeedGuideScreenState();
}

class _FirstFeedGuideScreenState extends State<FirstFeedGuideScreen> 
    with TickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _scaleAnimation;
  late Animation<double> _fadeAnimation;
  
  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 1500),
      vsync: this,
    );
    
    _scaleAnimation = Tween<double>(
      begin: 0.8,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.elasticOut,
    ));
    
    _fadeAnimation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: const Interval(0.0, 0.5),
    ));
    
    _controller.forward();
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.black.withOpacity(0.9),
      body: SafeArea(
        child: Stack(
          children: [
            // 닫기 버튼
            Positioned(
              top: 16,
              right: 16,
              child: IconButton(
                onPressed: () => Navigator.pop(context),
                icon: const Icon(
                  Icons.close,
                  color: Colors.white,
                  size: 28,
                ),
              ),
            ),
            
            // 메인 콘텐츠
            Center(
              child: Padding(
                padding: const EdgeInsets.all(24),
                child: AnimatedBuilder(
                  animation: _controller,
                  builder: (context, child) {
                    return FadeTransition(
                      opacity: _fadeAnimation,
                      child: ScaleTransition(
                        scale: _scaleAnimation,
                        child: Column(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            // 타이틀
                            const Text(
                              '첫 피드를 등록해보세요! 🎉',
                              style: TextStyle(
                                color: Colors.white,
                                fontSize: 28,
                                fontWeight: FontWeight.bold,
                              ),
                            ),
                            const SizedBox(height: 24),
                            
                            // 설명
                            Text(
                              '지금 먹고 있는 맛있는 음식을\n다른 사람들과 공유해보세요',
                              textAlign: TextAlign.center,
                              style: TextStyle(
                                color: Colors.white.withOpacity(0.8),
                                fontSize: 16,
                                height: 1.5,
                              ),
                            ),
                            const SizedBox(height: 48),
                            
                            // 멀티 사진 가이드
                            Container(
                              padding: const EdgeInsets.all(20),
                              decoration: BoxDecoration(
                                color: Colors.white.withOpacity(0.1),
                                borderRadius: BorderRadius.circular(16),
                                border: Border.all(
                                  color: Colors.white.withOpacity(0.2),
                                ),
                              ),
                              child: Column(
                                children: [
                                  Row(
                                    mainAxisAlignment: MainAxisAlignment.center,
                                    children: [
                                      _buildPhotoGuide('1', '음식 사진', true),
                                      const SizedBox(width: 12),
                                      _buildPhotoGuide('2', '분위기', false),
                                      const SizedBox(width: 12),
                                      _buildPhotoGuide('3', '메뉴판', false),
                                      const SizedBox(width: 12),
                                      _buildPhotoGuide('4', '추가', false),
                                      const SizedBox(width: 12),
                                      _buildPhotoGuide('5', '추가', false),
                                    ],
                                  ),
                                  const SizedBox(height: 16),
                                  Text(
                                    '최대 5장까지 등록 가능해요',
                                    style: TextStyle(
                                      color: Colors.white.withOpacity(0.7),
                                      fontSize: 14,
                                    ),
                                  ),
                                ],
                              ),
                            ),
                            const SizedBox(height: 48),
                            
                            // 시작 버튼
                            ElevatedButton(
                              onPressed: () {
                                Navigator.pop(context);
                                _openCamera();
                              },
                              style: ElevatedButton.styleFrom(
                                backgroundColor: Theme.of(context).primaryColor,
                                minimumSize: const Size(200, 56),
                                shape: RoundedRectangleBorder(
                                  borderRadius: BorderRadius.circular(28),
                                ),
                              ),
                              child: const Text(
                                '카메라 열기',
                                style: TextStyle(
                                  fontSize: 18,
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                    );
                  },
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  Widget _buildPhotoGuide(String number, String label, bool isRequired) {
    return Column(
      children: [
        Container(
          width: 56,
          height: 56,
          decoration: BoxDecoration(
            color: isRequired 
                ? Theme.of(context).primaryColor 
                : Colors.white.withOpacity(0.2),
            borderRadius: BorderRadius.circular(8),
            border: Border.all(
              color: isRequired 
                  ? Theme.of(context).primaryColor 
                  : Colors.white.withOpacity(0.3),
              width: 2,
            ),
          ),
          child: Center(
            child: Text(
              number,
              style: TextStyle(
                color: isRequired ? Colors.white : Colors.white.withOpacity(0.7),
                fontSize: 20,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
        ),
        const SizedBox(height: 4),
        Text(
          label,
          style: TextStyle(
            color: Colors.white.withOpacity(0.8),
            fontSize: 12,
          ),
        ),
        if (isRequired)
          Text(
            '필수',
            style: TextStyle(
              color: Theme.of(context).primaryColor,
              fontSize: 10,
              fontWeight: FontWeight.bold,
            ),
          ),
      ],
    );
  }
  
  void _openCamera() {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.transparent,
      builder: (context) => const FeedCreationFlow(
        isFirstFeed: true,
        showMultiPhotoTip: true,
      ),
    );
  }
}
```

### [필수] 멀티 사진 등록 팁
```dart
// 파일: lib/features/feed/widgets/multi_photo_tip_widget.dart
class MultiPhotoTipWidget extends StatefulWidget {
  final VoidCallback onDismiss;
  
  const MultiPhotoTipWidget({
    Key? key,
    required this.onDismiss,
  }) : super(key: key);
  
  @override
  _MultiPhotoTipWidgetState createState() => _MultiPhotoTipWidgetState();
}

class _MultiPhotoTipWidgetState extends State<MultiPhotoTipWidget> 
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<Offset> _slideAnimation;
  
  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 500),
      vsync: this,
    );
    
    _slideAnimation = Tween<Offset>(
      begin: const Offset(0, 1),
      end: Offset.zero,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeOutCubic,
    ));
    
    _controller.forward();
    
    // 5초 후 자동 사라짐
    Future.delayed(const Duration(seconds: 5), () {
      if (mounted) {
        _dismiss();
      }
    });
  }
  
  void _dismiss() {
    _controller.reverse().then((_) {
      widget.onDismiss();
    });
  }

  @override
  Widget build(BuildContext context) {
    return SlideTransition(
      position: _slideAnimation,
      child: Container(
        margin: const EdgeInsets.all(16),
        padding: const EdgeInsets.all(16),
        decoration: BoxDecoration(
          color: Colors.black.withOpacity(0.9),
          borderRadius: BorderRadius.circular(12),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.3),
              blurRadius: 10,
              offset: const Offset(0, 5),
            ),
          ],
        ),
        child: Row(
          children: [
            Container(
              width: 48,
              height: 48,
              decoration: BoxDecoration(
                color: Theme.of(context).primaryColor.withOpacity(0.2),
                shape: BoxShape.circle,
              ),
              child: Center(
                child: Text(
                  '💡',
                  style: TextStyle(fontSize: 24),
                ),
              ),
            ),
            const SizedBox(width: 12),
            Expanded(
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                mainAxisSize: MainAxisSize.min,
                children: [
                  const Text(
                    '여러 장 등록 가능!',
                    style: TextStyle(
                      color: Colors.white,
                      fontSize: 16,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  const SizedBox(height: 4),
                  Text(
                    '음식, 분위기, 메뉴판 등 최대 5장까지 추가해보세요',
                    style: TextStyle(
                      color: Colors.white.withOpacity(0.8),
                      fontSize: 14,
                    ),
                  ),
                ],
              ),
            ),
            IconButton(
              onPressed: _dismiss,
              icon: Icon(
                Icons.close,
                color: Colors.white.withOpacity(0.6),
                size: 20,
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }
}
```

### [필수] 첫 피드 성공 축하
```dart
// 파일: lib/features/feed/screens/first_feed_success_screen.dart
class FirstFeedSuccessScreen extends StatefulWidget {
  final int earnedPoints;
  final String userGrade;
  
  const FirstFeedSuccessScreen({
    Key? key,
    required this.earnedPoints,
    required this.userGrade,
  }) : super(key: key);
  
  @override
  _FirstFeedSuccessScreenState createState() => _FirstFeedSuccessScreenState();
}

class _FirstFeedSuccessScreenState extends State<FirstFeedSuccessScreen> 
    with TickerProviderStateMixin {
  late AnimationController _confettiController;
  late AnimationController _contentController;
  late List<ConfettiParticle> _particles;
  
  @override
  void initState() {
    super.initState();
    
    // 폭죽 애니메이션
    _confettiController = AnimationController(
      duration: const Duration(seconds: 3),
      vsync: this,
    );
    
    // 콘텐츠 애니메이션
    _contentController = AnimationController(
      duration: const Duration(milliseconds: 800),
      vsync: this,
    );
    
    _particles = List.generate(50, (index) => ConfettiParticle());
    
    _confettiController.forward();
    _contentController.forward();
    
    // 첫 피드 완료 기록
    _markFirstFeedComplete();
  }
  
  Future<void> _markFirstFeedComplete() async {
    final prefs = await SharedPreferences.getInstance();
    final onboardingManager = OnboardingManager(prefs);
    await onboardingManager.markFirstFeedCreated();
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Theme.of(context).primaryColor,
      body: Stack(
        children: [
          // 폭죽 효과
          AnimatedBuilder(
            animation: _confettiController,
            builder: (context, child) {
              return CustomPaint(
                painter: ConfettiPainter(
                  particles: _particles,
                  progress: _confettiController.value,
                ),
                size: MediaQuery.of(context).size,
              );
            },
          ),
          
          // 메인 콘텐츠
          SafeArea(
            child: Padding(
              padding: const EdgeInsets.all(24),
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  // 축하 아이콘
                  AnimatedBuilder(
                    animation: _contentController,
                    builder: (context, child) {
                      return Transform.scale(
                        scale: 0.8 + (_contentController.value * 0.2),
                        child: Opacity(
                          opacity: _contentController.value,
                          child: Container(
                            width: 120,
                            height: 120,
                            decoration: BoxDecoration(
                              color: Colors.white,
                              shape: BoxShape.circle,
                              boxShadow: [
                                BoxShadow(
                                  color: Colors.black.withOpacity(0.2),
                                  blurRadius: 20,
                                  offset: const Offset(0, 10),
                                ),
                              ],
                            ),
                            child: Center(
                              child: Text(
                                '🎊',
                                style: TextStyle(fontSize: 60),
                              ),
                            ),
                          ),
                        ),
                      );
                    },
                  ),
                  const SizedBox(height: 32),
                  
                  // 축하 메시지
                  FadeTransition(
                    opacity: _contentController,
                    child: Column(
                      children: [
                        const Text(
                          '첫 피드 등록 완료!',
                          style: TextStyle(
                            color: Colors.white,
                            fontSize: 32,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                        const SizedBox(height: 16),
                        Text(
                          '축하합니다! 🎉\nFallingo의 미식 여정이 시작되었어요',
                          textAlign: TextAlign.center,
                          style: TextStyle(
                            color: Colors.white.withOpacity(0.9),
                            fontSize: 18,
                            height: 1.5,
                          ),
                        ),
                      ],
                    ),
                  ),
                  const SizedBox(height: 48),
                  
                  // 포인트 획득
                  SlideTransition(
                    position: Tween<Offset>(
                      begin: const Offset(0, 1),
                      end: Offset.zero,
                    ).animate(CurvedAnimation(
                      parent: _contentController,
                      curve: const Interval(0.5, 1.0),
                    )),
                    child: Container(
                      padding: const EdgeInsets.all(20),
                      decoration: BoxDecoration(
                        color: Colors.white.withOpacity(0.2),
                        borderRadius: BorderRadius.circular(16),
                        border: Border.all(
                          color: Colors.white.withOpacity(0.3),
                        ),
                      ),
                      child: Column(
                        children: [
                          Row(
                            mainAxisAlignment: MainAxisAlignment.center,
                            children: [
                              const Icon(
                                Icons.star,
                                color: Colors.yellow,
                                size: 32,
                              ),
                              const SizedBox(width: 8),
                              Text(
                                '+${widget.earnedPoints}점',
                                style: const TextStyle(
                                  color: Colors.white,
                                  fontSize: 28,
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 8),
                          Text(
                            '첫 피드 보너스 포함',
                            style: TextStyle(
                              color: Colors.white.withOpacity(0.8),
                              fontSize: 14,
                            ),
                          ),
                        ],
                      ),
                    ),
                  ),
                  const SizedBox(height: 24),
                  
                  // 현재 등급
                  FadeTransition(
                    opacity: _contentController,
                    child: Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        const Text(
                          '현재 등급:',
                          style: TextStyle(
                            color: Colors.white,
                            fontSize: 16,
                          ),
                        ),
                        const SizedBox(width: 8),
                        Container(
                          padding: const EdgeInsets.symmetric(
                            horizontal: 16,
                            vertical: 8,
                          ),
                          decoration: BoxDecoration(
                            color: Colors.white.withOpacity(0.2),
                            borderRadius: BorderRadius.circular(20),
                          ),
                          child: Text(
                            widget.userGrade,
                            style: const TextStyle(
                              color: Colors.white,
                              fontSize: 16,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        ),
                      ],
                    ),
                  ),
                  const Spacer(),
                  
                  // 계속하기 버튼
                  ElevatedButton(
                    onPressed: () {
                      Navigator.pushNamedAndRemoveUntil(
                        context,
                        '/main',
                        (route) => false,
                      );
                    },
                    style: ElevatedButton.styleFrom(
                      backgroundColor: Colors.white,
                      foregroundColor: Theme.of(context).primaryColor,
                      minimumSize: const Size(double.infinity, 56),
                      shape: RoundedRectangleBorder(
                        borderRadius: BorderRadius.circular(28),
                      ),
                    ),
                    child: const Text(
                      '홈으로 가기',
                      style: TextStyle(
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  @override
  void dispose() {
    _confettiController.dispose();
    _contentController.dispose();
    super.dispose();
  }
}

// 폭죽 파티클
class ConfettiParticle {
  late double x;
  late double y;
  late double vx;
  late double vy;
  late Color color;
  late double size;
  
  ConfettiParticle() {
    final random = Random();
    x = random.nextDouble();
    y = random.nextDouble() * 0.5;
    vx = (random.nextDouble() - 0.5) * 2;
    vy = random.nextDouble() * -2 - 1;
    color = [
      Colors.red,
      Colors.yellow,
      Colors.green,
      Colors.blue,
      Colors.orange,
      Colors.purple,
    ][random.nextInt(6)];
    size = random.nextDouble() * 10 + 5;
  }
}

// 폭죽 페인터
class ConfettiPainter extends CustomPainter {
  final List<ConfettiParticle> particles;
  final double progress;
  
  ConfettiPainter({
    required this.particles,
    required this.progress,
  });
  
  @override
  void paint(Canvas canvas, Size size) {
    for (var particle in particles) {
      final paint = Paint()
        ..color = particle.color.withOpacity(1 - progress)
        ..style = PaintingStyle.fill;
      
      final x = particle.x * size.width + particle.vx * progress * 100;
      final y = particle.y * size.height + 
               particle.vy * progress * 100 + 
               progress * progress * 200; // 중력 효과
      
      canvas.drawCircle(
        Offset(x, y),
        particle.size * (1 - progress * 0.5),
        paint,
      );
    }
  }
  
  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => true;
}
```

## 8. 검증

### ✅ 체크리스트
- [ ] 스플래시 화면 2초 이상 표시
- [ ] 온보딩 페이지 스와이프 동작
- [ ] 국가 선택 화면 정상 동작
- [ ] 국가별 언어 자동 설정
- [ ] 위치 권한 요청 다이얼로그 표시
- [ ] 소셜 로그인 정상 동작
- [ ] 첫 피드 화면 진입 성공
- [ ] 웰컴 메시지 표시
- [ ] 첫 피드 가이드 표시
- [ ] 멀티 사진 팁 표시
- [ ] 첫 피드 성공 축하 화면

### 🧪 온보딩 플로우 테스트
```dart
// 파일: test/onboarding/onboarding_flow_test.dart
void main() {
  group('온보딩 플로우 테스트', () {
    testWidgets('첫 실행 시 웰컴 화면 표시', (tester) async {
      // SharedPreferences Mock 설정
      SharedPreferences.setMockInitialValues({});
      
      await tester.pumpWidget(MyApp());
      await tester.pumpAndSettle();
      
      // 스플래시 후 웰컴 화면
      expect(find.text('진짜 맛집,\n현장에서 만나요'), findsOneWidget);
    });
    
    testWidgets('국가 선택 가능', (tester) async {
      await tester.pumpWidget(CountrySelectionScreen());
      await tester.pumpAndSettle();
      
      // 한국 선택
      await tester.tap(find.text('대한민국'));
      await tester.pumpAndSettle();
      
      // 계속 버튼 활성화 확인
      final continueButton = find.text('계속');
      expect(continueButton, findsOneWidget);
      expect(
        tester.widget<ElevatedButton>(
          find.ancestor(
            of: continueButton,
            matching: find.byType(ElevatedButton),
          ),
        ).onPressed,
        isNotNull,
      );
    });
    
    testWidgets('첫 피드 가이드 표시', (tester) async {
      await tester.pumpWidget(FirstFeedGuideScreen());
      await tester.pumpAndSettle();
      
      // 멀티 사진 가이드 확인
      expect(find.text('최대 5장까지 등록 가능해요'), findsOneWidget);
      expect(find.text('필수'), findsOneWidget);
    });
  });
}
```