# ğŸ“¸ 13.2 í”¼ë“œ ë“±ë¡ ì „ì²´ íë¦„

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [ì¹´ë©”ë¼ì—ì„œ ë“±ë¡ ì™„ë£Œê¹Œì§€](#2-ì¹´ë©”ë¼ì—ì„œ-ë“±ë¡-ì™„ë£Œê¹Œì§€)
3. [ê° ë‹¨ê³„ ê²€ì¦](#3-ê°-ë‹¨ê³„-ê²€ì¦)
4. [ì—ëŸ¬ ì¼€ì´ìŠ¤](#4-ì—ëŸ¬-ì¼€ì´ìŠ¤)
5. [ì„±ê³µ ê¸°ì¤€](#5-ì„±ê³µ-ê¸°ì¤€)
6. [ìŒì‹ ì‚¬ì§„ ê²€ì¦](#6-ìŒì‹-ì‚¬ì§„-ê²€ì¦)
7. [ë©€í‹° ì‚¬ì§„ ë“±ë¡](#7-ë©€í‹°-ì‚¬ì§„-ë“±ë¡)
8. [ë‚˜ì¤‘ì— ì˜ìˆ˜ì¦ ì¶”ê°€](#8-ë‚˜ì¤‘ì—-ì˜ìˆ˜ì¦-ì¶”ê°€)
9. [ê²€ì¦](#9-ê²€ì¦)

## 1. ê°œìš”
ì‚¬ìš©ìê°€ í”¼ë“œë¥¼ ë“±ë¡í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¨ê³„ë³„ë¡œ êµ¬í˜„í•˜ê³  ê²€ì¦í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… 5ë‹¨ê³„ ë“±ë¡ í”„ë¡œì„¸ìŠ¤
- âœ… ê° ë‹¨ê³„ë³„ ìœ íš¨ì„± ê²€ì¦
- âœ… ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ì²˜ë¦¬
- âœ… ì„±ê³µì ì¸ ë“±ë¡ ì™„ë£Œ
- âœ… ë©€í‹° ì‚¬ì§„ ì§€ì› (ìµœëŒ€ 5ì¥)
- âœ… 24ì‹œê°„ ë‚´ ì˜ìˆ˜ì¦ ì¶”ê°€ ê°€ëŠ¥

## 2. ì¹´ë©”ë¼ì—ì„œ ë“±ë¡ ì™„ë£Œê¹Œì§€

### [í•„ìˆ˜] í”¼ë“œ ë“±ë¡ í”Œë¡œìš° ê´€ë¦¬ì
```dart
// íŒŒì¼: lib/features/feed_creation/managers/feed_creation_manager.dart
import 'package:flutter/material.dart';
import 'dart:io';

class FeedCreationManager extends ChangeNotifier {
  // í˜„ì¬ ë‹¨ê³„
  FeedCreationStep _currentStep = FeedCreationStep.camera;
  
  // ê° ë‹¨ê³„ë³„ ë°ì´í„°
  List<File> _capturedImages = [];
  String? _recognizedFood;
  Map<String, dynamic>? _ocrData;
  Location? _verifiedLocation;
  FeedData? _feedData;
  
  // Getters
  FeedCreationStep get currentStep => _currentStep;
  List<File> get capturedImages => _capturedImages;
  String? get recognizedFood => _recognizedFood;
  Map<String, dynamic>? get ocrData => _ocrData;
  Location? get verifiedLocation => _verifiedLocation;
  FeedData? get feedData => _feedData;
  
  // ì§„í–‰ë¥  ê³„ì‚°
  double get progress {
    switch (_currentStep) {
      case FeedCreationStep.camera:
        return 0.2;
      case FeedCreationStep.imageProcessing:
        return 0.4;
      case FeedCreationStep.locationVerification:
        return 0.6;
      case FeedCreationStep.infoInput:
        return 0.8;
      case FeedCreationStep.completion:
        return 1.0;
    }
  }
  
  // ë‹¨ê³„ ì§„í–‰
  void proceedToNextStep() {
    switch (_currentStep) {
      case FeedCreationStep.camera:
        _currentStep = FeedCreationStep.imageProcessing;
        break;
      case FeedCreationStep.imageProcessing:
        _currentStep = FeedCreationStep.locationVerification;
        break;
      case FeedCreationStep.locationVerification:
        _currentStep = FeedCreationStep.infoInput;
        break;
      case FeedCreationStep.infoInput:
        _currentStep = FeedCreationStep.completion;
        break;
      case FeedCreationStep.completion:
        // ì™„ë£Œ
        break;
    }
    notifyListeners();
  }
  
  // ì´ì „ ë‹¨ê³„ë¡œ
  void goToPreviousStep() {
    switch (_currentStep) {
      case FeedCreationStep.camera:
        // ì²« ë‹¨ê³„
        break;
      case FeedCreationStep.imageProcessing:
        _currentStep = FeedCreationStep.camera;
        break;
      case FeedCreationStep.locationVerification:
        _currentStep = FeedCreationStep.imageProcessing;
        break;
      case FeedCreationStep.infoInput:
        _currentStep = FeedCreationStep.locationVerification;
        break;
      case FeedCreationStep.completion:
        _currentStep = FeedCreationStep.infoInput;
        break;
    }
    notifyListeners();
  }
  
  // ë°ì´í„° ì €ì¥
  void addCapturedImage(File image) {
    if (_capturedImages.length < 5) {
      _capturedImages.add(image);
      notifyListeners();
    }
  }
  
  void removeCapturedImage(int index) {
    if (index >= 0 && index < _capturedImages.length) {
      _capturedImages.removeAt(index);
      notifyListeners();
    }
  }
  
  void reorderImages(int oldIndex, int newIndex) {
    if (oldIndex < newIndex) {
      newIndex -= 1;
    }
    final image = _capturedImages.removeAt(oldIndex);
    _capturedImages.insert(newIndex, image);
    notifyListeners();
  }
  
  void setRecognizedFood(String food) {
    _recognizedFood = food;
    notifyListeners();
  }
  
  void setOcrData(Map<String, dynamic> data) {
    _ocrData = data;
    notifyListeners();
  }
  
  void setVerifiedLocation(Location location) {
    _verifiedLocation = location;
    notifyListeners();
  }
  
  void setFeedData(FeedData data) {
    _feedData = data;
    notifyListeners();
  }
  
  // ì´ˆê¸°í™”
  void reset() {
    _currentStep = FeedCreationStep.camera;
    _capturedImages.clear();
    _recognizedFood = null;
    _ocrData = null;
    _verifiedLocation = null;
    _feedData = null;
    notifyListeners();
  }
}

enum FeedCreationStep {
  camera,
  imageProcessing,
  locationVerification,
  infoInput,
  completion,
}
```

### [í•„ìˆ˜] ë©”ì¸ í”Œë¡œìš° ìœ„ì ¯
```dart
// íŒŒì¼: lib/features/feed_creation/screens/feed_creation_flow.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

class FeedCreationFlow extends StatefulWidget {
  final bool isFirstFeed;
  final bool showMultiPhotoTip;
  
  const FeedCreationFlow({
    Key? key,
    this.isFirstFeed = false,
    this.showMultiPhotoTip = false,
  }) : super(key: key);

  @override
  _FeedCreationFlowState createState() => _FeedCreationFlowState();
}

class _FeedCreationFlowState extends State<FeedCreationFlow> {
  late FeedCreationManager _manager;
  
  @override
  void initState() {
    super.initState();
    _manager = FeedCreationManager();
  }
  
  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider.value(
      value: _manager,
      child: Consumer<FeedCreationManager>(
        builder: (context, manager, child) {
          return Container(
            height: MediaQuery.of(context).size.height * 0.95,
            decoration: const BoxDecoration(
              color: Colors.white,
              borderRadius: BorderRadius.vertical(
                top: Radius.circular(20),
              ),
            ),
            child: Column(
              children: [
                // í•¸ë“¤ ë°”
                Container(
                  margin: const EdgeInsets.only(top: 12),
                  width: 40,
                  height: 4,
                  decoration: BoxDecoration(
                    color: Colors.grey[300],
                    borderRadius: BorderRadius.circular(2),
                  ),
                ),
                
                // í—¤ë”
                _buildHeader(manager),
                
                // ì§„í–‰ë¥  í‘œì‹œ
                _buildProgressIndicator(manager),
                
                // ì½˜í…ì¸ 
                Expanded(
                  child: _buildContent(manager),
                ),
              ],
            ),
          );
        },
      ),
    );
  }
  
  Widget _buildHeader(FeedCreationManager manager) {
    return Container(
      padding: const EdgeInsets.all(16),
      child: Row(
        children: [
          // ë’¤ë¡œê°€ê¸°
          if (manager.currentStep != FeedCreationStep.camera)
            IconButton(
              onPressed: () => manager.goToPreviousStep(),
              icon: const Icon(Icons.arrow_back),
            )
          else
            const SizedBox(width: 48),
          
          // ì œëª©
          Expanded(
            child: Text(
              _getStepTitle(manager.currentStep),
              textAlign: TextAlign.center,
              style: const TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
          
          // ë‹«ê¸°
          IconButton(
            onPressed: () => _showExitConfirmation(),
            icon: const Icon(Icons.close),
          ),
        ],
      ),
    );
  }
  
  Widget _buildProgressIndicator(FeedCreationManager manager) {
    return Container(
      height: 4,
      margin: const EdgeInsets.symmetric(horizontal: 16),
      child: LinearProgressIndicator(
        value: manager.progress,
        backgroundColor: Colors.grey[200],
        valueColor: AlwaysStoppedAnimation<Color>(
          Theme.of(context).primaryColor,
        ),
      ),
    );
  }
  
  Widget _buildContent(FeedCreationManager manager) {
    switch (manager.currentStep) {
      case FeedCreationStep.camera:
        return MultiPhotoCameraStep(
          onImagesSelected: (images) {
            for (var image in images) {
              manager.addCapturedImage(image);
            }
            manager.proceedToNextStep();
          },
          showTip: widget.showMultiPhotoTip,
        );
        
      case FeedCreationStep.imageProcessing:
        return ImageProcessingStep(
          images: manager.capturedImages,
          onProcessed: (recognizedFood) {
            manager.setRecognizedFood(recognizedFood);
            manager.proceedToNextStep();
          },
        );
        
      case FeedCreationStep.locationVerification:
        return LocationVerificationStep(
          initialFood: manager.recognizedFood,
          onVerified: (location, ocrData) {
            manager.setVerifiedLocation(location);
            if (ocrData != null) {
              manager.setOcrData(ocrData);
            }
            manager.proceedToNextStep();
          },
        );
        
      case FeedCreationStep.infoInput:
        return InfoInputStep(
          images: manager.capturedImages,
          recognizedFood: manager.recognizedFood!,
          location: manager.verifiedLocation!,
          onCompleted: (feedData) {
            manager.setFeedData(feedData);
            manager.proceedToNextStep();
          },
        );
        
      case FeedCreationStep.completion:
        return CompletionStep(
          feedData: manager.feedData!,
          isFirstFeed: widget.isFirstFeed,
          onClose: () {
            Navigator.of(context).pop();
            // ë©”ì¸ í”¼ë“œë¡œ ì´ë™
          },
        );
    }
  }
  
  String _getStepTitle(FeedCreationStep step) {
    switch (step) {
      case FeedCreationStep.camera:
        return 'ì‚¬ì§„ ì´¬ì˜';
      case FeedCreationStep.imageProcessing:
        return 'ìŒì‹ ì¸ì‹';
      case FeedCreationStep.locationVerification:
        return 'ìœ„ì¹˜ í™•ì¸';
      case FeedCreationStep.infoInput:
        return 'ì •ë³´ ì…ë ¥';
      case FeedCreationStep.completion:
        return 'ë“±ë¡ ì™„ë£Œ';
    }
  }
  
  void _showExitConfirmation() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('ë“±ë¡ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'),
        content: const Text('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('ê³„ì† ì‘ì„±'),
          ),
          TextButton(
            onPressed: () {
              Navigator.of(context).pop(); // ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
              Navigator.of(context).pop(); // í”Œë¡œìš° ë‹«ê¸°
            },
            child: const Text(
              'ì·¨ì†Œ',
              style: TextStyle(color: Colors.red),
            ),
          ),
        ],
      ),
    );
  }
}
```

## 6. ìŒì‹ ì‚¬ì§„ ê²€ì¦

### [í•„ìˆ˜] ìŒì‹ ì¸ì‹ ê²€ì¦ ë¡œì§
```dart
// íŒŒì¼: lib/features/feed_creation/validators/food_image_validator.dart
import 'package:flutter/material.dart';
import 'dart:io';

class FoodImageValidator {
  static const double minFoodConfidence = 0.7;
  static const List<String> foodLabels = [
    'food', 'dish', 'meal', 'cuisine', 'dessert', 'beverage',
    'ìŒì‹', 'ìš”ë¦¬', 'ë””ì €íŠ¸', 'ìŒë£Œ', // í•œêµ­ì–´ ë¼ë²¨
  ];
  
  /// ìŒì‹ ì´ë¯¸ì§€ ê²€ì¦
  static Future<FoodValidationResult> validateFoodImage(File image) async {
    try {
      // Cloud Vision API í˜¸ì¶œ (Mock)
      final labels = await _analyzeImage(image);
      
      // ìŒì‹ ê´€ë ¨ ë¼ë²¨ í™•ì¸
      final foodLabel = labels.firstWhere(
        (label) => foodLabels.any((food) => 
          label.description.toLowerCase().contains(food.toLowerCase())
        ),
        orElse: () => ImageLabel(description: '', confidence: 0),
      );
      
      if (foodLabel.confidence >= minFoodConfidence) {
        // ìŒì‹ ì¢…ë¥˜ ì¶”ì •
        final foodType = _estimateFoodType(labels);
        
        return FoodValidationResult(
          isValid: true,
          confidence: foodLabel.confidence,
          foodType: foodType,
          message: 'ìŒì‹ì´ ì¸ì‹ë˜ì—ˆìŠµë‹ˆë‹¤',
        );
      } else {
        return FoodValidationResult(
          isValid: false,
          confidence: foodLabel.confidence,
          message: 'ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤',
        );
      }
    } catch (e) {
      return FoodValidationResult(
        isValid: false,
        confidence: 0,
        message: 'ì´ë¯¸ì§€ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
      );
    }
  }
  
  /// ë©€í‹° ì´ë¯¸ì§€ ê²€ì¦ (ì²« ë²ˆì§¸ë§Œ ìŒì‹ í•„ìˆ˜)
  static Future<MultiImageValidationResult> validateMultipleImages(
    List<File> images,
  ) async {
    if (images.isEmpty) {
      return MultiImageValidationResult(
        isValid: false,
        results: [],
        message: 'ìµœì†Œ 1ì¥ì˜ ì‚¬ì§„ì´ í•„ìš”í•©ë‹ˆë‹¤',
      );
    }
    
    final results = <FoodValidationResult>[];
    
    // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ëŠ” ë°˜ë“œì‹œ ìŒì‹ì´ì–´ì•¼ í•¨
    final firstResult = await validateFoodImage(images.first);
    results.add(firstResult);
    
    if (!firstResult.isValid) {
      return MultiImageValidationResult(
        isValid: false,
        results: results,
        message: 'ì²« ë²ˆì§¸ ì‚¬ì§„ì€ ë°˜ë“œì‹œ ìŒì‹ ì‚¬ì§„ì´ì–´ì•¼ í•©ë‹ˆë‹¤',
      );
    }
    
    // ë‚˜ë¨¸ì§€ ì´ë¯¸ì§€ëŠ” ììœ 
    for (int i = 1; i < images.length; i++) {
      // ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬ë§Œ ìˆ˜í–‰
      final isValid = await _validateGeneralImage(images[i]);
      results.add(FoodValidationResult(
        isValid: isValid,
        confidence: 1.0,
        message: isValid ? 'ì´ë¯¸ì§€ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ì´ë¯¸ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
      ));
    }
    
    return MultiImageValidationResult(
      isValid: true,
      results: results,
      message: 'ëª¨ë“  ì´ë¯¸ì§€ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤',
      recognizedFood: firstResult.foodType,
    );
  }
  
  /// Mock ì´ë¯¸ì§€ ë¶„ì„
  static Future<List<ImageLabel>> _analyzeImage(File image) async {
    // ì‹¤ì œë¡œëŠ” Cloud Vision API í˜¸ì¶œ
    await Future.delayed(const Duration(seconds: 1));
    
    return [
      ImageLabel(description: 'food', confidence: 0.95),
      ImageLabel(description: 'ê¹€ì¹˜ì°Œê°œ', confidence: 0.92),
      ImageLabel(description: 'í•œì‹', confidence: 0.88),
      ImageLabel(description: 'stew', confidence: 0.85),
    ];
  }
  
  /// ìŒì‹ ì¢…ë¥˜ ì¶”ì •
  static String? _estimateFoodType(List<ImageLabel> labels) {
    // ê°€ì¥ êµ¬ì²´ì ì¸ ìŒì‹ ë¼ë²¨ ì°¾ê¸°
    final foodLabels = labels.where((label) => 
      label.confidence > 0.8 && 
      !['food', 'dish', 'meal', 'ìŒì‹', 'ìš”ë¦¬'].contains(label.description.toLowerCase())
    ).toList();
    
    if (foodLabels.isNotEmpty) {
      return foodLabels.first.description;
    }
    
    return null;
  }
  
  /// ì¼ë°˜ ì´ë¯¸ì§€ ê²€ì¦
  static Future<bool> _validateGeneralImage(File image) async {
    try {
      // íŒŒì¼ ì¡´ì¬ í™•ì¸
      if (!await image.exists()) return false;
      
      // íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ì´í•˜)
      final fileSize = await image.length();
      if (fileSize > 10 * 1024 * 1024) return false;
      
      // ì´ë¯¸ì§€ í˜•ì‹ í™•ì¸
      final extension = image.path.split('.').last.toLowerCase();
      final validFormats = ['jpg', 'jpeg', 'png', 'webp'];
      if (!validFormats.contains(extension)) return false;
      
      return true;
    } catch (e) {
      return false;
    }
  }
}

class FoodValidationResult {
  final bool isValid;
  final double confidence;
  final String? foodType;
  final String message;
  
  FoodValidationResult({
    required this.isValid,
    required this.confidence,
    this.foodType,
    required this.message,
  });
}

class MultiImageValidationResult {
  final bool isValid;
  final List<FoodValidationResult> results;
  final String message;
  final String? recognizedFood;
  
  MultiImageValidationResult({
    required this.isValid,
    required this.results,
    required this.message,
    this.recognizedFood,
  });
}

class ImageLabel {
  final String description;
  final double confidence;
  
  ImageLabel({
    required this.description,
    required this.confidence,
  });
}
```

### [í•„ìˆ˜] ì‹¤ì‹œê°„ ìŒì‹ ê°ì§€ UI
```dart
// íŒŒì¼: lib/features/feed_creation/widgets/food_detection_overlay.dart
class FoodDetectionOverlay extends StatelessWidget {
  final bool isFoodDetected;
  final String? detectedFood;
  final int? existingCount;
  final double? confidence;
  
  const FoodDetectionOverlay({
    Key? key,
    required this.isFoodDetected,
    this.detectedFood,
    this.existingCount,
    this.confidence,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return AnimatedSwitcher(
      duration: const Duration(milliseconds: 300),
      child: isFoodDetected
          ? Container(
              key: const ValueKey('detected'),
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.green.withOpacity(0.9),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                mainAxisSize: MainAxisSize.min,
                children: [
                  Row(
                    children: [
                      const Icon(
                        Icons.check_circle,
                        color: Colors.white,
                        size: 20,
                      ),
                      const SizedBox(width: 8),
                      Text(
                        detectedFood ?? 'ìŒì‹ ì¸ì‹ë¨',
                        style: const TextStyle(
                          color: Colors.white,
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                    ],
                  ),
                  if (existingCount != null) ...[
                    const SizedBox(height: 4),
                    Text(
                      'ğŸ‘ $existingCountê°œ ì¶”ì²œ',
                      style: const TextStyle(
                        color: Colors.white70,
                        fontSize: 14,
                      ),
                    ),
                  ],
                  if (confidence != null) ...[
                    const SizedBox(height: 4),
                    LinearProgressIndicator(
                      value: confidence!,
                      backgroundColor: Colors.white24,
                      valueColor: const AlwaysStoppedAnimation<Color>(
                        Colors.white,
                      ),
                    ),
                  ],
                ],
              ),
            )
          : Container(
              key: const ValueKey('not_detected'),
              padding: const EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.orange.withOpacity(0.9),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  const Icon(
                    Icons.camera_alt,
                    color: Colors.white,
                    size: 20,
                  ),
                  const SizedBox(width: 8),
                  const Expanded(
                    child: Text(
                      'ìŒì‹ì„ ì¹´ë©”ë¼ì— ë‹´ì•„ì£¼ì„¸ìš”',
                      style: TextStyle(
                        color: Colors.white,
                        fontSize: 16,
                      ),
                    ),
                  ),
                ],
              ),
            ),
    );
  }
}
```

## 7. ë©€í‹° ì‚¬ì§„ ë“±ë¡

### [í•„ìˆ˜] ë©€í‹° ì‚¬ì§„ ì¹´ë©”ë¼ ìŠ¤í…
```dart
// íŒŒì¼: lib/features/feed_creation/steps/multi_photo_camera_step.dart
import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'dart:io';

class MultiPhotoCameraStep extends StatefulWidget {
  final Function(List<File>) onImagesSelected;
  final bool showTip;
  
  const MultiPhotoCameraStep({
    Key? key,
    required this.onImagesSelected,
    this.showTip = false,
  }) : super(key: key);
  
  @override
  _MultiPhotoCameraStepState createState() => _MultiPhotoCameraStepState();
}

class _MultiPhotoCameraStepState extends State<MultiPhotoCameraStep> {
  CameraController? _controller;
  bool _isInitialized = false;
  bool _isProcessing = false;
  List<File> _capturedImages = [];
  bool _isFoodDetected = false;
  String? _detectedFood;
  bool _showMultiPhotoTip = false;
  
  @override
  void initState() {
    super.initState();
    _showMultiPhotoTip = widget.showTip;
    _initializeCamera();
  }
  
  Future<void> _initializeCamera() async {
    try {
      final cameras = await availableCameras();
      if (cameras.isEmpty) {
        _showError('ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      _controller = CameraController(
        cameras.first,
        ResolutionPreset.high,
        enableAudio: false,
      );
      
      await _controller!.initialize();
      
      // ì‹¤ì‹œê°„ ìŒì‹ ì¸ì‹ ì‹œì‘
      _startFoodRecognition();
      
      setState(() {
        _isInitialized = true;
      });
    } catch (e) {
      _showError('ì¹´ë©”ë¼ ì´ˆê¸°í™” ì‹¤íŒ¨: $e');
    }
  }
  
  void _startFoodRecognition() {
    // ì‹¤ì‹œê°„ ì¸ì‹ì€ ì²« ë²ˆì§¸ ì‚¬ì§„ë§Œ
    if (_capturedImages.isNotEmpty) return;
    
    // 1ì´ˆë§ˆë‹¤ í”„ë ˆì„ ë¶„ì„ (Mock)
    Future.delayed(const Duration(seconds: 1), () {
      if (!mounted || _controller == null) return;
      
      // Mock ìŒì‹ ì¸ì‹
      setState(() {
        _isFoodDetected = true;
        _detectedFood = 'ê¹€ì¹˜ì°Œê°œ';
      });
      
      if (mounted && _capturedImages.isEmpty) {
        _startFoodRecognition();
      }
    });
  }
  
  @override
  Widget build(BuildContext context) {
    if (!_isInitialized || _controller == null) {
      return const Center(
        child: CircularProgressIndicator(),
      );
    }
    
    return Stack(
      children: [
        // ì¹´ë©”ë¼ í”„ë¦¬ë·°
        Positioned.fill(
          child: CameraPreview(_controller!),
        ),
        
        // ë©€í‹° ì‚¬ì§„ íŒ
        if (_showMultiPhotoTip)
          Positioned(
            top: 100,
            left: 16,
            right: 16,
            child: MultiPhotoTipWidget(
              onDismiss: () {
                setState(() {
                  _showMultiPhotoTip = false;
                });
              },
            ),
          ),
        
        // ìŒì‹ ê°ì§€ ì˜¤ë²„ë ˆì´ (ì²« ë²ˆì§¸ ì‚¬ì§„ë§Œ)
        if (_capturedImages.isEmpty)
          Positioned(
            top: 20,
            left: 20,
            right: 20,
            child: FoodDetectionOverlay(
              isFoodDetected: _isFoodDetected,
              detectedFood: _detectedFood,
              existingCount: 234,
              confidence: 0.92,
            ),
          ),
        
        // ê°€ì´ë“œ í”„ë ˆì„
        Center(
          child: Container(
            width: 300,
            height: 300,
            decoration: BoxDecoration(
              border: Border.all(
                color: Colors.white.withOpacity(0.5),
                width: 2,
              ),
              borderRadius: BorderRadius.circular(12),
            ),
          ),
        ),
        
        // í•˜ë‹¨ UI
        Positioned(
          bottom: 0,
          left: 0,
          right: 0,
          child: Container(
            color: Colors.black.withOpacity(0.7),
            padding: const EdgeInsets.symmetric(vertical: 20),
            child: Column(
              children: [
                // ìº¡ì²˜ëœ ì´ë¯¸ì§€ ì¸ë„¤ì¼
                if (_capturedImages.isNotEmpty)
                  Container(
                    height: 80,
                    margin: const EdgeInsets.only(bottom: 20),
                    child: ListView.builder(
                      scrollDirection: Axis.horizontal,
                      padding: const EdgeInsets.symmetric(horizontal: 20),
                      itemCount: _capturedImages.length + 1,
                      itemBuilder: (context, index) {
                        if (index == _capturedImages.length) {
                          // ì¶”ê°€ ë²„íŠ¼
                          if (_capturedImages.length < 5) {
                            return _buildAddPhotoButton();
                          } else {
                            return const SizedBox.shrink();
                          }
                        }
                        
                        return _buildThumbnail(index);
                      },
                    ),
                  ),
                
                // ì´¬ì˜ ë²„íŠ¼ ë˜ëŠ” ì™„ë£Œ ë²„íŠ¼
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                  children: [
                    // ê°¤ëŸ¬ë¦¬
                    IconButton(
                      onPressed: _pickFromGallery,
                      icon: Container(
                        padding: const EdgeInsets.all(12),
                        decoration: BoxDecoration(
                          color: Colors.white.withOpacity(0.2),
                          shape: BoxShape.circle,
                        ),
                        child: const Icon(
                          Icons.photo_library,
                          color: Colors.white,
                          size: 24,
                        ),
                      ),
                    ),
                    
                    // ì´¬ì˜/ì™„ë£Œ ë²„íŠ¼
                    GestureDetector(
                      onTap: _isProcessing 
                          ? null 
                          : (_capturedImages.isEmpty ? _takePicture : _complete),
                      child: Container(
                        width: 80,
                        height: 80,
                        decoration: BoxDecoration(
                          color: _capturedImages.isEmpty 
                              ? Colors.white 
                              : Theme.of(context).primaryColor,
                          shape: BoxShape.circle,
                          border: Border.all(
                            color: _capturedImages.isEmpty
                                ? Theme.of(context).primaryColor
                                : Colors.white,
                            width: 4,
                          ),
                        ),
                        child: _isProcessing
                            ? const Center(
                                child: CircularProgressIndicator(),
                              )
                            : Icon(
                                _capturedImages.isEmpty 
                                    ? Icons.camera 
                                    : Icons.check,
                                size: 40,
                                color: _capturedImages.isEmpty
                                    ? Theme.of(context).primaryColor
                                    : Colors.white,
                              ),
                      ),
                    ),
                    
                    // ì‚¬ì§„ ìˆ˜
                    Container(
                      width: 48,
                      height: 48,
                      decoration: BoxDecoration(
                        color: Colors.white.withOpacity(0.2),
                        shape: BoxShape.circle,
                      ),
                      child: Center(
                        child: Text(
                          '${_capturedImages.length}/5',
                          style: const TextStyle(
                            color: Colors.white,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                      ),
                    ),
                  ],
                ),
                
                // ì•ˆë‚´ í…ìŠ¤íŠ¸
                if (_capturedImages.isEmpty)
                  const Padding(
                    padding: EdgeInsets.only(top: 8),
                    child: Text(
                      'ì²« ë²ˆì§¸ ì‚¬ì§„ì€ ë°˜ë“œì‹œ ìŒì‹ ì‚¬ì§„ì´ì–´ì•¼ í•´ìš”',
                      style: TextStyle(
                        color: Colors.white70,
                        fontSize: 12,
                      ),
                    ),
                  )
                else if (_capturedImages.length == 1)
                  const Padding(
                    padding: EdgeInsets.only(top: 8),
                    child: Text(
                      'ë¶„ìœ„ê¸°, ë©”ë‰´íŒ ë“±ì„ ì¶”ê°€ë¡œ ì´¬ì˜í•  ìˆ˜ ìˆì–´ìš”',
                      style: TextStyle(
                        color: Colors.white70,
                        fontSize: 12,
                      ),
                    ),
                  ),
              ],
            ),
          ),
        ),
      ],
    );
  }
  
  Widget _buildThumbnail(int index) {
    return Container(
      margin: const EdgeInsets.only(right: 8),
      child: Stack(
        children: [
          ClipRRect(
            borderRadius: BorderRadius.circular(8),
            child: Image.file(
              _capturedImages[index],
              width: 80,
              height: 80,
              fit: BoxFit.cover,
            ),
          ),
          // ì²« ë²ˆì§¸ í‘œì‹œ
          if (index == 0)
            Positioned(
              top: 4,
              left: 4,
              child: Container(
                padding: const EdgeInsets.symmetric(
                  horizontal: 6,
                  vertical: 2,
                ),
                decoration: BoxDecoration(
                  color: Theme.of(context).primaryColor,
                  borderRadius: BorderRadius.circular(4),
                ),
                child: const Text(
                  'ìŒì‹',
                  style: TextStyle(
                    color: Colors.white,
                    fontSize: 10,
                    fontWeight: FontWeight.bold,
                  ),
                ),
              ),
            ),
          // ì‚­ì œ ë²„íŠ¼
          Positioned(
            top: 0,
            right: 0,
            child: GestureDetector(
              onTap: () => _removeImage(index),
              child: Container(
                padding: const EdgeInsets.all(4),
                decoration: const BoxDecoration(
                  color: Colors.red,
                  shape: BoxShape.circle,
                ),
                child: const Icon(
                  Icons.close,
                  color: Colors.white,
                  size: 12,
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildAddPhotoButton() {
    return GestureDetector(
      onTap: _takePicture,
      child: Container(
        width: 80,
        height: 80,
        margin: const EdgeInsets.only(right: 8),
        decoration: BoxDecoration(
          color: Colors.white.withOpacity(0.2),
          borderRadius: BorderRadius.circular(8),
          border: Border.all(
            color: Colors.white.withOpacity(0.5),
            width: 2,
            style: BorderStyle.solid,
          ),
        ),
        child: const Icon(
          Icons.add,
          color: Colors.white,
          size: 32,
        ),
      ),
    );
  }
  
  Future<void> _takePicture() async {
    if (_controller == null || _isProcessing) return;
    if (_capturedImages.length >= 5) return;
    
    setState(() {
      _isProcessing = true;
    });
    
    try {
      final image = await _controller!.takePicture();
      final file = File(image.path);
      
      // ì²« ë²ˆì§¸ ì‚¬ì§„ì¸ ê²½ìš° ìŒì‹ ê²€ì¦
      if (_capturedImages.isEmpty) {
        final validation = await FoodImageValidator.validateFoodImage(file);
        
        if (!validation.isValid) {
          _showError('ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŒì‹ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”.');
          setState(() {
            _isProcessing = false;
          });
          return;
        }
      }
      
      setState(() {
        _capturedImages.add(file);
        _isProcessing = false;
      });
      
      // 5ì¥ ì°ìœ¼ë©´ ìë™ ì™„ë£Œ
      if (_capturedImages.length >= 5) {
        _complete();
      }
    } catch (e) {
      _showError('ì‚¬ì§„ ì´¬ì˜ ì‹¤íŒ¨: $e');
      setState(() {
        _isProcessing = false;
      });
    }
  }
  
  Future<void> _pickFromGallery() async {
    final picker = ImagePicker();
    
    if (_capturedImages.isEmpty) {
      // ì²« ë²ˆì§¸ ì‚¬ì§„
      final image = await picker.pickImage(source: ImageSource.gallery);
      if (image != null) {
        final file = File(image.path);
        
        // ìŒì‹ ê²€ì¦
        final validation = await FoodImageValidator.validateFoodImage(file);
        if (!validation.isValid) {
          _showError('ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŒì‹ ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        setState(() {
          _capturedImages.add(file);
        });
      }
    } else {
      // ì—¬ëŸ¬ ì¥ ì„ íƒ
      final images = await picker.pickMultiImage();
      final remainingSlots = 5 - _capturedImages.length;
      
      for (int i = 0; i < images.length && i < remainingSlots; i++) {
        setState(() {
          _capturedImages.add(File(images[i].path));
        });
      }
    }
  }
  
  void _removeImage(int index) {
    setState(() {
      _capturedImages.removeAt(index);
    });
  }
  
  void _complete() {
    if (_capturedImages.isEmpty) {
      _showError('ìµœì†Œ 1ì¥ì˜ ì‚¬ì§„ì´ í•„ìš”í•©ë‹ˆë‹¤');
      return;
    }
    
    widget.onImagesSelected(_capturedImages);
  }
  
  void _showError(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
  
  @override
  void dispose() {
    _controller?.dispose();
    super.dispose();
  }
}
```

## 8. ë‚˜ì¤‘ì— ì˜ìˆ˜ì¦ ì¶”ê°€

### [í•„ìˆ˜] ì˜ìˆ˜ì¦ ì¶”ê°€ ê¸°ëŠ¥
```dart
// íŒŒì¼: lib/features/feed/widgets/receipt_addition_widget.dart
import 'package:flutter/material.dart';
import 'dart:io';

class ReceiptAdditionWidget extends StatefulWidget {
  final String feedId;
  final DateTime createdAt;
  final VoidCallback onAdded;
  
  const ReceiptAdditionWidget({
    Key? key,
    required this.feedId,
    required this.createdAt,
    required this.onAdded,
  }) : super(key: key);
  
  @override
  _ReceiptAdditionWidgetState createState() => _ReceiptAdditionWidgetState();
}

class _ReceiptAdditionWidgetState extends State<ReceiptAdditionWidget> {
  bool _canAddReceipt = false;
  Duration? _remainingTime;
  Timer? _timer;
  
  @override
  void initState() {
    super.initState();
    _checkReceiptEligibility();
    _startTimer();
  }
  
  void _checkReceiptEligibility() {
    final now = DateTime.now();
    final difference = now.difference(widget.createdAt);
    
    // 24ì‹œê°„ ì´ë‚´ì¸ì§€ í™•ì¸
    if (difference.inHours < 24) {
      setState(() {
        _canAddReceipt = true;
        _remainingTime = const Duration(hours: 24) - difference;
      });
    }
  }
  
  void _startTimer() {
    _timer = Timer.periodic(const Duration(minutes: 1), (timer) {
      _checkReceiptEligibility();
      
      if (!_canAddReceipt) {
        timer.cancel();
      }
    });
  }
  
  @override
  Widget build(BuildContext context) {
    if (!_canAddReceipt) {
      return const SizedBox.shrink();
    }
    
    return Container(
      margin: const EdgeInsets.all(16),
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: Colors.blue[50],
        borderRadius: BorderRadius.circular(12),
        border: Border.all(
          color: Colors.blue[200]!,
        ),
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Row(
            children: [
              Icon(
                Icons.receipt_long,
                color: Colors.blue[700],
                size: 24,
              ),
              const SizedBox(width: 8),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'ì˜ìˆ˜ì¦ì„ ì¶”ê°€í•˜ë©´ +5Pë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”!',
                      style: TextStyle(
                        color: Colors.blue[700],
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    if (_remainingTime != null)
                      Text(
                        'ë‚¨ì€ ì‹œê°„: ${_formatDuration(_remainingTime!)}',
                        style: TextStyle(
                          color: Colors.blue[600],
                          fontSize: 12,
                        ),
                      ),
                  ],
                ),
              ),
            ],
          ),
          const SizedBox(height: 12),
          SizedBox(
            width: double.infinity,
            child: ElevatedButton.icon(
              onPressed: _addReceipt,
              icon: const Icon(Icons.camera_alt),
              label: const Text('ì˜ìˆ˜ì¦ ì´¬ì˜í•˜ê¸°'),
              style: ElevatedButton.styleFrom(
                backgroundColor: Colors.blue[700],
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(8),
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  String _formatDuration(Duration duration) {
    final hours = duration.inHours;
    final minutes = duration.inMinutes % 60;
    
    if (hours > 0) {
      return '$hoursì‹œê°„ ${minutes}ë¶„';
    } else {
      return '$minutesë¶„';
    }
  }
  
  void _addReceipt() {
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      backgroundColor: Colors.transparent,
      builder: (context) => ReceiptCaptureModal(
        feedId: widget.feedId,
        onSuccess: () {
          Navigator.pop(context);
          widget.onAdded();
          _showSuccessMessage();
        },
      ),
    );
  }
  
  void _showSuccessMessage() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            const Icon(
              Icons.check_circle,
              color: Colors.green,
              size: 64,
            ),
            const SizedBox(height: 16),
            const Text(
              'ì˜ìˆ˜ì¦ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!',
              style: TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
              ),
            ),
            const SizedBox(height: 8),
            Container(
              padding: const EdgeInsets.symmetric(
                horizontal: 16,
                vertical: 8,
              ),
              decoration: BoxDecoration(
                color: Theme.of(context).primaryColor.withOpacity(0.1),
                borderRadius: BorderRadius.circular(20),
              ),
              child: Text(
                '+5P íšë“!',
                style: TextStyle(
                  color: Theme.of(context).primaryColor,
                  fontWeight: FontWeight.bold,
                ),
              ),
            ),
          ],
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('í™•ì¸'),
          ),
        ],
      ),
    );
  }
  
  @override
  void dispose() {
    _timer?.cancel();
    super.dispose();
  }
}
```

### [í•„ìˆ˜] ì˜ìˆ˜ì¦ ìº¡ì²˜ ëª¨ë‹¬
```dart
// íŒŒì¼: lib/features/feed/modals/receipt_capture_modal.dart
class ReceiptCaptureModal extends StatefulWidget {
  final String feedId;
  final VoidCallback onSuccess;
  
  const ReceiptCaptureModal({
    Key? key,
    required this.feedId,
    required this.onSuccess,
  }) : super(key: key);
  
  @override
  _ReceiptCaptureModalState createState() => _ReceiptCaptureModalState();
}

class _ReceiptCaptureModalState extends State<ReceiptCaptureModal> {
  File? _receiptImage;
  bool _isProcessing = false;
  Map<String, dynamic>? _ocrResult;
  
  @override
  Widget build(BuildContext context) {
    return Container(
      height: MediaQuery.of(context).size.height * 0.9,
      decoration: const BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.vertical(
          top: Radius.circular(20),
        ),
      ),
      child: Column(
        children: [
          // í—¤ë”
          Container(
            padding: const EdgeInsets.all(16),
            child: Row(
              children: [
                IconButton(
                  onPressed: () => Navigator.pop(context),
                  icon: const Icon(Icons.close),
                ),
                const Expanded(
                  child: Text(
                    'ì˜ìˆ˜ì¦ ì¶”ê°€',
                    textAlign: TextAlign.center,
                    style: TextStyle(
                      fontSize: 18,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                ),
                const SizedBox(width: 48),
              ],
            ),
          ),
          
          // ì½˜í…ì¸ 
          Expanded(
            child: SingleChildScrollView(
              padding: const EdgeInsets.all(24),
              child: Column(
                children: [
                  // ì•ˆë‚´ ë¬¸êµ¬
                  Container(
                    padding: const EdgeInsets.all(16),
                    decoration: BoxDecoration(
                      color: Colors.amber[50],
                      borderRadius: BorderRadius.circular(8),
                    ),
                    child: Row(
                      children: [
                        Icon(
                          Icons.info_outline,
                          color: Colors.amber[700],
                        ),
                        const SizedBox(width: 12),
                        Expanded(
                          child: Text(
                            'ì˜ìˆ˜ì¦ì„ ì´¬ì˜í•˜ë©´ ì í¬ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì¸ì‹ë˜ê³ \nìœ„ì¹˜ ì •í™•ë„ê°€ í–¥ìƒë©ë‹ˆë‹¤.',
                            style: TextStyle(
                              color: Colors.amber[700],
                              fontSize: 14,
                            ),
                          ),
                        ),
                      ],
                    ),
                  ),
                  const SizedBox(height: 24),
                  
                  // ì˜ìˆ˜ì¦ ì´¬ì˜/ë¯¸ë¦¬ë³´ê¸°
                  if (_receiptImage == null)
                    GestureDetector(
                      onTap: _captureReceipt,
                      child: Container(
                        height: 300,
                        width: double.infinity,
                        decoration: BoxDecoration(
                          color: Colors.grey[100],
                          borderRadius: BorderRadius.circular(12),
                          border: Border.all(
                            color: Colors.grey[300]!,
                            width: 2,
                            style: BorderStyle.solid,
                          ),
                        ),
                        child: Column(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            Icon(
                              Icons.receipt_long,
                              size: 64,
                              color: Colors.grey[400],
                            ),
                            const SizedBox(height: 16),
                            Text(
                              'ì˜ìˆ˜ì¦ ì´¬ì˜í•˜ê¸°',
                              style: TextStyle(
                                fontSize: 18,
                                color: Colors.grey[600],
                              ),
                            ),
                            const SizedBox(height: 8),
                            Text(
                              'íƒ­í•˜ì—¬ ì¹´ë©”ë¼ ì—´ê¸°',
                              style: TextStyle(
                                fontSize: 14,
                                color: Colors.grey[500],
                              ),
                            ),
                          ],
                        ),
                      ),
                    )
                  else ...[
                    // ì˜ìˆ˜ì¦ ì´ë¯¸ì§€
                    ClipRRect(
                      borderRadius: BorderRadius.circular(12),
                      child: Image.file(
                        _receiptImage!,
                        height: 300,
                        width: double.infinity,
                        fit: BoxFit.cover,
                      ),
                    ),
                    const SizedBox(height: 16),
                    
                    // ì¬ì´¬ì˜ ë²„íŠ¼
                    TextButton.icon(
                      onPressed: _captureReceipt,
                      icon: const Icon(Icons.refresh),
                      label: const Text('ë‹¤ì‹œ ì´¬ì˜'),
                    ),
                  ],
                  
                  // OCR ê²°ê³¼
                  if (_ocrResult != null) ...[
                    const SizedBox(height: 24),
                    Container(
                      width: double.infinity,
                      padding: const EdgeInsets.all(16),
                      decoration: BoxDecoration(
                        color: Colors.green[50],
                        borderRadius: BorderRadius.circular(8),
                        border: Border.all(
                          color: Colors.green[200]!,
                        ),
                      ),
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Row(
                            children: [
                              Icon(
                                Icons.check_circle,
                                color: Colors.green[700],
                                size: 20,
                              ),
                              const SizedBox(width: 8),
                              Text(
                                'ì˜ìˆ˜ì¦ ì¸ì‹ ì™„ë£Œ',
                                style: TextStyle(
                                  color: Colors.green[700],
                                  fontWeight: FontWeight.bold,
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: 12),
                          _buildOcrResultItem(
                            'ì í¬ëª…',
                            _ocrResult!['storeName'] ?? 'ì¸ì‹ ì‹¤íŒ¨',
                          ),
                          _buildOcrResultItem(
                            'ì£¼ì†Œ',
                            _ocrResult!['address'] ?? 'ì¸ì‹ ì‹¤íŒ¨',
                          ),
                          _buildOcrResultItem(
                            'ë‚ ì§œ',
                            _ocrResult!['date'] ?? 'ì¸ì‹ ì‹¤íŒ¨',
                          ),
                          _buildOcrResultItem(
                            'ê¸ˆì•¡',
                            _ocrResult!['amount'] ?? 'ì¸ì‹ ì‹¤íŒ¨',
                          ),
                        ],
                      ),
                    ),
                  ],
                  
                  // ì²˜ë¦¬ ì¤‘
                  if (_isProcessing)
                    Container(
                      height: 200,
                      child: const Center(
                        child: Column(
                          mainAxisAlignment: MainAxisAlignment.center,
                          children: [
                            CircularProgressIndicator(),
                            SizedBox(height: 16),
                            Text('ì˜ìˆ˜ì¦ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...'),
                          ],
                        ),
                      ),
                    ),
                ],
              ),
            ),
          ),
          
          // í•˜ë‹¨ ë²„íŠ¼
          Container(
            padding: const EdgeInsets.all(16),
            decoration: BoxDecoration(
              color: Colors.white,
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(0.1),
                  blurRadius: 10,
                  offset: const Offset(0, -5),
                ),
              ],
            ),
            child: SafeArea(
              child: SizedBox(
                width: double.infinity,
                child: ElevatedButton(
                  onPressed: (_receiptImage != null && 
                            _ocrResult != null && 
                            !_isProcessing)
                      ? _submitReceipt
                      : null,
                  style: ElevatedButton.styleFrom(
                    minimumSize: const Size(0, 56),
                    shape: RoundedRectangleBorder(
                      borderRadius: BorderRadius.circular(12),
                    ),
                  ),
                  child: const Text(
                    'ì˜ìˆ˜ì¦ ì¶”ê°€í•˜ê¸°',
                    style: TextStyle(
                      fontSize: 16,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildOcrResultItem(String label, String value) {
    return Padding(
      padding: const EdgeInsets.only(bottom: 8),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          SizedBox(
            width: 60,
            child: Text(
              label,
              style: TextStyle(
                fontSize: 14,
                color: Colors.grey[600],
              ),
            ),
          ),
          const SizedBox(width: 8),
          Expanded(
            child: Text(
              value,
              style: const TextStyle(
                fontSize: 14,
                fontWeight: FontWeight.w500,
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  Future<void> _captureReceipt() async {
    // ì¹´ë©”ë¼ ë˜ëŠ” ê°¤ëŸ¬ë¦¬ ì„ íƒ
    final source = await showModalBottomSheet<ImageSource>(
      context: context,
      builder: (context) => Container(
        padding: const EdgeInsets.all(16),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ListTile(
              leading: const Icon(Icons.camera_alt),
              title: const Text('ì¹´ë©”ë¼ë¡œ ì´¬ì˜'),
              onTap: () => Navigator.pop(context, ImageSource.camera),
            ),
            ListTile(
              leading: const Icon(Icons.photo_library),
              title: const Text('ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ'),
              onTap: () => Navigator.pop(context, ImageSource.gallery),
            ),
          ],
        ),
      ),
    );
    
    if (source == null) return;
    
    final picker = ImagePicker();
    final image = await picker.pickImage(source: source);
    
    if (image != null) {
      setState(() {
        _receiptImage = File(image.path);
        _isProcessing = true;
        _ocrResult = null;
      });
      
      // OCR ì²˜ë¦¬
      await _processOcr();
    }
  }
  
  Future<void> _processOcr() async {
    try {
      // Mock OCR ì²˜ë¦¬
      await Future.delayed(const Duration(seconds: 2));
      
      setState(() {
        _ocrResult = {
          'storeName': 'ë§›ìˆëŠ” ê¹€ì¹˜ì°Œê°œ',
          'address': 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
          'date': '2025-01-15 12:30',
          'amount': '8,000ì›',
        };
        _isProcessing = false;
      });
    } catch (e) {
      setState(() {
        _isProcessing = false;
      });
      _showError('ì˜ìˆ˜ì¦ ì¸ì‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    }
  }
  
  Future<void> _submitReceipt() async {
    setState(() {
      _isProcessing = true;
    });
    
    try {
      // API í˜¸ì¶œ (Mock)
      await Future.delayed(const Duration(seconds: 1));
      
      // ì„±ê³µ
      widget.onSuccess();
    } catch (e) {
      _showError('ì˜ìˆ˜ì¦ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
    } finally {
      setState(() {
        _isProcessing = false;
      });
    }
  }
  
  void _showError(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
}
```

## 9. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ë° ì´¬ì˜ ì„±ê³µ
- [ ] ì‹¤ì‹œê°„ ìŒì‹ ì¸ì‹ ì˜¤ë²„ë ˆì´ í‘œì‹œ
- [ ] ì²« ë²ˆì§¸ ì‚¬ì§„ ìŒì‹ ê²€ì¦
- [ ] ë©€í‹° ì‚¬ì§„ ì´¬ì˜ (ìµœëŒ€ 5ì¥)
- [ ] ì‚¬ì§„ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥
- [ ] ì´ë¯¸ì§€ ì••ì¶• ë° ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ
- [ ] ìœ„ì¹˜ í™•ì¸ ë° ì˜ìˆ˜ì¦ OCR
- [ ] ì •ë³´ ì…ë ¥ ë° ìœ íš¨ì„± ê²€ì¦
- [ ] í¬ì¸íŠ¸ íšë“ ë° ì™„ë£Œ ì• ë‹ˆë©”ì´ì…˜
- [ ] 24ì‹œê°„ ë‚´ ì˜ìˆ˜ì¦ ì¶”ê°€ ê°€ëŠ¥
- [ ] ì˜ìˆ˜ì¦ ì¶”ê°€ ì‹œ ì¶”ê°€ í¬ì¸íŠ¸

### ğŸ§ª í†µí•© í…ŒìŠ¤íŠ¸
```dart
// íŒŒì¼: test/feed_creation/feed_creation_flow_test.dart
void main() {
  group('í”¼ë“œ ë“±ë¡ í”Œë¡œìš° í…ŒìŠ¤íŠ¸', () {
    testWidgets('ë©€í‹° ì‚¬ì§„ ë“±ë¡ í…ŒìŠ¤íŠ¸', (tester) async {
      await tester.pumpWidget(TestApp(
        child: FeedCreationFlow(),
      ));
      
      // 1. ì²« ë²ˆì§¸ ì‚¬ì§„ (ìŒì‹ í•„ìˆ˜)
      expect(find.text('ì²« ë²ˆì§¸ ì‚¬ì§„ì€ ë°˜ë“œì‹œ ìŒì‹ ì‚¬ì§„ì´ì–´ì•¼ í•´ìš”'), findsOneWidget);
      
      // ìŒì‹ ì‚¬ì§„ ì´¬ì˜
      await tester.tap(find.byIcon(Icons.camera));
      await tester.pumpAndSettle();
      
      // 2. ì¶”ê°€ ì‚¬ì§„ ì´¬ì˜
      expect(find.text('1/5'), findsOneWidget);
      
      // ë‘ ë²ˆì§¸ ì‚¬ì§„
      await tester.tap(find.byIcon(Icons.add));
      await tester.pumpAndSettle();
      
      expect(find.text('2/5'), findsOneWidget);
      
      // ì™„ë£Œ ë²„íŠ¼
      await tester.tap(find.byIcon(Icons.check));
      await tester.pumpAndSettle();
      
      // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
      expect(find.text('ìŒì‹ ì¸ì‹'), findsOneWidget);
    });
    
    testWidgets('ì˜ìˆ˜ì¦ ì¶”ê°€ í…ŒìŠ¤íŠ¸', (tester) async {
      // í”¼ë“œ ìƒì„¸ í™”ë©´
      await tester.pumpWidget(TestApp(
        child: FeedDetailScreen(
          feedId: 'test_feed',
          createdAt: DateTime.now(),
        ),
      ));
      
      // ì˜ìˆ˜ì¦ ì¶”ê°€ ìœ„ì ¯ í‘œì‹œ
      expect(find.text('ì˜ìˆ˜ì¦ì„ ì¶”ê°€í•˜ë©´ +5Pë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”!'), findsOneWidget);
      
      // ì˜ìˆ˜ì¦ ì´¬ì˜ ë²„íŠ¼
      await tester.tap(find.text('ì˜ìˆ˜ì¦ ì´¬ì˜í•˜ê¸°'));
      await tester.pumpAndSettle();
      
      // ì˜ìˆ˜ì¦ ìº¡ì²˜ ëª¨ë‹¬
      expect(find.text('ì˜ìˆ˜ì¦ ì¶”ê°€'), findsOneWidget);
    });
    
    testWidgets('ìŒì‹ ë¯¸ê°ì§€ ì‹œ ì—ëŸ¬', (tester) async {
      // Mock ìŒì‹ ë¯¸ê°ì§€
      when(mockFoodValidator.validateFoodImage(any))
          .thenAnswer((_) async => FoodValidationResult(
            isValid: false,
            confidence: 0.3,
            message: 'ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤',
          ));
      
      await tester.pumpWidget(TestApp(
        child: MultiPhotoCameraStep(
          onImagesSelected: (_) {},
        ),
      ));
      
      // ì´¬ì˜ ì‹œë„
      await tester.tap(find.byIcon(Icons.camera));
      await tester.pumpAndSettle();
      
      // ì—ëŸ¬ ë©”ì‹œì§€
      expect(find.text('ìŒì‹ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŒì‹ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”.'), findsOneWidget);
    });
  });
}
```