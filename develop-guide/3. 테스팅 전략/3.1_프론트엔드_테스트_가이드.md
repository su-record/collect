# ğŸ§ª 3.1 í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ë‹¨ìœ„ í…ŒìŠ¤íŠ¸](#2-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸)
3. [ìœ„ì ¯ í…ŒìŠ¤íŠ¸](#3-ìœ„ì ¯-í…ŒìŠ¤íŠ¸)
4. [í†µí•© í…ŒìŠ¤íŠ¸](#4-í†µí•©-í…ŒìŠ¤íŠ¸)
5. [ê²€ì¦](#5-ê²€ì¦)

## 1. ê°œìš”

Flutter ì•±ì˜ í’ˆì§ˆì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ì²´ê³„ì ì¸ í…ŒìŠ¤íŠ¸ ì „ëµì„ ì œê³µí•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸

- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ë¡œì§ ê²€ì¦
- âœ… ìœ„ì ¯ í…ŒìŠ¤íŠ¸ë¡œ UI ê²€ì¦
- âœ… í†µí•© í…ŒìŠ¤íŠ¸ë¡œ E2E ê²€ì¦

### [í•„ìˆ˜] í…ŒìŠ¤íŠ¸ êµ¬ì¡°

```
test/
â”œâ”€â”€ unit/               # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ widget/             # ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ screens/
â”‚   â””â”€â”€ widgets/
â””â”€â”€ integration/        # í†µí•© í…ŒìŠ¤íŠ¸
    â””â”€â”€ scenarios/
```

## 2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### [í•„ìˆ˜] ëª¨ë¸ í…ŒìŠ¤íŠ¸

```dart
// íŒŒì¼: test/unit/models/user_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:fallingo_app/data/models/user.dart';

void main() {
  group('UserModel', () {
    test('fromJson ì •ìƒ ë™ì‘', () {
      // Given
      final json = {
        'id': 'user123',
        'email': 'test@test.com',
        'nickname': 'í…ŒìŠ¤í„°',
        'grade': 'bibimbap',
        'activityPoints': 100,
        'createdAt': '2024-01-01T00:00:00Z',
        'isInfluencer': false,
      };

      // When
      final user = UserModel.fromJson(json);

      // Then
      expect(user.id, 'user123');
      expect(user.email, 'test@test.com');
      expect(user.grade, UserGrade.bibimbap);
    });

    test('toJson ì •ìƒ ë™ì‘', () {
      // Given
      final user = UserModel(
        id: 'user123',
        email: 'test@test.com',
        nickname: 'í…ŒìŠ¤í„°',
        grade: UserGrade.bibimbap,
        activityPoints: 100,
        createdAt: DateTime.parse('2024-01-01T00:00:00Z'),
      );

      // When
      final json = user.toJson();

      // Then
      expect(json['id'], 'user123');
      expect(json['grade'], 'bibimbap');
    });
  });
}
```

### [í•„ìˆ˜] ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

```dart
// íŒŒì¼: test/unit/services/api_service_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:dio/dio.dart';

class MockDio extends Mock implements Dio {}

void main() {
  late MockDio mockDio;
  late ApiService apiService;

  setUp(() {
    mockDio = MockDio();
    apiService = ApiService(dio: mockDio);
  });

  group('ApiService', () {
    test('ë¡œê·¸ì¸ ì„±ê³µ', () async {
      // Given
      when(mockDio.post(
        any,
        data: anyNamed('data'),
      )).thenAnswer((_) async => Response(
        data: {
          'status': 'success',
          'data': {
            'accessToken': 'test_token',
            'user': {'id': 'user123'}
          }
        },
        statusCode: 200,
        requestOptions: RequestOptions(path: ''),
      ));

      // When
      final result = await apiService.login('google', 'id_token');

      // Then
      expect(result.accessToken, 'test_token');
      expect(result.user.id, 'user123');
    });

    test('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì²˜ë¦¬', () async {
      // Given
      when(mockDio.post(any, data: anyNamed('data')))
          .thenThrow(DioException(
        type: DioExceptionType.connectionTimeout,
        requestOptions: RequestOptions(path: ''),
      ));

      // When & Then
      expect(
        () => apiService.login('google', 'id_token'),
        throwsA(isA<NetworkException>()),
      );
    });
  });
}
```

## 3. ìœ„ì ¯ í…ŒìŠ¤íŠ¸

### [í•„ìˆ˜] í™”ë©´ í…ŒìŠ¤íŠ¸

```dart
// íŒŒì¼: test/widget/screens/login_screen_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:fallingo_app/features/auth/screens/login_screen.dart';

void main() {
  group('LoginScreen', () {
    testWidgets('ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ', (tester) async {
      // Given & When
      await tester.pumpWidget(
        MaterialApp(
          home: LoginScreen(),
        ),
      );

      // Then
      expect(find.text('Googleë¡œ ì‹œì‘í•˜ê¸°'), findsOneWidget);
      expect(find.text('Appleë¡œ ì‹œì‘í•˜ê¸°'), findsOneWidget);
    });

    testWidgets('ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­', (tester) async {
      // Given
      bool googleLoginCalled = false;

      await tester.pumpWidget(
        MaterialApp(
          home: LoginScreen(
            onGoogleLogin: () => googleLoginCalled = true,
          ),
        ),
      );

      // When
      await tester.tap(find.text('Googleë¡œ ì‹œì‘í•˜ê¸°'));
      await tester.pump();

      // Then
      expect(googleLoginCalled, true);
    });
  });
}
```

### [í•„ìˆ˜] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸

```dart
// íŒŒì¼: test/widget/widgets/feed_card_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:network_image_mock/network_image_mock.dart';

void main() {
  group('FeedCard', () {
    final mockFeed = FeedModel(
      id: 'feed1',
      userId: 'user1',
      restaurantId: 'rest1',
      menuId: 'menu1',
      imageUrls: ['https://test.com/image.jpg'],
      content: 'ë§›ìˆì–´ìš”!',
      tags: ['ë§¤ìš´ë§›'],
      location: LocationInfo(
        latitude: 37.5,
        longitude: 127.0,
        timestamp: DateTime.now(),
      ),
      isVerified: true,
      createdAt: DateTime.now(),
    );

    testWidgets('í”¼ë“œ ì •ë³´ í‘œì‹œ', (tester) async {
      // Network ì´ë¯¸ì§€ Mock
      await mockNetworkImagesFor(() async {
        // Given & When
        await tester.pumpWidget(
          MaterialApp(
            home: Scaffold(
              body: FeedCard(feed: mockFeed),
            ),
          ),
        );

        // Then
        expect(find.text('ë§›ìˆì–´ìš”!'), findsOneWidget);
        expect(find.text('#ë§¤ìš´ë§›'), findsOneWidget);
        expect(find.byIcon(Icons.verified), findsOneWidget);
      });
    });
  });
}
```

## 4. í†µí•© í…ŒìŠ¤íŠ¸

### [í•„ìˆ˜] E2E ì‹œë‚˜ë¦¬ì˜¤

```dart
// íŒŒì¼: test/integration/scenarios/feed_creation_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:fallingo_app/main.dart' as app;

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('í”¼ë“œ ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤', () {
    testWidgets('ì „ì²´ í”¼ë“œ ë“±ë¡ í”„ë¡œì„¸ìŠ¤', (tester) async {
      // Given
      app.main();
      await tester.pumpAndSettle();

      // ë¡œê·¸ì¸
      await tester.tap(find.text('Googleë¡œ ì‹œì‘í•˜ê¸°'));
      await tester.pumpAndSettle();

      // í”¼ë“œ ë“±ë¡ ë²„íŠ¼ í´ë¦­
      await tester.tap(find.byIcon(Icons.add));
      await tester.pumpAndSettle();

      // ì¹´ë©”ë¼ í™”ë©´ ëŒ€ê¸°
      expect(find.text('ìŒì‹ì„ ì´¬ì˜í•´ì£¼ì„¸ìš”'), findsOneWidget);

      // ì´¬ì˜ ë²„íŠ¼ í´ë¦­ (Mock)
      await tester.tap(find.byKey(Key('camera_capture_button')));
      await tester.pumpAndSettle();

      // ë‚´ìš© ì…ë ¥
      await tester.enterText(
        find.byKey(Key('content_input')),
        'ì •ë§ ë§›ìˆëŠ” ê¹€ì¹˜ì°Œê°œì…ë‹ˆë‹¤!',
      );

      // íƒœê·¸ ì„ íƒ
      await tester.tap(find.text('ë§¤ìš´ë§›'));
      await tester.tap(find.text('ê°€ì„±ë¹„'));

      // ë“±ë¡ ë²„íŠ¼ í´ë¦­
      await tester.tap(find.text('ë“±ë¡'));
      await tester.pumpAndSettle();

      // ì„±ê³µ í™•ì¸
      expect(find.text('í”¼ë“œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤'), findsOneWidget);
    });
  });
}
```

### [í•„ìˆ˜] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„¤ì •

```yaml
# íŒŒì¼: integration_test/app_test.dart
import 'package:integration_test/integration_test.dart';
import 'scenarios/feed_creation_test.dart' as feed_creation;
import 'scenarios/user_profile_test.dart' as user_profile;

void main() {
IntegrationTestWidgetsFlutterBinding.ensureInitialized();

// ì‹œë‚˜ë¦¬ì˜¤ë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
feed_creation.main();
user_profile.main();
}
```

## 5. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ëª¨ë“  ëª¨ë¸ì— ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¡´ì¬
- [ ] í•µì‹¬ ì„œë¹„ìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] ì£¼ìš” í™”ë©´ ìœ„ì ¯ í…ŒìŠ¤íŠ¸
- [ ] E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
flutter test test/unit/

# ìœ„ì ¯ í…ŒìŠ¤íŠ¸
flutter test test/widget/

# í†µí•© í…ŒìŠ¤íŠ¸
flutter test integration_test/

# ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
flutter test --coverage
lcov --remove coverage/lcov.info 'lib/generated/*' -o coverage/lcov.info
genhtml coverage/lcov.info -o coverage/html
```

### í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: 80% ì´ìƒ
- ìœ„ì ¯ í…ŒìŠ¤íŠ¸: 60% ì´ìƒ
- í†µí•© í…ŒìŠ¤íŠ¸: í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤ 100%
