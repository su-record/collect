# ğŸ”§ 5.1 Flask í”„ë¡œì íŠ¸ ì´ˆê¸°ì„¤ì •

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±](#2-í”„ë¡œì íŠ¸-êµ¬ì¡°-ìƒì„±)
3. [ê¸°ë³¸ ì„¤ì •](#3-ê¸°ë³¸-ì„¤ì •)
4. [ê²€ì¦](#4-ê²€ì¦)

## 1. ê°œìš”
Fallingo ë°±ì—”ë“œ ì„œë²„ë¥¼ Flaskë¡œ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì´ˆê¸° í”„ë¡œì íŠ¸ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… Flask í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
- âœ… í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
- âœ… í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬

## 2. í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±

### [í•„ìˆ˜] ë””ë ‰í† ë¦¬ êµ¬ì¡°
```bash
fallingo-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ routes.py
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ routes.py
â”‚   â”‚   â”œâ”€â”€ feeds/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ routes.py
â”‚   â”‚   â””â”€â”€ common/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ utils.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â””â”€â”€ feed.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ mock_data.py
â”‚   â”‚   â””â”€â”€ image_service.py
â”‚   â””â”€â”€ config.py
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â””â”€â”€ run.py
```

### [í•„ìˆ˜] requirements.txt
```txt
# íŒŒì¼: requirements.txt
# Flask í•µì‹¬
Flask==3.0.0
Flask-CORS==4.0.0
Flask-RESTful==0.3.10

# í™˜ê²½ ë³€ìˆ˜
python-dotenv==1.0.0

# ë°ì´í„° ê²€ì¦
marshmallow==3.20.1

# ì´ë¯¸ì§€ ì²˜ë¦¬
Pillow==10.1.0

# ìœ í‹¸ë¦¬í‹°
requests==2.31.0
python-dateutil==2.8.2

# ê°œë°œ ë„êµ¬
flask-debugtoolbar==0.13.1

# í…ŒìŠ¤íŠ¸
pytest==7.4.3
pytest-flask==1.3.0
```

### [í•„ìˆ˜] .env.example
```bash
# íŒŒì¼: .env.example
# Flask ì„¤ì •
FLASK_APP=run.py
FLASK_ENV=development
FLASK_DEBUG=True
SECRET_KEY=your-secret-key-here

# API ì„¤ì •
API_HOST=0.0.0.0
API_PORT=5000

# ì™¸ë¶€ API í‚¤ (ì‹¤ì œ ê°’ì€ .envì— ì„¤ì •)
GOOGLE_MAPS_API_KEY=
OPEN_METEO_API_KEY=
CLOUD_VISION_API_KEY=

# íŒŒì¼ ì—…ë¡œë“œ
UPLOAD_FOLDER=uploads
MAX_CONTENT_LENGTH=16777216  # 16MB
```

### [í•„ìˆ˜] .gitignore
```gitignore
# íŒŒì¼: .gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/

# Flask
instance/
.webassets-cache

# í™˜ê²½ ì„¤ì •
.env
.env.local

# ì—…ë¡œë“œ íŒŒì¼
uploads/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# ë¡œê·¸
*.log
```

## 3. ê¸°ë³¸ ì„¤ì •

### [í•„ìˆ˜] config.py
```python
# íŒŒì¼: app/config.py
import os
from datetime import timedelta

class Config:
    """ê¸°ë³¸ ì„¤ì •"""
    # Flask
    SECRET_KEY = os.environ.get('SECRET_KEY', 'dev-secret-key')
    
    # API
    API_TITLE = 'Fallingo API'
    API_VERSION = 'v1'
    
    # CORS
    CORS_ORIGINS = ['http://localhost:3000', 'http://localhost:8080']
    
    # íŒŒì¼ ì—…ë¡œë“œ
    UPLOAD_FOLDER = os.environ.get('UPLOAD_FOLDER', 'uploads')
    MAX_CONTENT_LENGTH = int(os.environ.get('MAX_CONTENT_LENGTH', 16777216))
    ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif', 'webp'}
    
    # ì™¸ë¶€ API
    GOOGLE_MAPS_API_KEY = os.environ.get('GOOGLE_MAPS_API_KEY', '')
    OPEN_METEO_API_KEY = os.environ.get('OPEN_METEO_API_KEY', '')
    CLOUD_VISION_API_KEY = os.environ.get('CLOUD_VISION_API_KEY', '')

class LocalConfig(Config):
    """ë¡œì»¬ ê°œë°œ í™˜ê²½"""
    DEBUG = True
    TESTING = False
    ENV = 'local'
    
    # Mock ë°ì´í„° ì‚¬ìš©
    USE_MOCK_DATA = True

class ProductionConfig(Config):
    """ìš´ì˜ í™˜ê²½"""
    DEBUG = False
    TESTING = False
    ENV = 'production'
    
    # ì‹¤ì œ ì„œë¹„ìŠ¤ ì‚¬ìš©
    USE_MOCK_DATA = False

# í™˜ê²½ë³„ ì„¤ì • ë§¤í•‘
config = {
    'local': LocalConfig,
    'production': ProductionConfig,
    'default': LocalConfig
}
```

### [í•„ìˆ˜] app/__init__.py
```python
# íŒŒì¼: app/__init__.py
from flask import Flask
from flask_cors import CORS
import os

def create_app(config_name=None):
    """ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ©í† ë¦¬"""
    # Flask ì•± ìƒì„±
    app = Flask(__name__)
    
    # ì„¤ì • ë¡œë“œ
    if config_name is None:
        config_name = os.environ.get('FLASK_ENV', 'local')
    
    from .config import config
    app.config.from_object(config[config_name])
    
    # CORS ì„¤ì •
    CORS(app, origins=app.config['CORS_ORIGINS'])
    
    # ì—…ë¡œë“œ í´ë” ìƒì„±
    upload_folder = app.config['UPLOAD_FOLDER']
    if not os.path.exists(upload_folder):
        os.makedirs(upload_folder)
    
    # ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡
    from .api import register_blueprints
    register_blueprints(app)
    
    # ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡
    from .api.common.error_handlers import register_error_handlers
    register_error_handlers(app)
    
    @app.route('/health')
    def health_check():
        """í—¬ìŠ¤ ì²´í¬"""
        return {
            'status': 'healthy',
            'environment': app.config['ENV'],
            'version': app.config['API_VERSION']
        }
    
    return app
```

### [í•„ìˆ˜] api/__init__.py
```python
# íŒŒì¼: app/api/__init__.py
def register_blueprints(app):
    """ë¸”ë£¨í”„ë¦°íŠ¸ ë“±ë¡"""
    from .auth.routes import auth_bp
    from .users.routes import users_bp
    from .feeds.routes import feeds_bp
    
    # API v1 prefixë¡œ ë“±ë¡
    api_prefix = f"/api/{app.config['API_VERSION']}"
    
    app.register_blueprint(auth_bp, url_prefix=f"{api_prefix}/auth")
    app.register_blueprint(users_bp, url_prefix=f"{api_prefix}/users")
    app.register_blueprint(feeds_bp, url_prefix=f"{api_prefix}/feeds")
```

### [í•„ìˆ˜] run.py
```python
# íŒŒì¼: run.py
import os
from dotenv import load_dotenv
from app import create_app

# .env íŒŒì¼ ë¡œë“œ
load_dotenv()

# ì•± ìƒì„±
app = create_app()

if __name__ == '__main__':
    host = os.environ.get('API_HOST', '0.0.0.0')
    port = int(os.environ.get('API_PORT', 5000))
    
    print(f"ğŸš€ Fallingo API ì„œë²„ ì‹œì‘")
    print(f"ğŸ“ ì£¼ì†Œ: http://{host}:{port}")
    print(f"ğŸŒ í™˜ê²½: {app.config['ENV']}")
    print(f"ğŸ”§ ë””ë²„ê·¸: {app.config['DEBUG']}")
    
    app.run(host=host, port=port)
```

### [í•„ìˆ˜] ê³µí†µ ì—ëŸ¬ í•¸ë“¤ëŸ¬
```python
# íŒŒì¼: app/api/common/error_handlers.py
from flask import jsonify
from werkzeug.exceptions import HTTPException

def register_error_handlers(app):
    """ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡"""
    
    @app.errorhandler(HTTPException)
    def handle_http_exception(e):
        """HTTP ì˜ˆì™¸ ì²˜ë¦¬"""
        return jsonify({
            'error': {
                'code': e.code,
                'message': e.description,
                'type': e.name
            }
        }), e.code
    
    @app.errorhandler(Exception)
    def handle_exception(e):
        """ì¼ë°˜ ì˜ˆì™¸ ì²˜ë¦¬"""
        app.logger.error(f"Unhandled exception: {str(e)}")
        return jsonify({
            'error': {
                'code': 500,
                'message': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                'type': 'Internal Server Error'
            }
        }), 500
    
    @app.errorhandler(404)
    def handle_not_found(e):
        """404 ì²˜ë¦¬"""
        return jsonify({
            'error': {
                'code': 404,
                'message': 'ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                'type': 'Not Found'
            }
        }), 404
```

## 4. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ê°€ìƒí™˜ê²½ì´ ìƒì„±ë˜ê³  í™œì„±í™”ë˜ì—ˆëŠ”ê°€?
- [ ] requirements.txtì˜ ëª¨ë“  íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì—ˆëŠ”ê°€?
- [ ] .env íŒŒì¼ì´ ìƒì„±ë˜ê³  ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] Flask ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ê°€?
- [ ] /health ì—”ë“œí¬ì¸íŠ¸ê°€ ì‘ë‹µí•˜ëŠ”ê°€?

### ì„œë²„ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
```bash
# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt

# .env íŒŒì¼ ìƒì„±
cp .env.example .env

# ì„œë²„ ì‹¤í–‰
python run.py

# í—¬ìŠ¤ ì²´í¬ í…ŒìŠ¤íŠ¸
curl http://localhost:5000/health
```

### ì˜ˆìƒ ì‘ë‹µ
```json
{
  "status": "healthy",
  "environment": "local",
  "version": "v1"
}
```