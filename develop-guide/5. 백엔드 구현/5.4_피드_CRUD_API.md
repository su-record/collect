# ğŸ“¸ 5.4 í”¼ë“œ CRUD API

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [API ì—”ë“œí¬ì¸íŠ¸](#2-api-ì—”ë“œí¬ì¸íŠ¸)
3. [í”¼ë“œ ìƒì„±](#3-í”¼ë“œ-ìƒì„±)
4. [í”¼ë“œ ì¡°íšŒ](#4-í”¼ë“œ-ì¡°íšŒ)
5. [ê²€ì¦](#5-ê²€ì¦)

## 1. ê°œìš”

í”¼ë“œ ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œë¥¼ ìœ„í•œ REST APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… PostGIS ìœ„ì¹˜ ê¸°ë°˜ ì¿¼ë¦¬
- âœ… í˜„ì¥ ì¸ì¦ ê²€ì¦
- âœ… ë©€í‹° ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬

## 2. API ì—”ë“œí¬ì¸íŠ¸

### [í•„ìˆ˜] ë¼ìš°íŠ¸ ì •ì˜
```python
# íŒŒì¼: backend/routes/feed_routes.py
from flask import Blueprint, request, jsonify
from ..middleware.auth import require_auth, optional_auth
from ..services.feed_service import FeedService
from ..services.location_service import LocationService

feed_bp = Blueprint('feeds', __name__, url_prefix='/api/feeds')
feed_service = FeedService()
location_service = LocationService()

# POST /api/feeds - í”¼ë“œ ìƒì„±
@feed_bp.route('', methods=['POST'])
@require_auth
def create_feed():
    """ìƒˆ í”¼ë“œ ìƒì„± (ë©€í‹° ì´ë¯¸ì§€ ì§€ì›)"""
    try:
        data = request.get_json()
        
        # ì´ë¯¸ì§€ ê²€ì¦ (ìµœì†Œ 1ì¥, ìµœëŒ€ 5ì¥)
        image_urls = data.get('image_urls', [])
        if not image_urls:
            return jsonify({'error': 'ìµœì†Œ 1ì¥ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤'}), 400
        if len(image_urls) > 5:
            return jsonify({'error': 'ìµœëŒ€ 5ì¥ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤'}), 400
        
        # í˜„ì¬ ìœ„ì¹˜ ê²€ì¦
        user_location = location_service.validate_location(
            data.get('latitude'),
            data.get('longitude')
        )
        
        # í”¼ë“œ ìƒì„±
        feed = feed_service.create_feed(
            user_id=request.user_id,
            menu_id=data.get('menu_id'),
            content=data.get('content'),
            image_urls=image_urls,  # ë©€í‹° ì´ë¯¸ì§€ ë°°ì—´
            tags=data.get('tags', []),
            location=user_location,
            floor=data.get('floor'),  # ì¸µ ì •ë³´
            shop_name=data.get('shop_name'),  # ê°€ê²Œëª…
            verification_data=data.get('verification_data')
        )
        
        return jsonify(feed), 201
        
    except ValueError as e:
        return jsonify({'error': str(e)}), 400
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# PUT /api/feeds/<feed_id>/ocr - OCR ì¶”ê°€
@feed_bp.route('/<feed_id>/ocr', methods=['PUT'])
@require_auth
def add_ocr_to_feed(feed_id):
    """í”¼ë“œì— OCR ì •ë³´ ì¶”ê°€ (24ì‹œê°„ ë‚´)"""
    try:
        data = request.get_json()
        
        # OCR ë°ì´í„° ê²€ì¦
        ocr_text = data.get('ocr_text')
        receipt_image_url = data.get('receipt_image_url')
        
        if not ocr_text or not receipt_image_url:
            return jsonify({'error': 'OCR í…ìŠ¤íŠ¸ì™€ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤'}), 400
        
        # OCR ì •ë³´ ì¶”ê°€
        feed = feed_service.add_ocr_verification(
            feed_id=feed_id,
            user_id=request.user_id,
            ocr_text=ocr_text,
            receipt_image_url=receipt_image_url
        )
        
        return jsonify(feed), 200
        
    except ValueError as e:
        return jsonify({'error': str(e)}), 400
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# GET /api/feeds - í”¼ë“œ ëª©ë¡ ì¡°íšŒ
@feed_bp.route('', methods=['GET'])
@optional_auth
def get_feeds():
    """í”¼ë“œ ëª©ë¡ ì¡°íšŒ"""
    try:
        # ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°
        lat = float(request.args.get('lat', 0))
        lng = float(request.args.get('lng', 0))
        radius_km = float(request.args.get('radius', 1.0))
        page = int(request.args.get('page', 1))
        limit = int(request.args.get('limit', 20))
        
        feeds = feed_service.get_nearby_feeds(
            latitude=lat,
            longitude=lng,
            radius_km=radius_km,
            page=page,
            limit=limit,
            user_id=request.user_id
        )
        
        return jsonify(feeds), 200
        
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# GET /api/feeds/<feed_id> - í”¼ë“œ ìƒì„¸ ì¡°íšŒ
@feed_bp.route('/<feed_id>', methods=['GET'])
@optional_auth
def get_feed(feed_id):
    """í”¼ë“œ ìƒì„¸ ì¡°íšŒ"""
    try:
        feed = feed_service.get_feed_by_id(
            feed_id=feed_id,
            user_id=request.user_id
        )
        return jsonify(feed), 200
        
    except ValueError as e:
        return jsonify({'error': str(e)}), 404
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# PUT /api/feeds/<feed_id> - í”¼ë“œ ìˆ˜ì •
@feed_bp.route('/<feed_id>', methods=['PUT'])
@require_auth
def update_feed(feed_id):
    """í”¼ë“œ ìˆ˜ì •"""
    try:
        data = request.get_json()
        
        feed = feed_service.update_feed(
            feed_id=feed_id,
            user_id=request.user_id,
            updates=data
        )
        
        return jsonify(feed), 200
        
    except ValueError as e:
        return jsonify({'error': str(e)}), 400
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# DELETE /api/feeds/<feed_id> - í”¼ë“œ ì‚­ì œ
@feed_bp.route('/<feed_id>', methods=['DELETE'])
@require_auth
def delete_feed(feed_id):
    """í”¼ë“œ ì‚­ì œ"""
    try:
        feed_service.delete_feed(
            feed_id=feed_id,
            user_id=request.user_id
        )
        
        return jsonify({'message': 'í”¼ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'}), 200
        
    except ValueError as e:
        return jsonify({'error': str(e)}), 403
    except Exception as e:
        return jsonify({'error': str(e)}), 500
```

## 3. í”¼ë“œ ìƒì„±

### [í•„ìˆ˜] FeedService êµ¬í˜„
```python
# íŒŒì¼: backend/services/feed_service.py
from supabase import create_client
from datetime import datetime, timedelta
from typing import Dict, List, Optional
import os

class FeedService:
    def __init__(self):
        self.supabase = create_client(
            os.getenv('SUPABASE_URL'),
            os.getenv('SUPABASE_SERVICE_ROLE_KEY')
        )
    
    def create_feed(
        self,
        user_id: str,
        menu_id: str,
        content: str,
        image_urls: List[str],
        tags: List[str],
        location: Dict,
        floor: Optional[str] = None,
        shop_name: Optional[str] = None,
        verification_data: Optional[Dict] = None
    ) -> Dict:
        """í”¼ë“œ ìƒì„± (ë©€í‹° ì´ë¯¸ì§€ ì§€ì›)"""
        # ì´ë¯¸ì§€ ìˆ˜ ê²€ì¦
        if not image_urls or len(image_urls) == 0:
            raise ValueError('ìµœì†Œ 1ì¥ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤')
        if len(image_urls) > 5:
            raise ValueError('ìµœëŒ€ 5ì¥ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤')
        
        # ì¤‘ë³µ ë“±ë¡ ì²´í¬ (24ì‹œê°„ ë‚´ + ê°™ì€ ê±´ë¬¼/ì¸µ)
        self._check_duplicate_feed(user_id, menu_id, location, floor)
        
        # ë©”ë‰´ ì •ë³´ í™•ì¸
        menu_info = self._get_menu_with_store(menu_id)
        
        # í”¼ë“œ ë°ì´í„° ìƒì„±
        feed_data = {
            'user_id': user_id,
            'menu_id': menu_id,
            'store_id': menu_info['store_id'],
            'content': content,
            'image_urls': image_urls,  # ë©€í‹° ì´ë¯¸ì§€ ë°°ì—´
            'tags': tags,
            'location': f"POINT({location['longitude']} {location['latitude']})",
            'floor': floor,
            'shop_name': shop_name or menu_info.get('stores', {}).get('name'),
            'is_verified': bool(verification_data),
            'verification_data': verification_data or {},
            'ocr_status': 'none'  # ì´ˆê¸° OCR ìƒíƒœ
        }
        
        # í”¼ë“œ ì €ì¥
        response = self.supabase.table('feeds').insert(feed_data).execute()
        feed = response.data[0]
        
        # í™œë™ í¬ì¸íŠ¸ ë¶€ì—¬
        self._award_activity_points(user_id, 'feed_create')
        
        return self._enrich_feed(feed)
    
    def _check_duplicate_feed(
        self, 
        user_id: str, 
        menu_id: str,
        location: Dict,
        floor: Optional[str] = None
    ):
        """24ì‹œê°„ ë‚´ ì¤‘ë³µ ë“±ë¡ ì²´í¬ (ê°™ì€ ê±´ë¬¼/ì¸µ ê³ ë ¤)"""
        yesterday = datetime.now() - timedelta(days=1)
        
        # ê¸°ë³¸ ì¤‘ë³µ ì²´í¬
        query = self.supabase.table('feeds') \
            .select('id, floor, location') \
            .eq('user_id', user_id) \
            .eq('menu_id', menu_id) \
            .gte('created_at', yesterday.isoformat())
        
        response = query.execute()
        
        if response.data:
            # ê°™ì€ ê±´ë¬¼ì¸ì§€ í™•ì¸ (100m ì´ë‚´)
            for existing_feed in response.data:
                if self._is_same_building(
                    existing_feed['location'], 
                    location,
                    existing_feed.get('floor'),
                    floor
                ):
                    raise ValueError('24ì‹œê°„ ë‚´ì— ì´ë¯¸ ë“±ë¡í•œ ë©”ë‰´ì…ë‹ˆë‹¤')
    
    def _is_same_building(
        self,
        location1: str,
        location2: Dict,
        floor1: Optional[str],
        floor2: Optional[str]
    ) -> bool:
        """ê°™ì€ ê±´ë¬¼ì¸ì§€ í™•ì¸ (100m ì´ë‚´ + ì¸µ ì •ë³´)"""
        # PostGISë¥¼ ì‚¬ìš©í•œ ê±°ë¦¬ ê³„ì‚°
        result = self.supabase.rpc(
            'calculate_distance',
            {
                'point1': location1,
                'point2': f"POINT({location2['longitude']} {location2['latitude']})"
            }
        ).execute()
        
        distance_meters = result.data
        
        # 100m ì´ë‚´ë©´ ê°™ì€ ê±´ë¬¼ë¡œ ê°„ì£¼
        if distance_meters < 100:
            # ì¸µ ì •ë³´ê°€ ë‘˜ ë‹¤ ìˆìœ¼ë©´ ì¸µë„ í™•ì¸
            if floor1 and floor2:
                return floor1 == floor2
            return True
        
        return False
    
    def add_ocr_verification(
        self,
        feed_id: str,
        user_id: str,
        ocr_text: str,
        receipt_image_url: str
    ) -> Dict:
        """OCR ì •ë³´ ì¶”ê°€ (24ì‹œê°„ ë‚´)"""
        # í”¼ë“œ ì¡°íšŒ ë° ê¶Œí•œ í™•ì¸
        feed = self.get_feed_by_id(feed_id)
        if feed['user_id'] != user_id:
            raise ValueError('í”¼ë“œë¥¼ ìˆ˜ì •í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤')
        
        # 24ì‹œê°„ ì²´í¬
        created_at = datetime.fromisoformat(feed['created_at'])
        if datetime.now() - created_at > timedelta(hours=24):
            raise ValueError('OCRì€ ë“±ë¡ í›„ 24ì‹œê°„ ë‚´ì—ë§Œ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤')
        
        # OCR ìƒíƒœê°€ ì´ë¯¸ ì™„ë£Œì¸ì§€ í™•ì¸
        if feed.get('ocr_status') == 'completed':
            raise ValueError('ì´ë¯¸ OCRì´ ì™„ë£Œëœ í”¼ë“œì…ë‹ˆë‹¤')
        
        # OCR ë°ì´í„° ì—…ë°ì´íŠ¸
        ocr_data = {
            'ocr_text': ocr_text,
            'receipt_image_url': receipt_image_url,
            'ocr_processed_at': datetime.now().isoformat()
        }
        
        # ì—…ë°ì´íŠ¸
        response = self.supabase.table('feeds') \
            .update({
                'ocr_status': 'completed',
                'ocr_updated_at': datetime.now().isoformat(),
                'verification_data': {
                    **feed.get('verification_data', {}),
                    'ocr': ocr_data
                }
            }) \
            .eq('id', feed_id) \
            .execute()
        
        # OCR ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸
        self._award_activity_points(user_id, 'ocr_verification')
        
        return self._enrich_feed(response.data[0])
    
    def _get_menu_with_store(self, menu_id: str) -> Dict:
        """ë©”ë‰´ ë° ì í¬ ì •ë³´ ì¡°íšŒ"""
        response = self.supabase.table('menus') \
            .select('*, stores(*)') \
            .eq('id', menu_id) \
            .single() \
            .execute()
        
        if not response.data:
            raise ValueError('ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')
        
        return response.data
    
    def _award_activity_points(self, user_id: str, action: str):
        """í™œë™ í¬ì¸íŠ¸ ë¶€ì—¬"""
        points = {
            'feed_create': 10,
            'first_feed': 50,  # ìµœì´ˆ ë“±ë¡ ë³´ë„ˆìŠ¤
            'ocr_verification': 5,  # OCR ì¶”ê°€ ë³´ë„ˆìŠ¤
        }
        
        # UserServiceë¥¼ í†µí•´ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
        from .user_service import UserService
        user_service = UserService()
        user_service.update_activity_points(
            user_id, 
            points.get(action, 0)
        )
    
    def _enrich_feed(self, feed: Dict) -> Dict:
        """í”¼ë“œì— ê´€ë ¨ ì •ë³´ ì¶”ê°€"""
        # ì‚¬ìš©ì ì •ë³´
        user_response = self.supabase.table('users') \
            .select('id, nickname, profile_image_url, grade') \
            .eq('id', feed['user_id']) \
            .single() \
            .execute()
        
        # ë©”ë‰´ ì •ë³´
        menu_response = self.supabase.table('menus') \
            .select('*, stores(*)') \
            .eq('id', feed['menu_id']) \
            .single() \
            .execute()
        
        feed['user'] = user_response.data
        feed['menu'] = menu_response.data
        feed['store'] = menu_response.data.get('stores')
        
        return feed
```

## 4. í”¼ë“œ ì¡°íšŒ

### [í•„ìˆ˜] ìœ„ì¹˜ ê¸°ë°˜ ì¡°íšŒ
```python
# íŒŒì¼: backend/services/feed_service.py (ì¶”ê°€)

    def get_nearby_feeds(
        self,
        latitude: float,
        longitude: float,
        radius_km: float = 1.0,
        page: int = 1,
        limit: int = 20,
        user_id: Optional[str] = None
    ) -> Dict:
        """ê·¼ì²˜ í”¼ë“œ ì¡°íšŒ"""
        offset = (page - 1) * limit
        
        # PostGIS í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ìœ„ì¹˜ ê¸°ë°˜ ì¿¼ë¦¬
        response = self.supabase.rpc(
            'get_nearby_feeds',
            {
                'user_lat': latitude,
                'user_lng': longitude,
                'radius_km': radius_km,
                'limit_count': limit,
                'offset_count': offset
            }
        ).execute()
        
        feeds = response.data
        
        # ì‚¬ìš©ìë³„ ì¶”ì²œ ì—¬ë¶€ ì¶”ê°€
        if user_id:
            for feed in feeds:
                feed['is_recommended'] = self._check_user_recommendation(
                    user_id, 
                    feed['feed_id']
                )
        
        return {
            'feeds': feeds,
            'page': page,
            'limit': limit,
            'total': len(feeds)  # ì‹¤ì œë¡œëŠ” count ì¿¼ë¦¬ í•„ìš”
        }
    
    def get_feed_by_id(
        self, 
        feed_id: str, 
        user_id: Optional[str] = None
    ) -> Dict:
        """í”¼ë“œ ìƒì„¸ ì¡°íšŒ"""
        response = self.supabase.table('feeds') \
            .select('*, users(*), menus(*, stores(*))') \
            .eq('id', feed_id) \
            .single() \
            .execute()
        
        if not response.data:
            raise ValueError('í”¼ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')
        
        feed = response.data
        
        # ì¶”ì²œ ì—¬ë¶€ í™•ì¸
        if user_id:
            feed['is_recommended'] = self._check_user_recommendation(
                user_id, 
                feed_id
            )
        
        # ëŒ“ê¸€ ìˆ˜ ì¶”ê°€
        comment_count = self.supabase.table('comments') \
            .select('id', count='exact') \
            .eq('feed_id', feed_id) \
            .execute()
        
        feed['comment_count'] = comment_count.count or 0
        
        return feed
    
    def _check_user_recommendation(
        self, 
        user_id: str, 
        feed_id: str
    ) -> bool:
        """ì‚¬ìš©ìì˜ ì¶”ì²œ ì—¬ë¶€ í™•ì¸"""
        response = self.supabase.table('recommendations') \
            .select('id') \
            .eq('user_id', user_id) \
            .eq('feed_id', feed_id) \
            .maybe_single() \
            .execute()
        
        return response.data is not None
```

### [í•„ìˆ˜] í”¼ë“œ ìˆ˜ì •/ì‚­ì œ
```python
# íŒŒì¼: backend/services/feed_service.py (ì¶”ê°€)

    def update_feed(
        self,
        feed_id: str,
        user_id: str,
        updates: Dict
    ) -> Dict:
        """í”¼ë“œ ìˆ˜ì •"""
        # í”¼ë“œ ì†Œìœ ì í™•ì¸
        feed = self.get_feed_by_id(feed_id)
        if feed['user_id'] != user_id:
            raise ValueError('í”¼ë“œë¥¼ ìˆ˜ì •í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤')
        
        # ìˆ˜ì • ê°€ëŠ¥í•œ í•„ë“œë§Œ í•„í„°ë§
        allowed_fields = ['content', 'tags']
        filtered_updates = {
            k: v for k, v in updates.items() 
            if k in allowed_fields
        }
        
        if not filtered_updates:
            raise ValueError('ìˆ˜ì •í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤')
        
        # ì—…ë°ì´íŠ¸ ì‹¤í–‰
        response = self.supabase.table('feeds') \
            .update(filtered_updates) \
            .eq('id', feed_id) \
            .execute()
        
        return self._enrich_feed(response.data[0])
    
    def delete_feed(self, feed_id: str, user_id: str):
        """í”¼ë“œ ì‚­ì œ"""
        # í”¼ë“œ ì†Œìœ ì í™•ì¸
        feed = self.get_feed_by_id(feed_id)
        if feed['user_id'] != user_id:
            raise ValueError('í”¼ë“œë¥¼ ì‚­ì œí•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤')
        
        # ì‚­ì œ ì‹¤í–‰ (CASCADEë¡œ ê´€ë ¨ ë°ì´í„°ë„ ì‚­ì œë¨)
        self.supabase.table('feeds') \
            .delete() \
            .eq('id', feed_id) \
            .execute()
```

### [ì„ íƒ] í”¼ë“œ í•„í„°ë§
```python
# íŒŒì¼: backend/routes/feed_routes.py (ì¶”ê°€)

# GET /api/feeds/category/<category> - ì¹´í…Œê³ ë¦¬ë³„ í”¼ë“œ
@feed_bp.route('/category/<category>', methods=['GET'])
def get_feeds_by_category(category):
    """ì¹´í…Œê³ ë¦¬ë³„ í”¼ë“œ ì¡°íšŒ"""
    try:
        page = int(request.args.get('page', 1))
        limit = int(request.args.get('limit', 20))
        
        feeds = feed_service.get_feeds_by_category(
            category=category,
            page=page,
            limit=limit
        )
        
        return jsonify(feeds), 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500

# GET /api/feeds/user/<user_id> - ì‚¬ìš©ìë³„ í”¼ë“œ
@feed_bp.route('/user/<user_id>', methods=['GET'])
def get_user_feeds(user_id):
    """íŠ¹ì • ì‚¬ìš©ìì˜ í”¼ë“œ ëª©ë¡"""
    try:
        page = int(request.args.get('page', 1))
        limit = int(request.args.get('limit', 20))
        
        feeds = feed_service.get_user_feeds(
            user_id=user_id,
            page=page,
            limit=limit
        )
        
        return jsonify(feeds), 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500
```

## 5. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í”¼ë“œ ìƒì„± API ë™ì‘
- [ ] ë©€í‹° ì´ë¯¸ì§€ ì²˜ë¦¬
- [ ] ìœ„ì¹˜ ê¸°ë°˜ ì¡°íšŒ
- [ ] ì¤‘ë³µ ë“±ë¡ ë°©ì§€
- [ ] OCR ì¶”ê°€ ê¸°ëŠ¥
- [ ] ê¶Œí•œ ê²€ì¦

### ğŸ§ª API í…ŒìŠ¤íŠ¸
```python
# íŒŒì¼: tests/test_feed_api.py
import pytest

def test_create_feed(client, auth_token):
    """í”¼ë“œ ìƒì„± í…ŒìŠ¤íŠ¸"""
    response = client.post(
        '/api/feeds',
        json={
            'menu_id': 'test-menu-id',
            'content': 'ì •ë§ ë§›ìˆì–´ìš”!',
            'image_urls': ['image1.jpg', 'image2.jpg'],
            'tags': ['ë§›ì§‘', 'ì¶”ì²œ'],
            'latitude': 37.5665,
            'longitude': 126.9780,
            'floor': '2F',
            'shop_name': 'ì—„ë§ˆì†ê¹€ì¹˜ì°Œê°œ'
        },
        headers={'Authorization': f'Bearer {auth_token}'}
    )
    
    assert response.status_code == 201
    data = response.get_json()
    assert data['content'] == 'ì •ë§ ë§›ìˆì–´ìš”!'
    assert len(data['image_urls']) == 2
    assert data['floor'] == '2F'
    assert data['shop_name'] == 'ì—„ë§ˆì†ê¹€ì¹˜ì°Œê°œ'

def test_add_ocr(client, auth_token, feed_id):
    """OCR ì¶”ê°€ í…ŒìŠ¤íŠ¸"""
    response = client.put(
        f'/api/feeds/{feed_id}/ocr',
        json={
            'ocr_text': 'ì—„ë§ˆì†ê¹€ì¹˜ì°Œê°œ\nê¹€ì¹˜ì°Œê°œ 8,000ì›',
            'receipt_image_url': 'receipt.jpg'
        },
        headers={'Authorization': f'Bearer {auth_token}'}
    )
    
    assert response.status_code == 200
    data = response.get_json()
    assert data['ocr_status'] == 'completed'

def test_get_nearby_feeds(client):
    """ê·¼ì²˜ í”¼ë“œ ì¡°íšŒ í…ŒìŠ¤íŠ¸"""
    response = client.get(
        '/api/feeds?lat=37.5665&lng=126.9780&radius=1'
    )
    
    assert response.status_code == 200
    data = response.get_json()
    assert 'feeds' in data
    assert isinstance(data['feeds'], list)

def test_duplicate_feed_check(client, auth_token):
    """ì¤‘ë³µ ë“±ë¡ ì²´í¬ í…ŒìŠ¤íŠ¸"""
    # ì²« ë²ˆì§¸ ë“±ë¡
    response1 = client.post(
        '/api/feeds',
        json={
            'menu_id': 'test-menu-id',
            'content': 'ì²« ë²ˆì§¸ ë“±ë¡',
            'image_urls': ['image1.jpg'],
            'latitude': 37.5665,
            'longitude': 126.9780
        },
        headers={'Authorization': f'Bearer {auth_token}'}
    )
    assert response1.status_code == 201
    
    # 24ì‹œê°„ ë‚´ ê°™ì€ ë©”ë‰´ ì¬ë“±ë¡ ì‹œë„
    response2 = client.post(
        '/api/feeds',
        json={
            'menu_id': 'test-menu-id',
            'content': 'ë‘ ë²ˆì§¸ ë“±ë¡',
            'image_urls': ['image2.jpg'],
            'latitude': 37.5665,
            'longitude': 126.9780
        },
        headers={'Authorization': f'Bearer {auth_token}'}
    )
    assert response2.status_code == 400
    assert '24ì‹œê°„ ë‚´ì— ì´ë¯¸ ë“±ë¡í•œ ë©”ë‰´ì…ë‹ˆë‹¤' in response2.get_json()['error']
```