# ğŸ“± 9.1 í‘¸ì‹œ ì•Œë¦¼ êµ¬í˜„

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#1-ê°œìš”)
2. [í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •](#2-í‘¸ì‹œ-ì•Œë¦¼-ì„¤ì •)
3. [êµ¬í˜„](#3-êµ¬í˜„)
4. [ê²€ì¦](#4-ê²€ì¦)

## 1. ê°œìš”
OneSignal ë˜ëŠ” Supabaseì™€ ì—°ë™ ê°€ëŠ¥í•œ í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•œ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê³ , ì•Œë¦¼ íƒ€ì…ë³„ ì²˜ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸
- âœ… OneSignal ì„¤ì • (ë˜ëŠ” ë‹¤ë¥¸ í‘¸ì‹œ ì„œë¹„ìŠ¤)
- âœ… ì•Œë¦¼ íƒ€ì…ë³„ ì²˜ë¦¬
- âœ… í¬ê·¸ë¼ìš´ë“œ/ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
- âœ… ì•Œë¦¼ ê¶Œí•œ ìš”ì²­

## 2. í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •

### [í•„ìˆ˜] íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
```yaml
# íŒŒì¼: pubspec.yaml
dependencies:
  onesignal_flutter: ^5.0.0
  flutter_local_notifications: ^16.1.0
  # ë˜ëŠ” ë‹¤ë¥¸ í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤
```

### [í•„ìˆ˜] í”Œë«í¼ë³„ ì„¤ì •

#### iOS ì„¤ì •
```xml
<!-- íŒŒì¼: ios/Runner/Info.plist -->
<key>UIBackgroundModes</key>
<array>
    <string>fetch</string>
    <string>remote-notification</string>
</array>
```

#### Android ì„¤ì •
```xml
<!-- íŒŒì¼: android/app/src/main/AndroidManifest.xml -->
<meta-data
    android:name="com.onesignal.NotificationServiceExtension"
    android:value="com.fallingo.NotificationServiceExtension" />
```

### [í•„ìˆ˜] ì•Œë¦¼ íƒ€ì… ì •ì˜
```dart
// íŒŒì¼: lib/core/constants/notification_constants.dart
class NotificationConstants {
  // ì•Œë¦¼ ì±„ë„
  static const Map<String, NotificationChannel> channels = {
    'feed_activity': NotificationChannel(
      id: 'feed_activity',
      name: 'í”¼ë“œ í™œë™',
      description: 'ë‚´ í”¼ë“œì— ëŒ€í•œ ì¶”ì²œ, ëŒ“ê¸€ ë“±ì˜ í™œë™ ì•Œë¦¼',
      importance: Importance.high,
      sound: 'default',
    ),
    'follow': NotificationChannel(
      id: 'follow',
      name: 'íŒ”ë¡œìš°',
      description: 'ìƒˆë¡œìš´ íŒ”ë¡œì›Œ ì•Œë¦¼',
      importance: Importance.medium,
      sound: 'default',
    ),
    'nearby': NotificationChannel(
      id: 'nearby',
      name: 'ì£¼ë³€ ì •ë³´',
      description: 'ê·¼ì²˜ì˜ ì´ë²¤íŠ¸ë‚˜ ì¸í”Œë£¨ì–¸ì„œ ì•Œë¦¼',
      importance: Importance.high,
      sound: 'nearby',
    ),
    'grade': NotificationChannel(
      id: 'grade',
      name: 'ë“±ê¸‰ ë³€í™”',
      description: 'ë“±ê¸‰ ìƒìŠ¹ ë° ë³´ìƒ ì•Œë¦¼',
      importance: Importance.max,
      sound: 'celebration',
    ),
    'marketing': NotificationChannel(
      id: 'marketing',
      name: 'ë§ˆì¼€íŒ…',
      description: 'ì´ë²¤íŠ¸ ë° í”„ë¡œëª¨ì…˜ ì •ë³´',
      importance: Importance.low,
      sound: null,
    ),
  };
  
  // ì•Œë¦¼ íƒ€ì…
  static const Map<String, NotificationType> types = {
    // í”¼ë“œ í™œë™
    'feed_recommended': NotificationType(
      id: 'feed_recommended',
      channelId: 'feed_activity',
      title: 'ëˆ„êµ°ê°€ íšŒì›ë‹˜ì˜ í”¼ë“œë¥¼ ì¶”ì²œí–ˆì–´ìš”! ğŸ‘',
      bodyTemplate: '{userName}ë‹˜ì´ {menuName} í”¼ë“œë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤',
      actionType: 'feed_detail',
    ),
    'feed_commented': NotificationType(
      id: 'feed_commented',
      channelId: 'feed_activity',
      title: 'ìƒˆë¡œìš´ ëŒ“ê¸€ì´ ë‹¬ë ¸ì–´ìš”! ğŸ’¬',
      bodyTemplate: '{userName}ë‹˜: {comment}',
      actionType: 'feed_detail',
    ),
    
    // íŒ”ë¡œìš°
    'new_follower': NotificationType(
      id: 'new_follower',
      channelId: 'follow',
      title: 'ìƒˆë¡œìš´ íŒ”ë¡œì›Œê°€ ìƒê²¼ì–´ìš”! ğŸ‰',
      bodyTemplate: '{userName}ë‹˜ì´ íšŒì›ë‹˜ì„ íŒ”ë¡œìš°í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤',
      actionType: 'profile',
    ),
    
    // ì£¼ë³€ ì •ë³´
    'nearby_event': NotificationType(
      id: 'nearby_event',
      channelId: 'nearby',
      title: 'ğŸª ê·¼ì²˜ì—ì„œ íŠ¹ë³„í•œ ì´ë²¤íŠ¸ê°€ ì§„í–‰ ì¤‘!',
      bodyTemplate: '{distance}m ê·¼ì²˜ì—ì„œ {eventName}ì´(ê°€) ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤',
      actionType: 'event_detail',
    ),
    'nearby_influencer': NotificationType(
      id: 'nearby_influencer',
      channelId: 'nearby',
      title: 'â­ ì¸í”Œë£¨ì–¸ì„œê°€ ê·¼ì²˜ì— ìˆì–´ìš”!',
      bodyTemplate: '{influencerName}ë‹˜ì´ {distance}m ê·¼ì²˜ì—ì„œ í™œë™ ì¤‘',
      actionType: 'influencer_profile',
    ),
    
    // ë“±ê¸‰
    'grade_up': NotificationType(
      id: 'grade_up',
      channelId: 'grade',
      title: 'ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤! ë“±ê¸‰ì´ ìƒìŠ¹í–ˆì–´ìš”!',
      bodyTemplate: '{previousGrade}ì—ì„œ {newGrade}(ìœ¼)ë¡œ ìŠ¹ê¸‰í•˜ì…¨ìŠµë‹ˆë‹¤',
      actionType: 'my_profile',
    ),
    
    // ë§ˆì¼€íŒ…
    'new_certified': NotificationType(
      id: 'new_certified',
      channelId: 'marketing',
      title: 'ğŸ… ìƒˆë¡œìš´ ì¸ì¦ ì¶”ì²œë§›ì§‘ íƒ„ìƒ!',
      bodyTemplate: '{storeName}ì´(ê°€) ì¸ì¦ ì¶”ì²œë§›ì§‘ìœ¼ë¡œ ì„ ì •ë˜ì—ˆìŠµë‹ˆë‹¤',
      actionType: 'store_detail',
    ),
  };
}

// ì•Œë¦¼ ì±„ë„ ëª¨ë¸
class NotificationChannel {
  final String id;
  final String name;
  final String description;
  final Importance importance;
  final String? sound;
  
  const NotificationChannel({
    required this.id,
    required this.name,
    required this.description,
    required this.importance,
    this.sound,
  });
}

// ì•Œë¦¼ íƒ€ì… ëª¨ë¸
class NotificationType {
  final String id;
  final String channelId;
  final String title;
  final String bodyTemplate;
  final String actionType;
  
  const NotificationType({
    required this.id,
    required this.channelId,
    required this.title,
    required this.bodyTemplate,
    required this.actionType,
  });
}
```

## 3. êµ¬í˜„

### [í•„ìˆ˜] í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤
```dart
// íŒŒì¼: lib/core/services/push_notification_service.dart
import 'package:onesignal_flutter/onesignal_flutter.dart';
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

class PushNotificationService {
  static final PushNotificationService _instance = PushNotificationService._internal();
  factory PushNotificationService() => _instance;
  PushNotificationService._internal();
  
  final FlutterLocalNotificationsPlugin _localNotifications = 
      FlutterLocalNotificationsPlugin();
  final _supabase = Supabase.instance.client;
  
  String? _pushToken;
  
  // ì´ˆê¸°í™”
  Future<void> initialize() async {
    // OneSignal ì´ˆê¸°í™”
    await _initializeOneSignal();
    
    // ë¡œì»¬ ì•Œë¦¼ ì´ˆê¸°í™”
    await _initializeLocalNotifications();
    
    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    await _requestPermission();
    
    // ì•Œë¦¼ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    _setupNotificationListeners();
    
    // ì•Œë¦¼ ì±„ë„ ìƒì„± (Android)
    await _createNotificationChannels();
  }
  
  // OneSignal ì´ˆê¸°í™”
  Future<void> _initializeOneSignal() async {
    // OneSignal ì•± ID ì„¤ì •
    OneSignal.Debug.setLogLevel(OSLogLevel.verbose);
    OneSignal.initialize("YOUR_ONESIGNAL_APP_ID");
    
    // ì‚¬ìš©ì ID ì„¤ì • (Supabase Authì™€ ì—°ë™)
    final user = _supabase.auth.currentUser;
    if (user != null) {
      OneSignal.login(user.id);
    }
    
    // í‘¸ì‹œ í† í° ê°€ì ¸ì˜¤ê¸°
    final deviceState = await OneSignal.User.pushSubscription.id;
    if (deviceState != null) {
      _pushToken = deviceState;
      await _savePushToken(deviceState);
    }
  }
  
  // ë¡œì»¬ ì•Œë¦¼ ì´ˆê¸°í™”
  Future<void> _initializeLocalNotifications() async {
    const androidSettings = AndroidInitializationSettings('@mipmap/ic_launcher');
    const iosSettings = DarwinInitializationSettings(
      requestAlertPermission: false,
      requestBadgePermission: false,
      requestSoundPermission: false,
    );
    
    const initSettings = InitializationSettings(
      android: androidSettings,
      iOS: iosSettings,
    );
    
    await _localNotifications.initialize(
      initSettings,
      onDidReceiveNotificationResponse: _onNotificationTapped,
    );
  }
  
  // ê¶Œí•œ ìš”ì²­
  Future<bool> _requestPermission() async {
    final permission = await OneSignal.Notifications.requestPermission(true);
    return permission;
  }
  
  // ì•Œë¦¼ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  void _setupNotificationListeners() {
    // í¬ê·¸ë¼ìš´ë“œ ì•Œë¦¼
    OneSignal.Notifications.addForegroundWillDisplayListener((event) {
      _handleForegroundNotification(event.notification);
    });
    
    // ì•Œë¦¼ í´ë¦­
    OneSignal.Notifications.addClickListener((event) {
      _handleNotificationClick(event.notification);
    });
  }
  
  // í¬ê·¸ë¼ìš´ë“œ ì•Œë¦¼ ì²˜ë¦¬
  Future<void> _handleForegroundNotification(OSNotification notification) async {
    print('Foreground notification: ${notification.notificationId}');
    
    // ì•Œë¦¼ ë°ì´í„° íŒŒì‹±
    final notificationData = _parseNotificationData(notification);
    
    // ë¡œì»¬ ì•Œë¦¼ í‘œì‹œ
    await _showLocalNotification(notificationData);
    
    // ì¸ì•± ì•Œë¦¼ í‘œì‹œ (ì„ íƒì )
    if (notificationData.showInApp) {
      _showInAppNotification(notificationData);
    }
  }
  
  // ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬
  void _handleNotificationClick(OSNotification notification) {
    print('Notification clicked: ${notification.notificationId}');
    
    final notificationData = _parseNotificationData(notification);
    _navigateToScreen(notificationData);
  }
  
  // ì•Œë¦¼ ë°ì´í„° íŒŒì‹±
  NotificationData _parseNotificationData(OSNotification notification) {
    final additionalData = notification.additionalData ?? {};
    
    return NotificationData(
      id: notification.notificationId ?? '',
      typeId: additionalData['type'] ?? '',
      title: notification.title ?? '',
      body: notification.body ?? '',
      imageUrl: notification.bigPicture,
      actionType: additionalData['action_type'] ?? '',
      actionData: additionalData['action_data'] ?? '',
      showInApp: additionalData['show_in_app'] == true,
    );
  }
  
  // ë¡œì»¬ ì•Œë¦¼ í‘œì‹œ
  Future<void> _showLocalNotification(NotificationData data) async {
    final type = NotificationConstants.types[data.typeId];
    if (type == null) return;
    
    final channel = NotificationConstants.channels[type.channelId];
    if (channel == null) return;
    
    final androidDetails = AndroidNotificationDetails(
      channel.id,
      channel.name,
      channelDescription: channel.description,
      importance: channel.importance,
      priority: Priority.high,
      showWhen: true,
    );
    
    final iosDetails = DarwinNotificationDetails(
      presentAlert: true,
      presentBadge: true,
      presentSound: true,
      sound: channel.sound,
    );
    
    final details = NotificationDetails(
      android: androidDetails,
      iOS: iosDetails,
    );
    
    await _localNotifications.show(
      data.id.hashCode,
      data.title,
      data.body,
      details,
      payload: '${data.actionType}:${data.actionData}',
    );
  }
  
  // ì¸ì•± ì•Œë¦¼ í‘œì‹œ
  void _showInAppNotification(NotificationData data) {
    // êµ¬í˜„: ìŠ¤ë‚µë°” ë˜ëŠ” ì»¤ìŠ¤í…€ ì•Œë¦¼ UI
    final context = NavigationService.navigatorKey.currentContext;
    if (context != null) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text(data.body),
          action: SnackBarAction(
            label: 'ë³´ê¸°',
            onPressed: () => _navigateToScreen(data),
          ),
        ),
      );
    }
  }
  
  // í™”ë©´ ì´ë™
  void _navigateToScreen(NotificationData data) {
    switch (data.actionType) {
      case 'feed_detail':
        NavigationService.navigateTo('/feed/${data.actionData}');
        break;
      case 'profile':
        NavigationService.navigateTo('/profile/${data.actionData}');
        break;
      case 'event_detail':
        NavigationService.navigateTo('/event/${data.actionData}');
        break;
      case 'my_profile':
        NavigationService.navigateTo('/profile');
        break;
      default:
        NavigationService.navigateTo('/');
    }
  }
  
  // ë¡œì»¬ ì•Œë¦¼ íƒ­ ì²˜ë¦¬
  void _onNotificationTapped(NotificationResponse response) {
    final payload = response.payload;
    if (payload == null) return;
    
    final parts = payload.split(':');
    if (parts.length != 2) return;
    
    final data = NotificationData(
      id: '',
      typeId: '',
      title: '',
      body: '',
      actionType: parts[0],
      actionData: parts[1],
      showInApp: false,
    );
    
    _navigateToScreen(data);
  }
  
  // í‘¸ì‹œ í† í° ì €ì¥ (Supabase)
  Future<void> _savePushToken(String token) async {
    final userId = _supabase.auth.currentUser?.id;
    if (userId == null) return;
    
    await _supabase.from('users').update({
      'push_token': token,
      'push_token_updated_at': DateTime.now().toIso8601String(),
    }).eq('id', userId);
  }
  
  // ì•Œë¦¼ ì±„ë„ ìƒì„± (Android)
  Future<void> _createNotificationChannels() async {
    final androidPlugin = _localNotifications
        .resolvePlatformSpecificImplementation<
            AndroidFlutterLocalNotificationsPlugin>();
    
    if (androidPlugin == null) return;
    
    for (final channel in NotificationConstants.channels.values) {
      await androidPlugin.createNotificationChannel(
        AndroidNotificationChannel(
          channel.id,
          channel.name,
          description: channel.description,
          importance: channel.importance,
          sound: channel.sound != null 
              ? RawResourceAndroidNotificationSound(channel.sound)
              : null,
        ),
      );
    }
  }
  
  // íƒœê·¸ êµ¬ë…
  Future<void> subscribeToTag(String tag) async {
    OneSignal.User.addTag(tag, "true");
  }
  
  // íƒœê·¸ êµ¬ë… í•´ì œ
  Future<void> unsubscribeFromTag(String tag) async {
    OneSignal.User.removeTag(tag);
  }
  
  // ì„œë²„ì—ì„œ ì•Œë¦¼ ì „ì†¡ (ë°±ì—”ë“œ ì½”ë“œ ì˜ˆì‹œ)
  static Future<void> sendNotificationFromServer({
    required String userId,
    required String type,
    required Map<String, dynamic> data,
  }) async {
    // Supabase Edge Function ë˜ëŠ” ë°±ì—”ë“œ APIë¥¼ í†µí•´ OneSignal API í˜¸ì¶œ
    // ì‹¤ì œ êµ¬í˜„ì€ ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬
  }
}

// ì•Œë¦¼ ë°ì´í„° ëª¨ë¸
class NotificationData {
  final String id;
  final String typeId;
  final String title;
  final String body;
  final String? imageUrl;
  final String actionType;
  final String actionData;
  final bool showInApp;
  
  NotificationData({
    required this.id,
    required this.typeId,
    required this.title,
    required this.body,
    this.imageUrl,
    required this.actionType,
    required this.actionData,
    required this.showInApp,
  });
}
```

### [í•„ìˆ˜] ì•Œë¦¼ ì„¤ì • UI
```dart
// íŒŒì¼: lib/features/settings/screens/notification_settings_screen.dart
import 'package:flutter/material.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

class NotificationSettingsScreen extends StatefulWidget {
  @override
  _NotificationSettingsScreenState createState() => _NotificationSettingsScreenState();
}

class _NotificationSettingsScreenState extends State<NotificationSettingsScreen> {
  final Map<String, bool> _channelSettings = {};
  final _supabase = Supabase.instance.client;
  bool _isLoading = true;
  
  @override
  void initState() {
    super.initState();
    _loadSettings();
  }
  
  Future<void> _loadSettings() async {
    // ì‚¬ìš©ì ì•Œë¦¼ ì„¤ì • ë¡œë“œ
    final userId = _supabase.auth.currentUser?.id;
    if (userId == null) return;
    
    final response = await _supabase
        .from('users')
        .select('notification_settings')
        .eq('id', userId)
        .single();
    
    final settings = response['notification_settings'] as Map<String, dynamic>?;
    
    setState(() {
      for (final channel in NotificationConstants.channels.keys) {
        _channelSettings[channel] = settings?[channel] ?? true;
      }
      _isLoading = false;
    });
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ì•Œë¦¼ ì„¤ì •'),
        backgroundColor: AppColors.primaryOrange,
      ),
      body: _isLoading
          ? Center(child: CircularProgressIndicator())
          : ListView(
              children: [
                // ì „ì²´ ì•Œë¦¼
                SwitchListTile(
                  title: Text(
                    'ì „ì²´ ì•Œë¦¼',
                    style: TextStyle(fontWeight: FontWeight.bold),
                  ),
                  subtitle: Text('ëª¨ë“  ì•Œë¦¼ì„ ì¼œê±°ë‚˜ ë•ë‹ˆë‹¤'),
                  value: _channelSettings.values.every((v) => v),
                  onChanged: (value) => _toggleAllNotifications(value),
                ),
                
                Divider(),
                
                // ì±„ë„ë³„ ì„¤ì •
                ...NotificationConstants.channels.entries.map((entry) {
                  final channel = entry.value;
                  return SwitchListTile(
                    title: Text(channel.name),
                    subtitle: Text(channel.description),
                    value: _channelSettings[channel.id] ?? true,
                    onChanged: (value) => _updateChannelSetting(channel.id, value),
                  );
                }).toList(),
                
                // ì¶”ê°€ ì„¤ì •
                Padding(
                  padding: EdgeInsets.all(16),
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        'ì¶”ê°€ ì„¤ì •',
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                      SizedBox(height: 16),
                      ListTile(
                        leading: Icon(Icons.do_not_disturb),
                        title: Text('ë°©í•´ ê¸ˆì§€ ì‹œê°„'),
                        subtitle: Text('íŠ¹ì • ì‹œê°„ì—ëŠ” ì•Œë¦¼ì„ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤'),
                        trailing: Icon(Icons.arrow_forward_ios),
                        onTap: _showDoNotDisturbSettings,
                      ),
                      ListTile(
                        leading: Icon(Icons.vibration),
                        title: Text('ì§„ë™'),
                        subtitle: Text('ì•Œë¦¼ ì‹œ ì§„ë™ ì‚¬ìš©'),
                        trailing: Switch(
                          value: true,
                          onChanged: (value) {},
                        ),
                      ),
                    ],
                  ),
                ),
              ],
            ),
    );
  }
  
  void _toggleAllNotifications(bool value) {
    setState(() {
      _channelSettings.updateAll((key, _) => value);
    });
    _saveSettings();
  }
  
  void _updateChannelSetting(String channelId, bool value) {
    setState(() {
      _channelSettings[channelId] = value;
    });
    _saveSettings();
  }
  
  Future<void> _saveSettings() async {
    final userId = _supabase.auth.currentUser?.id;
    if (userId == null) return;
    
    await _supabase.from('users').update({
      'notification_settings': _channelSettings,
    }).eq('id', userId);
  }
  
  void _showDoNotDisturbSettings() {
    // ë°©í•´ ê¸ˆì§€ ì‹œê°„ ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸
  }
}
```

## 4. ê²€ì¦

### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] OneSignal ì´ˆê¸°í™” ì™„ë£Œ
- [ ] í‘¸ì‹œ í† í° ì •ìƒ ë°œê¸‰
- [ ] ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë‹¤ì´ì–¼ë¡œê·¸
- [ ] í¬ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œ ì•Œë¦¼ ìˆ˜ì‹ 
- [ ] ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œ ì•Œë¦¼ ìˆ˜ì‹ 
- [ ] ì¢…ë£Œ ìƒíƒœì—ì„œ ì•Œë¦¼ ìˆ˜ì‹ 
- [ ] ì•Œë¦¼ íƒ­ ì‹œ í•´ë‹¹ í™”ë©´ ì´ë™
- [ ] ì±„ë„ë³„ ì•Œë¦¼ ì„¤ì • ì €ì¥

### [ì„ íƒ] ë°±ì—”ë“œ ì•Œë¦¼ ì „ì†¡ ì˜ˆì‹œ
```python
# íŒŒì¼: backend/services/notification_service.py
import requests
from supabase import create_client

class NotificationService:
    def __init__(self):
        self.onesignal_app_id = "YOUR_ONESIGNAL_APP_ID"
        self.onesignal_api_key = "YOUR_ONESIGNAL_API_KEY"
        self.supabase = create_client(
            "YOUR_SUPABASE_URL",
            "YOUR_SUPABASE_KEY"
        )
    
    def send_notification(self, user_id: str, notification_type: str, data: dict):
        """OneSignalì„ í†µí•´ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡"""
        
        # ì•Œë¦¼ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸°
        template = self.get_notification_template(notification_type)
        if not template:
            return False
        
        # ì•Œë¦¼ ë‚´ìš© ìƒì„±
        title = template['title']
        body = self.format_body(template['body_template'], data)
        
        # OneSignal API í˜¸ì¶œ
        headers = {
            "Authorization": f"Basic {self.onesignal_api_key}",
            "Content-Type": "application/json"
        }
        
        payload = {
            "app_id": self.onesignal_app_id,
            "include_external_user_ids": [user_id],
            "headings": {"en": title},
            "contents": {"en": body},
            "data": {
                "type": notification_type,
                "action_type": template['action_type'],
                "action_data": data.get('action_data', '')
            }
        }
        
        response = requests.post(
            "https://onesignal.com/api/v1/notifications",
            headers=headers,
            json=payload
        )
        
        return response.status_code == 200
```